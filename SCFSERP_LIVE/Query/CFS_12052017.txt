
1.

USE [CFS]
GO

/****** Object:  View [dbo].[VW_EXPORT_STUFFING_BILL_MIN_DATE_ASSGN]    Script Date: 12/05/2017 17:11:05 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER VIEW [dbo].[VW_EXPORT_STUFFING_BILL_MIN_DATE_ASSGN]
AS
SELECT        SBMID, MIN(SBDDATE) AS SBDDATE
FROM            dbo.SHIPPINGBILLDETAIL
GROUP BY SBMID

GO




pr_Export_Invoice_Stuff_Flx_Assgn - FIRST INSERT

SELECT        dbo.GATEINDETAIL.CONTNRNO, dbo.CONTAINERSIZEMASTER.CONTNRSDESC, dbo.GATEINDETAIL.GIDATE, 
                         MIN(dbo.VW_EXPORT_STUFFING_BILL_MIN_DATE_ASSGN.SBDDATE) AS SBDDATE, dbo.GATEINDETAIL.CONTNRSID, dbo.STUFFINGDETAIL.STFDID, 
                         dbo.GATEINDETAIL.GIDID
FROM            dbo.STUFFINGPRODUCTDETAIL INNER JOIN
                         dbo.STUFFINGDETAIL ON dbo.STUFFINGPRODUCTDETAIL.STFDID = dbo.STUFFINGDETAIL.STFDID INNER JOIN
                         dbo.GATEINDETAIL ON dbo.STUFFINGDETAIL.GIDID = dbo.GATEINDETAIL.GIDID INNER JOIN
                         dbo.CONTAINERSIZEMASTER ON dbo.GATEINDETAIL.CONTNRSID = dbo.CONTAINERSIZEMASTER.CONTNRSID INNER JOIN
                         dbo.STUFFINGMASTER ON dbo.STUFFINGDETAIL.STFMID = dbo.STUFFINGMASTER.STFMID INNER JOIN
                         dbo.SHIPPINGBILLDETAIL ON dbo.STUFFINGPRODUCTDETAIL.SBDID = dbo.SHIPPINGBILLDETAIL.SBDID INNER JOIN
                         dbo.VW_EXPORT_STUFFING_BILL_MIN_DATE_ASSGN ON 
                         dbo.SHIPPINGBILLDETAIL.SBMID = dbo.VW_EXPORT_STUFFING_BILL_MIN_DATE_ASSGN.SBMID LEFT OUTER JOIN
                         dbo.GATEOUTDETAIL ON dbo.GATEINDETAIL.GIDID = dbo.GATEOUTDETAIL.GIDID LEFT OUTER JOIN
                         dbo.VW_EXPORT_INVOICE_SBILL_NO_CBX_ASSGN_01 ON dbo.STUFFINGDETAIL.STFDID = dbo.VW_EXPORT_INVOICE_SBILL_NO_CBX_ASSGN_01.STFDID
WHERE        (ISNULL(dbo.VW_EXPORT_INVOICE_SBILL_NO_CBX_ASSGN_01.TRANDID, 0) = 0) AND (dbo.STUFFINGDETAIL.STFMID = 6403)
GROUP BY dbo.STUFFINGDETAIL.STFDID, dbo.GATEINDETAIL.CONTNRNO, dbo.GATEINDETAIL.CONTNRSID, dbo.GATEINDETAIL.GIDID, 
                         dbo.CONTAINERSIZEMASTER.CONTNRSDESC, dbo.GATEINDETAIL.GIDATE