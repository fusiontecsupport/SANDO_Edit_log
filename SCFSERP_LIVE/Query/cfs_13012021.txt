
1.

USE [SCFS]
GO
/****** Object:  StoredProcedure [dbo].[pr_EInvoice_Import_Transaction_Detail_Assgn]    Script Date: 13/01/2021 13:51:54 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create PROCEDURE [dbo].[pr_EInvoice_Import_Manual_Transaction_Detail_Assgn] @PTranMID int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    DECLARE @TableMaster TABLE
    ( 
	   PrdDesc  varchar(50),
	   HsnCd varchar(15),
	   Qty int,
	   UnitCode varchar(15),
	   UnitPrice numeric(18,2),
	   TotAmt  numeric(18,2),
	   AssAmt numeric(18,2),
	   GstRt numeric(18,2),
	   IgstAmt numeric(18,2),
	   CgstAmt numeric(18,2),
	   SgstAmt numeric(18,2),
	   TotItemVal numeric(18,2)	


    )

	Insert into @TableMaster(PrdDesc, HsnCd, Qty, UnitCode, UnitPrice, TotAmt, AssAmt, GstRt, IgstAmt, CgstAmt, SgstAmt, TotItemVal)
	Select 'Storage Charges',STRG_HSNCODE, 1, 'Nos', STRG_TAXABLE_AMT, STRG_TAXABLE_AMT, STRG_TAXABLE_AMT, 18, STRG_IGST_AMT, STRG_CGST_AMT,
	STRG_SGST_AMT, STRG_TAXABLE_AMT + STRG_IGST_AMT + STRG_CGST_AMT + STRG_SGST_AMT  
	from Z_IMPORT_MANUAL_EINVOICE_DETAILS Where STRG_TAXABLE_AMT > 0 And TRANMID = @PTranMID

	Insert into @TableMaster(PrdDesc, HsnCd, Qty, UnitCode, UnitPrice, TotAmt, AssAmt, GstRt, IgstAmt, CgstAmt, SgstAmt, TotItemVal)
	Select 'Handling Charges',HANDL_HSNCODE, 1, 'Nos', HANDL_TAXABLE_AMT, HANDL_TAXABLE_AMT, HANDL_TAXABLE_AMT, 18, HANDL_IGST_AMT, HANDL_CGST_AMT,
	HANDL_SGST_AMT, HANDL_TAXABLE_AMT + HANDL_IGST_AMT + HANDL_SGST_AMT + HANDL_SGST_AMT  
	from Z_IMPORT_MANUAL_EINVOICE_DETAILS Where HANDL_TAXABLE_AMT > 0 And TRANMID = @PTranMID

	Select * From @TableMaster

END


2.


USE [SCFS]
GO

/****** Object:  View [dbo].[Z_IMPORT_MANUAL_EINVOICE_DETAILS]    Script Date: 13/01/2021 14:08:16 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER VIEW [dbo].[Z_IMPORT_MANUAL_EINVOICE_DETAILS]
AS
SELECT        dbo.COMPANYMASTER.COMPNAME, dbo.TRANSACTIONMASTER.COMPYID, dbo.TRANSACTIONMASTER.TRANMID, dbo.TRANSACTIONMASTER.SDPTID, dbo.TRANSACTIONMASTER.REGSTRID, 
                         dbo.TRANSACTIONMASTER.TRANBTYPE, dbo.TRANSACTIONMASTER.TRANDATE, RIGHT(dbo.TRANSACTIONMASTER.TRANTIME, 8) AS TRANTIME, dbo.TRANSACTIONMASTER.TRANNO, dbo.TRANSACTIONMASTER.TRANDNO, 
                         dbo.TRANSACTIONMASTER.TRANREFNAME, dbo.TRANSACTIONMASTER.TRANMODE, dbo.TRANSACTIONMASTER.TRANMODEDETL, dbo.TRANSACTIONMASTER.TRANREFNO, dbo.TRANSACTIONMASTER.TRANREFDATE, 
                         dbo.TRANSACTIONMASTER.TRANREFBNAME, dbo.TRANSACTIONMASTER.TRANREFAMT, dbo.TRANSACTIONMASTER.TRANGAMT, dbo.TRANSACTIONMASTER.TRANSAMT, dbo.TRANSACTIONMASTER.TRANHAMT, 
                         dbo.TRANSACTIONMASTER.TRANEAMT, dbo.TRANSACTIONMASTER.TRANFAMT, dbo.TRANSACTIONMASTER.TRANAAMT, dbo.TRANSACTIONMASTER.TRANNAMT, dbo.TRANSACTIONMASTER.TRANAMTWRDS, 
                         dbo.TRANSACTIONMASTER.TRANRMKS, dbo.CATEGORYMASTER.CATEADDR, SUM(dbo.TRANSACTIONDETAIL.TRANDQTY) AS TRANDQTY, SUM(dbo.TRANSACTIONDETAIL.TRANDGAMT) AS TRANDGAMT, 
                         SUM(dbo.TRANSACTIONDETAIL.TRANDSAMT) AS TRANDSAMT, SUM(dbo.TRANSACTIONDETAIL.TRANDHAMT) AS TRANDHAMT, SUM(dbo.TRANSACTIONDETAIL.TRANDEAMT) AS TRANDEAMT, 
                         SUM(dbo.TRANSACTIONDETAIL.TRANDFAMT) AS TRANDFAMT, SUM(dbo.TRANSACTIONDETAIL.TRANDAAMT) AS TRANDAAMT, SUM(dbo.TRANSACTIONDETAIL.TRANDNAMT) AS TRANDNAMT, 
                         dbo.TRANSACTIONMASTER.LMUSRID, dbo.TRANSACTIONMASTER.CUSRID, dbo.TRANSACTIONMASTER.DISPSTATUS, dbo.COMPANYMASTER.COMPPDESC1, dbo.COMPANYMASTER.COMPPDESC2, 
                         dbo.CATEGORYMASTER.CATEMAIL, dbo.CATEGORYMASTER.CATEPHN1, dbo.CATEGORYMASTER.CATEPHN2, dbo.CATEGORYMASTER.CATEPHN3, dbo.CATEGORYMASTER.CATEPHN4, dbo.TRANSACTIONMASTER.TRANNARTN, 
                         dbo.TRANSACTIONMASTER.TRANPONO, dbo.CATEGORY_ADDRESS_DETAIL.CATEAADDR1 AS TRANIMPADDR1, dbo.CATEGORY_ADDRESS_DETAIL.CATEAADDR2 AS TRANIMPADDR2, 
                         dbo.CATEGORY_ADDRESS_DETAIL.CATEAADDR3 AS TRANIMPADDR3, dbo.CATEGORY_ADDRESS_DETAIL.CATEAADDR4 AS TRANIMPADDR4, dbo.TRANSACTIONDETAIL.TRANDAHAMT, dbo.TRANSACTIONMASTER.TRANAHAMT, 
                         dbo.TRANSACTIONMASTER.TRANGSTNO AS CATEBGSTNO, dbo.COMPANYMASTER.COMPGSTNO, dbo.STATEMASTER.STATEDESC, dbo.STATEMASTER.STATECODE, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_HSNCODE, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_HSNCODE, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_CGST_EXPRN, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_SGST_EXPRN, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_IGST_EXPRN, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_CGST_EXPRN, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_SGST_EXPRN, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_IGST_EXPRN, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_TAXABLE_AMT, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_TAXABLE_AMT, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_CGST_AMT, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_SGST_AMT, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_IGST_AMT, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_CGST_AMT, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_SGST_AMT, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_IGST_AMT, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.CGST_AMT, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.SGST_AMT, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.IGST_AMT, 
                         dbo.TRANSACTIONMASTER.TRANCSNAME, dbo.TRANSACTIONMASTER.TRANGSTNO, dbo.TRANSACTIONMASTER.CATEAID, dbo.CATEGORYMASTER.CATENAME, dbo.CATEGORYMASTER.CATELICNO, 
                         dbo.TRANSACTIONMASTER.TRAN_COVID_DISC_AMT, '# 592,' AS COMPADDR1, 'ENNORE EXPRESS HIGH ROAD,' AS COMPADDR2, 'CHENNAI' AS COMPLOCTDESC, '600057' AS COMPPINCODE, '33' AS COMPSTATECODE, 
                         dbo.COMPANYMASTER.COMPPHN1, dbo.COMPANYMASTER.COMPMAIL, '12' AS COMPPOS, 'Nos' AS UNITCODE, 
                         dbo.TRANSACTIONMASTER.HANDL_TAXABLE_AMT + dbo.TRANSACTIONMASTER.HANDL_IGST_AMT + dbo.TRANSACTIONMASTER.HANDL_CGST_AMT + dbo.TRANSACTIONMASTER.HANDL_SGST_AMT AS TOTALITEMVAL
FROM            dbo.TRANSACTIONMASTER INNER JOIN
                         dbo.TRANSACTIONDETAIL ON dbo.TRANSACTIONMASTER.TRANMID = dbo.TRANSACTIONDETAIL.TRANMID INNER JOIN
                         dbo.COMPANYACCOUNTINGDETAIL ON dbo.TRANSACTIONMASTER.COMPYID = dbo.COMPANYACCOUNTINGDETAIL.COMPYID INNER JOIN
                         dbo.COMPANYMASTER ON dbo.COMPANYACCOUNTINGDETAIL.COMPID = dbo.COMPANYMASTER.COMPID INNER JOIN
                         dbo.CATEGORYMASTER ON dbo.TRANSACTIONMASTER.TRANREFID = dbo.CATEGORYMASTER.CATEID INNER JOIN
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01 ON dbo.TRANSACTIONMASTER.TRANMID = dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.TRANMID LEFT OUTER JOIN
                         dbo.STATEMASTER RIGHT OUTER JOIN
                         dbo.CATEGORY_ADDRESS_DETAIL ON dbo.STATEMASTER.STATEID = dbo.CATEGORY_ADDRESS_DETAIL.STATEID ON dbo.TRANSACTIONMASTER.CATEAID = dbo.CATEGORY_ADDRESS_DETAIL.CATEAID LEFT OUTER JOIN
                         dbo.STATEMASTER AS STATEMASTER_1 ON dbo.CATEGORYMASTER.STATEID = STATEMASTER_1.STATEID
GROUP BY dbo.COMPANYMASTER.COMPNAME, dbo.TRANSACTIONMASTER.COMPYID, dbo.TRANSACTIONMASTER.TRANMID, dbo.TRANSACTIONMASTER.SDPTID, dbo.TRANSACTIONMASTER.REGSTRID, 
                         dbo.TRANSACTIONMASTER.TRANBTYPE, dbo.TRANSACTIONMASTER.TRANDATE, RIGHT(dbo.TRANSACTIONMASTER.TRANTIME, 8), dbo.TRANSACTIONMASTER.TRANNO, dbo.TRANSACTIONMASTER.TRANDNO, 
                         dbo.TRANSACTIONMASTER.TRANREFNAME, dbo.TRANSACTIONMASTER.TRANMODE, dbo.TRANSACTIONMASTER.TRANMODEDETL, dbo.TRANSACTIONMASTER.TRANREFNO, dbo.TRANSACTIONMASTER.TRANREFDATE, 
                         dbo.TRANSACTIONMASTER.TRANREFBNAME, dbo.TRANSACTIONMASTER.TRANREFAMT, dbo.TRANSACTIONMASTER.TRANGAMT, dbo.TRANSACTIONMASTER.TRANSAMT, dbo.TRANSACTIONMASTER.TRANHAMT, 
                         dbo.TRANSACTIONMASTER.TRANEAMT, dbo.TRANSACTIONMASTER.TRANFAMT, dbo.TRANSACTIONMASTER.TRANAAMT, dbo.TRANSACTIONMASTER.TRANNAMT, dbo.TRANSACTIONMASTER.TRANAMTWRDS, 
                         dbo.TRANSACTIONMASTER.TRANRMKS, dbo.CATEGORYMASTER.CATEADDR, dbo.TRANSACTIONMASTER.LMUSRID, dbo.TRANSACTIONMASTER.CUSRID, dbo.TRANSACTIONMASTER.DISPSTATUS, 
                         dbo.COMPANYMASTER.COMPPDESC1, dbo.COMPANYMASTER.COMPPDESC2, dbo.CATEGORYMASTER.CATEMAIL, dbo.CATEGORYMASTER.CATEPHN1, dbo.CATEGORYMASTER.CATEPHN2, dbo.CATEGORYMASTER.CATEPHN3, 
                         dbo.CATEGORYMASTER.CATEPHN4, dbo.TRANSACTIONMASTER.TRANNARTN, dbo.TRANSACTIONMASTER.TRANPONO, dbo.CATEGORY_ADDRESS_DETAIL.CATEAADDR1, dbo.CATEGORY_ADDRESS_DETAIL.CATEAADDR2, 
                         dbo.CATEGORY_ADDRESS_DETAIL.CATEAADDR3, dbo.CATEGORY_ADDRESS_DETAIL.CATEAADDR4, dbo.TRANSACTIONDETAIL.TRANDAHAMT, dbo.TRANSACTIONMASTER.TRANAHAMT, 
                         dbo.TRANSACTIONMASTER.TRANGSTNO, dbo.COMPANYMASTER.COMPGSTNO, dbo.STATEMASTER.STATEDESC, dbo.STATEMASTER.STATECODE, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_HSNCODE, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_HSNCODE, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_CGST_EXPRN, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_SGST_EXPRN, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_IGST_EXPRN, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_CGST_EXPRN, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_SGST_EXPRN, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_IGST_EXPRN, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_TAXABLE_AMT, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_TAXABLE_AMT, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_CGST_AMT, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_SGST_AMT, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.STRG_IGST_AMT, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_CGST_AMT, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_SGST_AMT, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.HANDL_IGST_AMT, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.CGST_AMT, dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.SGST_AMT, 
                         dbo.VW_IMPORT_TRANSACTION_GST_PRINT_ASSGN_01.IGST_AMT, dbo.TRANSACTIONMASTER.TRANCSNAME, dbo.TRANSACTIONMASTER.CATEAID, dbo.CATEGORYMASTER.CATENAME, dbo.CATEGORYMASTER.CATELICNO, 
                         dbo.TRANSACTIONMASTER.TRAN_COVID_DISC_AMT, dbo.COMPANYMASTER.COMPPHN1, dbo.COMPANYMASTER.COMPMAIL, 
                         dbo.TRANSACTIONMASTER.HANDL_TAXABLE_AMT + dbo.TRANSACTIONMASTER.HANDL_IGST_AMT + dbo.TRANSACTIONMASTER.HANDL_CGST_AMT + dbo.TRANSACTIONMASTER.HANDL_SGST_AMT
HAVING        (dbo.TRANSACTIONMASTER.DISPSTATUS = 0)

GO



3.

