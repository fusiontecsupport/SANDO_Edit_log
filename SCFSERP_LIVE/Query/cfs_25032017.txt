



1.

USE [CFS]
GO

/****** Object:  View [dbo].[VW_TURN_OVER_REGISTER_RPT]    Script Date: 03/25/2017 13:24:11 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER VIEW [dbo].[VW_TURN_OVER_REGISTER_RPT]
AS
SELECT     dbo.TMPRPT_IDS.KUSRID, dbo.VW_TAXREGISTER_RPT_01.SDPTID, dbo.VW_TAXREGISTER_RPT_01.TRANBTYPE, dbo.VW_TAXREGISTER_RPT_01.TRANMID, 
                      dbo.VW_TAXREGISTER_RPT_01.COMPYID, dbo.VW_TAXREGISTER_RPT_01.REGSTRID, dbo.VW_TAXREGISTER_RPT_01.TRANDATE, 
                      dbo.VW_TAXREGISTER_RPT_01.TRANNO, dbo.VW_TAXREGISTER_RPT_01.TRANDNO, dbo.VW_TAXREGISTER_RPT_01.TRANREFID, 
                      dbo.VW_TAXREGISTER_RPT_01.TRANREFNAME, dbo.VW_TAXREGISTER_RPT_01.IMPRTNAME, dbo.VW_TAXREGISTER_RPT_01.TRANGAMT, 
                      dbo.VW_TAXREGISTER_RPT_01.TRANSAMT, 
                      dbo.VW_TAXREGISTER_RPT_01.TRANHAMT + dbo.VW_TAXREGISTER_RPT_01.TRANEAMT + dbo.VW_TAXREGISTER_RPT_01.TRANFAMT + dbo.VW_TAXREGISTER_RPT_01.TRANPAMT
                       + ISNULL(dbo.VW_TAXREGISTER_RPT_05.HAMT, 0) AS TRANHAMT, dbo.VW_TAXREGISTER_RPT_01.TRANAAMT, dbo.VW_TAXREGISTER_RPT_01.TRANNAMT, 
                      ISNULL(dbo.VW_TAXREGISTER_RPT_02.TAXAMT, 0) AS TAXAMT, ISNULL(dbo.VW_TAXREGISTER_RPT_02.INSPAMT, 0) AS INSPAMT, 
                      ISNULL(dbo.VW_TAXREGISTER_RPT_02.OTLAMT, 0) AS OTLAMT, ISNULL(dbo.VW_TAXREGISTER_RPT_03.OAMT, 0) AS OAMT, 
                      ISNULL(dbo.VW_TAXREGISTER_RPT_04.SAMT, 0) AS SAMT, ISNULL(dbo.VW_TAXREGISTER_RPT_02.SBCAMT, 0) AS SBCAMT, 
                      ISNULL(dbo.VW_TAXREGISTER_RPT_02.KKCAMT, 0) AS KKCAMT
FROM         dbo.VW_TAXREGISTER_RPT_01 INNER JOIN
                      dbo.TMPRPT_IDS ON dbo.VW_TAXREGISTER_RPT_01.TRANMID = dbo.TMPRPT_IDS.RPTID LEFT OUTER JOIN
                      dbo.VW_TAXREGISTER_RPT_04 ON dbo.TMPRPT_IDS.RPTID = dbo.VW_TAXREGISTER_RPT_04.TRANMID LEFT OUTER JOIN
                      dbo.VW_TAXREGISTER_RPT_05 ON dbo.TMPRPT_IDS.RPTID = dbo.VW_TAXREGISTER_RPT_05.TRANMID LEFT OUTER JOIN
                      dbo.VW_TAXREGISTER_RPT_03 ON dbo.TMPRPT_IDS.RPTID = dbo.VW_TAXREGISTER_RPT_03.TRANMID LEFT OUTER JOIN
                      dbo.VW_TAXREGISTER_RPT_02 ON dbo.TMPRPT_IDS.RPTID = dbo.VW_TAXREGISTER_RPT_02.TRANMID

GO




2.

USE [CFS]
GO

/****** Object:  View [dbo].[VW_TURN_OVER_REGISTER_RPT_N01]    Script Date: 03/25/2017 13:23:50 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER VIEW [dbo].[VW_TURN_OVER_REGISTER_RPT_N01]
AS
SELECT     KUSRID, COMPYID, REGSTRID, TRANBTYPE, SUM(TRANNAMT) AS TRANNAMT, SUM(TRANGAMT) AS TRANGAMT, SUM(TRANSAMT) AS TRANSAMT, SUM(TRANHAMT) 
                      AS TRANHAMT, SUM(SAMT) AS SAMT, SUM(TRANAAMT) AS TRANAAMT, SUM(TAXAMT) AS TAXAMT, SUM(SBCAMT) AS SBCAMT, SUM(KKCAMT) AS KKCAMT, 
                      SUM(INSPAMT + OTLAMT + OAMT) AS OTHRAMT, SUM(TRANSAMT + TRANAAMT + TRANHAMT + INSPAMT + OTLAMT + OAMT + SAMT) AS TOAMT
FROM         dbo.VW_TURN_OVER_REGISTER_RPT
GROUP BY KUSRID, COMPYID, REGSTRID, TRANBTYPE

GO



3.


SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

alter PROCEDURE PR_EXPORT_TURN_OVER_RPT_ASSGN @PKUSRID varchar(100)
	
AS
BEGIN

	SET NOCOUNT ON;
/*
SELECT     dbo.TMPRPT_IDS.KUSRID, dbo.COMPANYMASTER.COMPNAME, dbo.VW_EXPORT_TAXREGISTER_RPT_01.SDPTID, 
                      dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANBTYPE, dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANMID, dbo.VW_EXPORT_TAXREGISTER_RPT_01.COMPYID, 
                      dbo.VW_EXPORT_TAXREGISTER_RPT_01.REGSTRID, dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANDATE, dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANNO, 
                      dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANDNO, dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANREFID, 
                      dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANREFNAME, dbo.VW_EXPORT_TAXREGISTER_RPT_01.EXPRTNAME, 
                      dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANGAMT, dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANNAMT, 
                      dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANDGAMT, dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANDNAMT, 
                      dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANDSAMT, dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANDHAMT, 
                      ISNULL(dbo.VW_EXPORT_TAXREGISTER_RPT_02.TAXAMT, 0) AS TAXAMT, ISNULL(dbo.VW_EXPORT_TAXREGISTER_RPT_02.LAMT, 0) AS LAMT, 
                      ISNULL(dbo.VW_EXPORT_TAXREGISTER_RPT_02.OAMT, 0) AS OAMT, dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANDEAMT, 
                      dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANDFAMT, dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANDPAMT, 
                      dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANDAAMT, ISNULL(dbo.VW_EXPORT_TAXREGISTER_RPT_02.SBCAMT, 0) AS SBCAMT, 
                      ISNULL(dbo.VW_EXPORT_TAXREGISTER_RPT_02.KKCAMT, 0) AS KKCAMT
FROM         dbo.VW_EXPORT_TAXREGISTER_RPT_01 INNER JOIN
                      dbo.COMPANYACCOUNTINGDETAIL ON dbo.VW_EXPORT_TAXREGISTER_RPT_01.COMPYID = dbo.COMPANYACCOUNTINGDETAIL.COMPYID INNER JOIN
                      dbo.COMPANYMASTER ON dbo.COMPANYACCOUNTINGDETAIL.COMPID = dbo.COMPANYMASTER.COMPID INNER JOIN
                      dbo.TMPRPT_IDS ON dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANMID = dbo.TMPRPT_IDS.RPTID LEFT OUTER JOIN
                      dbo.VW_EXPORT_TAXREGISTER_RPT_02 ON dbo.VW_EXPORT_TAXREGISTER_RPT_01.TRANMID = dbo.VW_EXPORT_TAXREGISTER_RPT_02.TRANMID
where    KUSRID = @PKUSRID            
*/

SELECT COMPYID, REGSTRID, TRANBTYPE, SUM(TRANNAMT) AS TRANNAMT, SUM(TRANDSAMT) AS TRANSAMT, SUM(TRANDHAMT) AS TRANHAMT,
SUM(TAXAMT) AS TAXAMT, SUM(SBCAMT) AS SBCAMT, SUM(KKCAMT) AS KKCAMT, SUM(LAMT + OAMT + TRANDFAMT + TRANDEAMT) AS OTHRAMT, SUM(TRANNAMT - TAXAMT) AS TOAMT
FROM VW_EXPORT_TAXREGISTER_RPT WHERE KUSRID = @PKUSRID            
AND REGSTRID IN(16, 17, 19, 20) GROUP BY COMPYID, REGSTRID, TRANBTYPE ORDER BY REGSTRID, TRANBTYPE
                
END
GO

