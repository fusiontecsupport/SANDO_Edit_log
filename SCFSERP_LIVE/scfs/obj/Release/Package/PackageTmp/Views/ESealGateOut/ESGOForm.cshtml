
@using scfs_erp.Models;
@model scfs_erp.Models.GateOutDetail
@{
    ViewBag.Title = "E-Seal Gate Out Detail";
}
<style>
    .frm_hide {
        display: none;
    }
</style>

<link href="~/Content/Site.css" type="text/css" rel="stylesheet" />

<section id="main-content">
    <div class="col-md-12">
        <div class="row">
            <div class="col-xs-12">
                <div class="box">
                    <div class="box-header">
                        <div class="box-name">
                            <i class="glyphicon glyphicon-export"></i>
                            <strong>E-Seal Gate Out Detail</strong>
                        </div>
                    </div>
                    <div class="box-content" data-ng-app="myModule">
                        <form action="@Url.Content("~/ESealGateOut/savedata")" method="post" accept-charset="utf-8" id="esealgateoutform" data-ng-controller="myController" name="esealgateoutform" onsubmit="return Validate()">
                            @Html.ValidationSummary(true)
                            <fieldset id="GateOutDetailform_info">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="col-md-4 hide">
                                            <div class="form-group">
                                                <label>Primary  </label>
                                                @Html.TextBoxFor(model => model.GODID, new { @class = "form-control  GODID", @id = "GODID" })
                                                @Html.TextBoxFor(model => model.GODNO, new { @class = "form-control  GODNO", @id = "GODNO" })
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Date <span class="required-field"></span></label>
                                                @Html.TextBoxFor(model => Model.GODATE, "{0:dd/MM/yyyy}", new { @class = "form-control datepicker GODATE ", @id = "GODATE", @data_val = false, tabindex = "1" })
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Time<span class="required-field"></span> </label>                                              
                                                @Html.TextBoxFor(model => Model.GOTIME, "{0:HH:mm:ss}", new { @class = "form-control timepicker GOTIME", @id = "GOTIME", @data_val = false, tabindex = "1" })
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>No </label>
                                                @Html.TextBoxFor(model => Model.GONO, new { @class = "form-control GONO ", @id = "GONO", @data_val = false, @readonly = "readonly" })
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>V.Ticket No<span class="required-field"></span></label>
                                                @{
                                                    if (Model.GODID != 0)
                                                    {
                                                        <input type="text" value="@ViewBag.FVTDNO" id="FVTDNO" class=" form-control FVTDNO" name="FVTDNO" readonly="readonly" tabindex="2" />
                                                    }
                                                    else
                                                    {
                                                        <input type="text" value="" id="FVTDNO" class=" form-control FVTDNO" name="FVTDNO" onchange="GetVehicleDetail()" tabindex="2" />
                                                    }
                                                    @Html.TextBoxFor(model => Model.GIDID, new { @class = "hide form-control  GIDID ", @id = "GIDID", @data_val = false })
                                                }


                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Container No<span class="required-field"></span></label>
                                                @{
                                                    if (Model.GODID != 0)
                                                    {
                                                        <input type="text" value="@ViewBag.CONTNRNO" id="CONTNRNO" class=" form-control CONTNRNO" name="CONTNRNO" readonly="readonly" onchange="GetDetail()" />
                                                    }
                                                    else
                                                    {
                                                        <input type="text" value="" id="CONTNRNO" class=" form-control CONTNRNO" name="CONTNRNO" readonly="readonly" onchange="GetDetail()" />
                                                        @*@Html.DropDownList("GIDID", null, "---Select Container No---", new { @class = "form-control GIDID", @id = "GIDID", @data_val = "true", @data_val_required = "required", tabindex = "4", @onchange = "GetDetail()" })*@
                                                    }
                                                }

                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Size</label>
                                                <input type="text" value="" id="SIZE" class=" form-control SIZE" name="SIZE" readonly />

                                            </div>
                                        </div>
                                        <div class="col-md-2 hide">
                                            <div class="form-group">
                                                <label>Type</label>
                                                <input type="text" value="" id="CONTNRTCODE" class=" form-control CONTNRTCODE" name="CONTNRTCODE" readonly="readonly" />
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>In Date </label>
                                                <input type="text" value="" id="INDATE" placeholder="dd-MM-yyyy" class=" form-control INDATE" name="INDATE" readonly />
                                            </div>
                                        </div>
                                        <div class="col-md-2 hide">
                                            <div class="form-group">
                                                <label>IGM No</label>
                                                <input type="text" value="" id="FIGMNO" class=" form-control FIGMNO" name="FIGMNO" readonly="readonly" />

                                            </div>
                                        </div>
                                        <div class="col-md-2 hide">
                                            <div class="form-group">
                                                <label>Line No</label>
                                                <input type="text" value="" id="FLNO" class=" form-control FLNO" name="FLNO" readonly="readonly" />

                                            </div>
                                        </div>
                                        <div class="col-md-3 hide">
                                            <div class="form-group">
                                                <label>Cargo</label>
                                                <input type="text" value="" id="VTDESC" class=" form-control VTDESC" name="VTDESC" readonly="readonly" />

                                            </div>
                                        </div>
                                        <div class="col-md-3 hide">
                                            <div class="form-group">
                                                <label>Vessel</label>
                                                <input type="text" value="" id="FVSLNAME" class=" form-control FVSLNAME" name="FVSLNAME" readonly="readonly" />

                                            </div>
                                        </div>
                                        <div class="col-md-2 hide">
                                            <div class="form-group">
                                                <label>Voyage No</label>
                                                <input type="text" value="" id="FVOYNO" class=" form-control FVOYNO" name="FVOYNO" readonly="readonly" />

                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label>CHA</label>
                                                @Html.TextBoxFor(model => model.CHASNAME, new { @class = "form-control CHASNAME", @id = "CHASNAME", tabindex = "5", @readonly = "readonly" })
                                                @Html.TextBoxFor(model => model.CHAID, new { @class = "form-control hide CHAID", @id = "CHAID", tabindex = "5", @readonly = "readonly" })
                                                @*<input type="text" value="" id="CHANAME" class=" form-control CHANAME" name="CHANAME" readonly="readonly" />*@
                                            </div>

                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label>Transporter Name</label>
                                                <input type="text" value="" id="GOTRNSPRTNAME" class=" form-control GOTRNSPRTNAME" name="GOTRNSPRTNAME" readonly="readonly" />
                                            </div>

                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label>Exporter</label>
                                                <input type="text" value="" id="EXPRTRNAME" class=" form-control EXPRTRNAME" name="EXPRTRNAME" readonly="readonly" />
                                            </div>

                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label>Streamer</label>
                                                <input type="text" value="" id="STMRNAME" class=" form-control STMRNAME" name="STMRNAME" readonly="readonly" />
                                            </div>
                                        </div>


                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Vehicle No</label>
                                                @Html.TextBoxFor(model => model.VHLNO, new { @class = "form-control VHLNO", @id = "VHLNO", @required = "required", tabindex = "5", @readonly = "readonly" })
                                            </div>

                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Driver Name</label>
                                                @Html.TextBoxFor(model => model.GDRVNAME, new { @class = "form-control GDRVNAME", @id = "GDRVNAME", tabindex = "6", @required = "required", @readonly = "readonly" })
                                            </div>
                                        </div>


                                        <div class="col-md-2 hide">
                                            <div class="form-group">
                                                <label>Liner Seal No<span class="required-field"></span></label>
                                                @Html.TextBoxFor(model => model.LSEALNO, new { @class = "form-control LSEALNO", @id = "LSEALNO", tabindex = "7", @required = "required", @onkeydown = "return isAlphaNumberOnlyKey(event);", @readonly = "readonly" })

                                            </div>

                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>SANCO Seal No<span class="required-field"></span></label>
                                                @Html.TextBoxFor(model => model.SSEALNO, new { @class = "form-control SSEALNO", @id = "SSEALNO", tabindex = "8", @required = "required", @onkeydown = "return isAlphaNumberOnlyKey(event);", @readonly = "readonly" })

                                            </div>
                                        </div>


                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Mobile No</label>
                                                <input type="text" value="" id="DRVMBLNO" class=" form-control DRVMBLNO" name="DRVMBLNO" readonly="readonly" />
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Driving Licence No</label>
                                                <input type="text" value="" id="DRVLCNO" class=" form-control DRVLCNO" name="DRVLCNO" readonly="readonly" />
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Port</label>
                                                <input type="text" value="" id="Port" class=" form-control Port" name="Port" readonly="readonly" />
                                                @Html.TextBoxFor(model => Model.ESPORT, new { @class = "form-control hide ESPORT ", @id = "ESPORT", @data_val = false, tabindex = "3", @maxlength = "25" })
                                                @Html.TextBoxFor(model => model.GOOTYPE, new { @class = "form-control hide GOOTYPE", @id = "GOOTYPE" })
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>To Place</label>
                                                @Html.TextBoxFor(model => Model.ESTOPLACE, new { @class = "form-control ESTOPLACE ", @id = "ESTOPLACE", @data_val = false, tabindex = "4", @maxlength = "25" })

                                            </div>
                                        </div>


                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Invoice No</label>
                                                @Html.TextBoxFor(model => Model.ESINVNO, new { @class = "form-control ESINVNO ", @id = "ESINVNO", @data_val = false, tabindex = "5", @maxlength = "25" })
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Invoice Date</label>
                                                @Html.TextBoxFor(model => Model.ESINVDT, "{0:dd/MM/yyyy}", new { @class = "form-control datepicker ESINVDT ", @id = "ESINVDT", @data_val = false, tabindex = "6" })

                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Shipping Bill No</label>
                                                @Html.TextBoxFor(model => Model.ESSBLNO, new { @class = "form-control ESSBLNO ", @id = "ESSBLNO", @data_val = false, tabindex = "8", @maxlength = "25" })

                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>Shipping Bill Date</label>
                                                @Html.TextBoxFor(model => Model.ESSBLDT, "{0:dd/MM/yyyy}", new { @class = "form-control datepicker ESSBLDT ", @id = "ESSBLDT", @data_val = false, tabindex = "9" })

                                            </div>
                                        </div>


                                        <div class="col-md-12 box-footer">
                                            <a href="@Url.Action("Index", "ESealGateOut")" class="btn btn-primary btn-xs  pull-left" onclick="javascript:return confirm('Are you sure you want to go back?')" tabindex="9">Go Back</a>
                                            @*<input type="button" name="back" value="Go Back" class="btn btn-primary btn-xs  pull-left" onclick="JavaScript:history.back()" />*@
                                            <input type="button" name="submit" value="Submit" class="btn btn-success btn-xs" id="btnsave" tabindex="16" />
                                            <input type="submit" name="submit" value="Submit" class="btn btn-success btn-xs hide" id="btnsave" tabindex="16" />
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


@section Scripts{
    <script src="~/Scripts/CommonValidation.js" type="text/javascript"></script>
    <script>
        function GetFormattedDate(obj) {
            var MyDate_String_Value = obj;
            var value1 = new Date
                (
                    parseInt(MyDate_String_Value.replace(/(^.*\()|([+-].*$)/g, ''))
                );
            var dat = value1.getDate() +
                "/" +
                eval(value1.getMonth() + 1) +
                "/" +
                value1.getFullYear();
            return dat;
        }

        function GetVehicleDetail() {

            var id = $("#FVTDNO").val();

            var url = "/ESealGateOut/GetVehicleDetails/" + id;

            $.ajax({

                type: 'get',
                url: url, // we are calling json method

                dataType: 'json',

                success: function (data) {
                    if (data.length > 0) {
                        $("#GIDID").val(data[0].GIDID);
                        $("#CONTNRNO").val(data[0].CONTNRNO);
                        $("#SIZE").val(data[0].CONTNRSDESC);

                        //$("#INDATE").val(GetFormattedDate(data[0].GIDATE));
                        $("#INDATE").val(data[0].GIDATE);
                        $("#GOTRNSPRTNAME").val(data[0].GOTRNSPRTNAME);
                        $("#CHASNAME").val(data[0].CHANAME);
                        $("#STMRNAME").val(data[0].STMRNAME);
                        $("#EXPRTRNAME").val(data[0].EXPRTRNAME);

                        $("#CHAID").val(data[0].CHAID);

                        $("#VHLNO").val(data[0].VHLNO);
                        $("#GDRVNAME").val(data[0].DRVNAME);
                        $("#DRVMBLNO").val(data[0].DRVMBLNO);
                        $("#DRVLCNO").val(data[0].DRVLCNO);
                        $("#Port").val(data[0].Port);
                        $("#ESPORT").val(data[0].VTTYPE);


                        //$("#LSEALNO").val(data[0].CSEALNO);

                        $("#SSEALNO").val(data[0].VTSSEALNO);
                    }
                    else { alert("Vehicle Ticket Cannot be Added. !!"); }
                }
            });
        }

        $(function () {
            window.onbeforeunload = function () {
                $("input[type=submit]").attr("disabled", "disabled");
            };

            if ($(".GODID").val() == "") {
                $(".GODID").val("0");
            }

            $(".datepicker").removeAttr('GODATE', 'ESSBLDT', 'ESINVDT').removeClass('hasDatepicker');
            $(".datepicker").datepicker({ dateFormat: 'dd/mm/yy' });
            $('.timepicker').datetimepicker({
                datepicker: false,
                format: 'H:i'
            });

            if ($("#GODID").val() != "0") {
                var GODID = $("#GODID").val();

                var url = "/ESealGateOut/DetailEdit/" + GODID;

                $.ajax({

                    type: 'get',

                    url: url,

                    dataType: 'json',

                    success: function (data) {
                        $("#GIDID").val(data[0].GIDID);
                        $("#CONTNRNO").val(data[0].CONTNRNO);
                        $("#SIZE").val(data[0].CONTNRSDESC);
                        $('#FVTDNO').val(data[0].VTNO);
                        //$("#INDATE").val(GetFormattedDate(data[0].GIDATE));
                        $("#INDATE").val(data[0].GIDATE);
                        $("#GOTRNSPRTNAME").val(data[0].GOTRNSPRTNAME);
                        $("#CHASNAME").val(data[0].CHANAME);
                        $("#STMRNAME").val(data[0].STMRNAME);
                        $("#EXPRTRNAME").val(data[0].EXPRTRNAME);

                        $("#CHAID").val(data[0].CHAID);

                        $("#VHLNO").val(data[0].VHLNO);
                        $("#GDRVNAME").val(data[0].DRVNAME);
                        $("#DRVMBLNO").val(data[0].DRVMBLNO);
                        $("#DRVLCNO").val(data[0].DRVLCNO);
                        $("#Port").val(data[0].Port);
                        $("#ESPORT").val(data[0].VTTYPE);


                        //$("#LSEALNO").val(data[0].CSEALNO);

                        $("#SSEALNO").val(data[0].VTSSEALNO);


                    }
                });
            }

        });

        $("#btnsave").click(function () {
            flag = true;
            i = 0;
            if ($("#FVTDNO").val() == "") {
                //$('#FVTDNO').css('border-color', 'red');
                alert("Please Enter V.Ticket No. !!")
                //return false;
                flag = false;
                $('#FVTDNO').focus();
            }
            if (flag) {

                if ($('#CHAID').val() == "") { $('#CHAID').val() == "0"; }
                if ($('#ESPORT').val() == "") { $('#ESPORT').val() == "0"; }
                if ($('#CHAID').val() == "") { $('#CHAID').val() == "0"; }
                if ($('#GOOTYPE').val() == "") { $('#GOOTYPE').val() == "0"; }
                if ($('#ESTOPLACE').val() == "") { $('#ESTOPLACE').val() == "-"; }
                if ($('#ESINVNO').val() == "") { $('#ESINVNO').val() == "-"; }
                if ($('#ESINVDT').val() == "") { $('#ESINVDT').val() == "null"; }
                if ($('#ESSBLNO').val() == "") { $('#ESSBLNO').val() == "-"; }
                if ($('#ESSBLDT').val() == "") { $('#ESSBLDT').val() == "null"; }

                var tab = ($("#esealgateoutform").serialize());
                console.log(tab);
                $.ajax({
                    type: 'post',
                    url: '@Url.Action("EGOSaveData", "ESealGateOut")', // we are calling json method
                    data: tab,
                    success: function (data) {
                        if (data == "Exists") {
                            alert('Container number already exists ...!!')

                         var returnurl = '@Url.Action("Index", "ESealGateOut")';
                                        window.location.href = returnurl;
                            @*$('<div></div>').dialog({
                                modal: true,
                                title: "Alert",
                                open: function () {
                                    var markup = '<b>Container number already exists ...!!<b>';
                                    $(this).delay(1200).fadeOut(1000);
                                    $(this).html(markup);
                                },
                                buttons: {
                                    Ok: function () {
                                        $(this).dialog("close");
                                        var returnurl = '@Url.Action("Index", "ESealGateOut")';
                                        window.location.href = returnurl;
                                    }
                                }
                            });*@

                        }
                        else if (data == "Success") {
                            alert('Saved Successfully !!')

                         var returnurl = '@Url.Action("Index", "ESealGateOut")';
                                        window.location.href = returnurl;
                            @*$('<div></div>').dialog({
                                modal: true,
                                title: "Information",
                                open: function () {
                                    var markup = '<b>Saved Successfully !!<b>';
                                    $(this).delay(1200).fadeOut(1000);
                                    $(this).html(markup);
                                },
                                buttons: {
                                    Ok: function () {
                                        $(this).dialog("close");
                                        var returnurl = '@Url.Action("Index", "ESealGateOut")';
                                        window.location.href = returnurl;
                                    }
                                }
                            });*@

                        }
                    },
                    error: function (ex) {
                        alert('Failed to save data');
                    }
                });
            }
        });

    </script>


}