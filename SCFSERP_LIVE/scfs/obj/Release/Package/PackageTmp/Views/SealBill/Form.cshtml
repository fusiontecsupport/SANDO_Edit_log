@using scfs.Data;
@using scfs_erp.Models;
@model scfs_erp.Models.TransactionMD
@{
    ViewBag.Title = "Seal Invoice";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    #TDETAIL {
    }

    /*#TDETAIL td input {
      width:50%;
    }*/

    .TRANDAID {
        min-width: 200px;
    }

    .TRANDREFNAME {
        min-width: 250px;
    }

    /*.TRANDREFNO {
        max-width: 100%;
    }*/

    .TDETAILBANK td {
        text-align: center;
    }

    .small {
        border: 0;
        width: 30px;
        max-width: 25%;
        background: none;
    }

    .stk {
        background: #0f367d;
        color: #fff;
    }

    .sm-1 {
        max-width: 50px;
    }

    .TRANGAMT, .TRANNAMT, .TRANROAMT {
        max-width: 150px;
    }

    .gross {
        min-width: 800px;
    }

    .frm_hide {
        display: none;
    }

    .small {
        border: 0;
        width: 30px;
        max-width: 25%;
        background: none;
    }

    .medium {
        border: 0;
        width: 50px;
        max-width: 55%;
        background: none;
    }
</style>
<div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <div class="box-name">
                    <i class="fa fa-search"></i>
                    <strong>Seal Invoice</strong>
                </div>
            </div>
            <div class="box-content" data-ng-app="myModule">
                <form action="@Url.Content("~/SealBill/savedata")" method="post" accept-charset="utf-8" id="frm" data-ng-controller="myController" name="frm" onsubmit="return Validate()">
                    @Html.ValidationSummary(true)
                    <fieldset id="ExportCartingOrder_info">
                        <div class="row">
                            <div class="col-md-2 hidden">
                                <div class="form-group">
                                    <label>Primary  </label>
                                    @Html.TextBoxFor(model => model.masterdata[0].TRANMID, new { @class = "form-control  TRANMID", @id = "TRANMID" })
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Bill Type </label>
                                    @Html.DropDownList("TRANBTYPE", null, new { @class = "form-control TRANBTYPE", @id = "TRANBTYPE", tabindex = "1" })

                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Billed To</label>
                                    @Html.DropDownList("REGSTRID", null, new { @class = "form-control REGSTRID", @id = "REGSTRID", tabindex = "2" })
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>No</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANNO, new { @class = "form-control  TRANNO", @id = "TRANNO", @readonly = "readonly" })
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Date/Time </label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANTIME, new { @class = "form-control datetime  TRANTIME", @id = "TRANTIME", @data_val = false, @onblur = "test()", tabindex = "3" })
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Labour  </label>
                                    @Html.DropDownList("LCATEID", null, "<---select--->", new { @class = "form-control LCATEID", @id = "LCATEID", tabindex = "4" })
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>CHA  </label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFNAME, new { @class = "form-control  TRANREFNAME", @id = "TRANREFNAME", data_autocomplete_url = Url.Action("AutoCha", "SealBill"), placeholder = "Please Select CHA Name", tabindex = "5" })
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFID, new { @class = "hide form-control TRANREFID", @id = "TRANREFID" })

                                    <input type="text" value="" id="DDATE" class="hide form-control DDATE" name="DDATE" style="width:95px" />
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Seal No  </label>

                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANLMNO, new { @class = "hide form-control TRANLMNO", @id = "TRANLMNO" })

                                    @if (Model.masterdata != null)
                                    {
                                        @*<input type="text" class="form-control TRANLMID" name="TRANLMID" id="TRANLMID" value="@Model.masterdata[0].TRANLMID"/>*@
                                        <select class="form-control TRANLMID" name="TRANLMID" id="TRANLMID"><option value="@Model.masterdata[0].TRANLMID">@Model.masterdata[0].TRANLMNO</option></select>
                                    }
                                    else
                                    {
                                        @Html.DropDownList("TRANLMID", null, "Select CHA", new { @class = "form-control TRANLMID", @id = "TRANLMID", @onchange = "GetDetail()", tabindex = "7" })
                                    }
                                    <input type="text" value="@ViewBag.SLABTID" id="ETOPID" class="hide form-control ETOPID" name="ETOPID" style="width:95px" />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Tariff Group</label>

                                    @Html.DropDownList("TARIFFGID", null, "Please Choose An Option", new { @class = "form-control TARIFFGID", @id = "TARIFFGID", @onchange = "GetTariff()", tabindex = "9" })

                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Tariff </label>

                                    @Html.DropDownList("TARIFFMID", null, "<---select--->", new { @class = "form-control TARIFFMID", @id = "TARIFFMID", tabindex = "12" })
                                    <input type="text" value="" id="TARIFFTMID" class="hide form-control TARIFFTMID" name="TARIFFTMID" style="width:95px" />
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label>Exporter</label>
                                    <input type="text" id="F_EXPRTNAME" class="form-control F_EXPRTNAME" name="F_EXPRTNAME" readonly />
                                </div>
                            </div>
                            <input type="text" id="pd_index" value="0" style="display:none">

                            <div style="float:right">
                            </div>
                            <div style="clear:both"> </div>
                        </div>

                        @if (Model.detaildata != null)
                        {
                            <div class="panel-heading navbar-inverse" style="color:white">Seal Bill Details</div>

                            <table class="table table-striped table-bordered bootstrap-datatable TDETAIL" id="TDETAIL">
                                <thead>
                                    <tr>
                                        <th><input type='checkbox' id='CHCK_ALL' name='CHCK_ALL' class='CHCK_ALL hidden' onchange="checkall()" /></th>
                                        <th>
                                            Container No
                                        </th>
                                        <th>
                                            Size
                                        </th>
                                        <th>
                                            In Date
                                        </th>
                                        <th>
                                            Storage Date
                                        </th>
                                        <th>
                                            Charge Date
                                        </th>
                                        <th>
                                            Storage
                                        </th>
                                        <th>
                                            Handling
                                        </th>
                                        <th>
                                            Energy
                                        </th>
                                        <th>
                                            Fuel
                                        </th>
                                        <th>
                                            PTI
                                        </th>
                                        <th>
                                            Total
                                        </th>

                                    </tr>
                                </thead>

                                <tbody>
                                    @foreach (pr_Export_Invoice_Stuff_Flx_Assgn_Result details in Model.viewdata)
                                    {
                                        var st = ""; var bt = "";

                                        if (details.TRANDID != 0) { st = "checked"; bt = "true"; }
                                        else { bt = "false"; st = ""; }


                                        <tr>
                                            <td>
                                                <input class="STFDIDS" id="STFDIDS" name="STFDIDS" onchange="total()" type="checkbox" value="" @st>
                                                <input class="hide boolSTFDIDS" id="boolSTFDIDS" name="boolSTFDIDS" type="text" value="@bt">
                                            </td>
                                            <td class="hide">
                                                <input class="STFDID" id="STFDID" name="STFDID" type="text" value="@details.STFDID" style="width:42px">
                                            </td>
                                            <td class="col-md-3">
                                                <input class="TRANDREFNO" id="TRANDREFNO" name="TRANDREFNO" type="text" value="@details.CONTNRNO" style="width:102px" readonly>
                                            </td>
                                            <td class="col-md-1">
                                                <input class="SIZE" id="SIZE" name="SIZE" type="text" value="@details.CONTNRSDESC" style="width:42px" readonly>
                                            </td>
                                            <td class="col-md-3">
                                                <input class="TRANIDATE" id="TRANIDATE" name="TRANIDATE" type="text" value="@details.GIDATE" readonly>
                                            </td>
                                            <td class="col-md-3">
                                                <input class="TRANSDATE" id="TRANSDATE" name="TRANSDATE" type="text" value="@details.SBDDATE" readonly>
                                            </td>
                                            <td class="col-md-3">
                                                <input class="datepicker TRANEDATE" id="TRANEDATE" name="TRANEDATE" type="text" value="@details.GODATE" onchange="calculation()">
                                            </td>
                                            <td class="col-md-2">
                                                <input class="TRANDSAMT" id="TRANDSAMT" name="TRANDSAMT" type="text" value="@details.TRANDSAMT" style="width:65px" readonly>
                                            </td>
                                            <td class="col-md-2">
                                                <input class="TRANDHAMT" id="TRANDHAMT" name="TRANDHAMT" type="text" value="@details.TRANDHAMT" style="width:65px" readonly>
                                            </td>
                                            <td class="col-md-2">
                                                <input class="TRANDEAMT" id="TRANDEAMT" name="TRANDEAMT" style="width:45px" type="text" value="@details.TRANDEAMT" readonly>
                                            </td>
                                            <td class="col-md-2">
                                                <input class="TRANDFAMT" id="TRANDFAMT" name="TRANDFAMT" style="width:45px" type="text" value="@details.TRANDFAMT" readonly>
                                            </td>
                                            <td class="col-md-2">
                                                <input class="TRANDPAMT" id="TRANDPAMT" name="TRANDPAMT" type="text" value="@details.TRANDPAMT" style="width:65px" readonly>
                                            </td>
                                            <td class="col-md-2">
                                                <input class="TRANDNAMT" id="TRANDNAMT" name="TRANDNAMT" style="width:70px" type="text" value="@details.TRANDNAMT" readonly>
                                            </td>





                                            <td class="hide">
                                                <input class="SLABMIN" id="SLABMIN" name="SLABMIN" style="display:none1" type="text" value="0"><input class="SLABMAX" id="SLABMAX" name="SLABMAX" style="display:none1" type="text" value="0"><input class="SLABMIN1" id="SLABMIN1" name="SLABMIN1" style="display:none1" type="text" value="0"><input class="SLABMAX1" id="SLABMAX1" name="SLABMAX1" style="display:none1" type="text" value="0"><input class="SLABMIN2" id="SLABMIN2" name="SLABMIN2" style="display:none1" type="text" value="0"><input class="SLABMAX2" id="SLABMAX2" name="SLABMAX2" style="display:none1" type="text" value="0">
                                                <input class="SLABMAX3" id="SLABMAX3" name="SLABMAX3" style="display:none1" type="text" value="0"><input class="SLABMIN3" id="SLABMIN3" name="SLABMIN3" style="display:none1" type="text" value="0"><input class="SLABMAX4" id="SLABMAX4" name="SLABMAX4" style="display:none1" type="text" value="0"><input class="SLABMIN4" id="SLABMIN4" name="SLABMIN4" style="display:none1" type="text" value="0"><input class="SLABMAX5" id="SLABMAX5" name="SLABMAX5" style="display:none1" type="text" value="0"><input class="SLABMIN5" id="SLABMIN5" name="SLABMIN5" style="display:none1" type="text" value="0">
                                                <input class="SLABMAX6" id="SLABMAX6" name="SLABMAX6" style="display:none1" type="text" value="0"><input class="SLABMIN6" id="SLABMIN6" name="SLABMIN6" style="display:none1" type="text" value="0">
                                            </td>







                                            <td class="hide">
                                                <input class="TRANDNOP" id="TRANDNOP" name="TRANDNOP" type="text" value="@details.STFDNOP" readonly>

                                                <input class="TRANDQTY" id="TRANDQTY" name="TRANDQTY" type="text" value="@details.STFDQTY">

                                                @*<input class="CONTNRTID" id="CONTNRTID" name="CONTNRTID" type="text" value="@details.CONTNRTID">*@

                                                <input class="CONTNRSID" id="CONTNRSID" name="CONTNRSID" type="text" value="@details.CONTNRSID">

                                                <input class="TRANDREFID" id="TRANDREFID" name="TRANDREFID" type="text" value="@details.GIDID">
                                                <input class="TRANDID" id="TRANDID" name="TRANDID" style="display:none" type="text" value="@details.TRANDID">
                                                <input class="RAMT1" id="RAMT1" name="RAMT1" style="display:none1" type="text" value="@details.RAMT1">
                                                <input class="RAMT2" id="RAMT2" name="RAMT2" style="display:none1" type="text" value="@details.RAMT2">
                                                <input class="RAMT3" id="RAMT3" name="RAMT3" style="display:none1" type="text" value="@details.RAMT3">
                                                <input class="RAMT4" id="RAMT4" name="RAMT4" style="display:none1" type="text" value="@details.RAMT4">
                                                <input class="RAMT5" id="RAMT5" name="RAMT5" style="display:none1" type="text" value="@details.RAMT5">
                                                <input class="RAMT6" id="RAMT6" name="RAMT6" style="display:none1" type="text" value="@details.RAMT6">
                                                <input class="RAMT7" id="RAMT7" name="RAMT7" type="text" value="@details.RAMT7">
                                                <input class="days" id="days" name="days" style="display:none" type="text" value="0">
                                                <input class="RCAMT1" id="RCAMT1" name="RCAMT1" style="display:none1" type="text" value="@details.RCAMT1">
                                                <input class="RCAMT2" id="RCAMT2" name="RCAMT2" style="display:none1" type="text" value="@details.RCAMT2">
                                                <input class="RCAMT3" id="RCAMT3" name="RCAMT3" style="display:none1" type="text" value="@details.RCAMT3">
                                                <input class="RCAMT4" id="RCAMT4" name="RCAMT4" style="display:none1" type="text" value="@details.RCAMT4">
                                                <input class="RCAMT5" id="RCAMT5" name="RCAMT5" style="display:none1" type="text" value="@details.RCAMT5">
                                                <input class="RCAMT6" id="RCAMT6" name="RCAMT6" style="display:none1" type="text" value="@details.RCAMT6">
                                                <input class="RCAMT7" id="RCAMT7" name="RCAMT7" type="text" value="@details.RCAMT7">
                                            </td>
                                            <td class="hide">
                                                <input class="RCOL1" id="RCOL1" name="RCOL1" style="display:none1" type="text" value="@details.RCOL1">
                                                <input class="RCOL2" id="RCOL2" name="RCOL2" style="display:none1" type="text" value="@details.RCOL2">
                                                <input class="RCOL3" id="RCOL3" name="RCOL3" style="display:none1" type="text" value="@details.RCOL3">
                                                <input class="RCOL4" id="RCOL4" name="RCOL4" style="display:none1" type="text" value="@details.RCOL4">
                                                <input class="RCOL5" id="RCOL5" name="RCOL5" style="display:none1" type="text" value="@details.RCOL5">
                                                <input class="RCOL6" id="RCOL6" name="RCOL6" style="display:none1" type="text" value="@details.RCOL6">
                                                <input class="RCOL7" id="RCOL7" name="RCOL7" style="display:none1" type="text" value="@details.RCOL7">
                                            </td>

                                        </tr>
}
                                </tbody>
                            </table>

                        }
                        else
                        {<div id="ramt"></div>
                            <div id="job_list">
                                @*@ViewBag.test*@
                            </div>
                        }



                        <table class='table table-striped table-bordered bootstrap-datatable'>
                            <tr>
                                <td><a href='#' id='cfact' class='btn btn-success btn-xs'><i class=glyphicon-plus></i> Tax</a>  </td>
                                <td align='right' colspan='4' class="gross">  Gross Amount </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANGAMT, new { @class = "form-control  TRANGAMT", @id = "TRANGAMT", @readonly = true })
                                </td>

                            </tr>

                            <tr>

                                <td colspan="6" class="cf_dynamic ">

                                    <table class='table table-striped table-bordered bootstrap-datatable' id='CFACTOR' style="padding:0;margin:0">
                                        <tr> <td> </td> <td>Cost Factror</td> <td colspan='3' class='col-lg-0'>Expression  & Nos </td> <td class='col-lg-0'>Mode</td> <td> </td> </tr>

                                        @if (Model.costfactor != null)
                                        {

                                            string exp = "";
                                            string mod = "";
                                            foreach (TransactionMasterFactor cfdetails in Model.costfactor)
                                            {
                                                exp = "";
                                                mod = "";



                                                if (cfdetails.DEDTYPE == 0)
                                                { exp = "selected"; }
                                                if (cfdetails.DEDMODE != "0")
                                                { mod = "selected"; }

                                                <tr>
                                                    <td> <button type='button' onclick='del_factor(this)' class='btn btn-danger dfact btn-xs'><i class=glyphicon-minus></i> </button>  </td>
                                                    <td>
                                                        <input type=text name='TAX' id=TAX style='display:none' class=TAX value="@cfdetails.CFID">
                                                        @cfdetails.DEDCFDESC
                                                        <input type=text name=CFDESC id=CFDESC class='CFDESC hide' value="@cfdetails.DEDCFDESC" onchange='total()'>
                                                    </td>
                                                    <td class='col-lg-1'><select id=CFTYPE name=CFTYPE class=CFTYPE onchange='total()'><option value='1'> %</option><option value='0' @exp>Value </option> </select></td>
                                                    <td class='col-lg-1'><input type=text id=DEDNOS name=DEDNOS class='DEDNOS' style="width:55px" value="@cfdetails.DEDNOS" onchange='totalonchange(this)'></td>
                                                    <td class='col-lg-1'><input type=text id=CFEXPR name=CFEXPR class=CFEXPR value="@cfdetails.DEDEXPRN" onchange='totalonchange(this)'>   </td>
                                                    <td><select id=CFMODE name=CFMODE class=CFMODE onchange='total()'><option value='0'>+</option><option value='1' @mod>-</option> </select><input type=text id=DORDRID name=DORDRID style='display:none' class=DORDRID value="@cfdetails.DORDRID" onchange='total() '></td>
                                                    <td class="col-lg-0"><input type=text readonly="readonly" value="@cfdetails.DEDVALUE" name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT col-lg-0' onchange='totalonchange(this)'> <input type=text value='-1' style='display:none' name=TMPCFVAL id='TMPCFVAL' class='TMPCFVAL'><input style='display:none' type=text value="@cfdetails.TRANMFID" name=TRANMFID id='TRANMFID' class='TRANMFID'>  </td>
                                                </tr>
                                            }
                                        }
                                        else
                                        {
                                            <tr>
                                                <Td> <button href='#' type='button' onclick='del_factor(this)' class='btn btn-danger dfact btn-xs'><i class=glyphicon-minus></i> </button>  </Td>
                                                <td><input type=text name=TAX id='TAX' class='hide TAX' value=''><input type=text name=CFDESC id='CFDESC' class='CFDESC' value='' style="border:none" readonly></td>
                                                <td class='col-lg-1'> <select id='CFTYPE' name='CFTYPE' class='CFTYPE' onchange='total()'> <option value='1'>  %</option><option value='0'>Value </option> </select></td>
                                                <td class='col-lg-1'><input type='text' id='DEDNOS' class='DEDNOS' name='DEDNOS' value='0' readonly='readonly' style='width:50px'></td>
                                                <td class='col-lg-1'> <input onchange='total()' type=text value='' class='CFEXPR' name='CFEXPR' id='CFEXPR' readonly> </td>
                                                <td><select onchange='total()' class='CFMODE' id='CFMODE' name='CFMODE'> <option value='0'>  +</option><option value='1'>-</option> </select></td>
                                                <td><input type=text value='' name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT' readonly='readonly'> </td>
                                                <input type='text' id='DORDRID' value='' class='DORDRID' style='display:none' name='DORDRID'>
                                                <input type=text value='0' style='display:none' name=TMPCFVAL id='TMPCFVAL' class='TMPCFVAL'>
                                                <input type=text value='0' style='display:none' name=TRANMFID id='TRANMFID' class='TRANMFID'>
                                                <input type=text value='0' style='display:none' name=DEDORDR id='DEDORDR' class='DEDORDR'>
                                            </tr>


                                            <tr>
                                                <Td> <button href='#' type='button' onclick='del_factor(this)' class='btn btn-danger dfact btn-xs'><i class=glyphicon-minus></i> </button>  </Td>
                                                <td><input type=text name=TAX id='TAX' class='hide TAX' value=''><input style="border:none" type=text name=CFDESC id='CFDESC' class='CFDESC' value='' readonly></td>
                                                <td class='col-lg-1'> <select id='CFTYPE' name='CFTYPE' class='CFTYPE' onchange='total()'> <option value='1'>  %</option><option value='0'>Value </option> </select></td>
                                                <td class='col-lg-1'><input type='text' id='DEDNOS' class='DEDNOS' name='DEDNOS' value='0' readonly='readonly' style='width:50px'></td>
                                                <td class='col-lg-1'> <input onchange='total()' type=text value='' class='CFEXPR' name='CFEXPR' id='CFEXPR' readonly> </td>
                                                <td><select onchange='total()' class='CFMODE' id='CFMODE' name='CFMODE'> <option value='0'>  +</option><option value='1'>-</option> </select></td>
                                                <td><input type=text value='' name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT' readonly='readonly'> </td>
                                                <input type='text' id='DORDRID' value='' class='DORDRID' style='display:none' name='DORDRID'>
                                                <input type=text value='0' style='display:none' name=TRANMFID id='TRANMFID' class='TRANMFID'>
                                                <input type=text value='0' style='display:none' name=TMPCFVAL id='TMPCFVAL' class='TMPCFVAL'>
                                                <input type=text value='0' style='display:none' name=DEDORDR id='DEDORDR' class='DEDORDR'>
                                            </tr>
                                            <tr id="TMP_KKC" class="frm_hide">
                                                <Td> <button href='#' type='button' onclick='del_factor(this)' class='btn btn-danger dfact btn-xs'><i class=glyphicon-minus></i> </button>  </Td>
                                                <td><input type=text name=TAX id='TAX' class='hide TAX' value=''><input style="border:none" type=text name=CFDESC id='CFDESC' class='CFDESC' value='' readonly></td>
                                                <td class='col-lg-1'> <select id='CFTYPE' name='CFTYPE' class='CFTYPE' onchange='total()'> <option value='1'>  %</option><option value='0'>Value </option> </select></td>
                                                <td class='col-lg-1'><input type='text' id='DEDNOS' class='DEDNOS' name='DEDNOS' value='0' readonly='readonly' style='width:50px'></td>
                                                <td class='col-lg-1'> <input onchange='total()' type=text value='' class='CFEXPR' name='CFEXPR' id='CFEXPR' readonly> </td>
                                                <td><select onchange='total()' class='CFMODE' id='CFMODE' name='CFMODE'> <option value='0'>  +</option><option value='1'>-</option> </select></td>
                                                <td><input type=text value='' name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT' readonly='readonly'> </td>
                                                <input type='text' id='DORDRID' value='' class='DORDRID' style='display:none' name='DORDRID'>
                                                <input type=text value='0' style='display:none' name=TRANMFID id='TRANMFID' class='TRANMFID'>
                                                <input type=text value='0' style='display:none' name=TMPCFVAL id='TMPCFVAL' class='TMPCFVAL'>
                                                <input type=text value='0' style='display:none' name=DEDORDR id='DEDORDR' class='DEDORDR'>
                                            </tr>
                                        }
                                    </table>
                                </td>

                            </tr>
                            <tr>
                                <td>   </td>
                                <td colspan='4' align='right'> Rounding Off </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANROAMT, new { @class = "form-control  TRANROAMT ", @id = "TRANROAMT", @readonly = true })
                                </td>
                            </tr>
                            <tr>
                                <td>   </td>
                                <td colspan='4' align='right'> Net Amount </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANNAMT, new { @class = "form-control  TRANNAMT ", @id = "TRANNAMT", @readonly = true })
                                </td>
                            </tr>
                        </table>



                        <fieldset style="width:100%">
                            <legend style="font-size:large">Bank Details</legend>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Mode</label>
                                    <br />
                                    @Html.DropDownList("TRANMODE", null, "Select", new { @class = "form-control TRANMODE", @id = "TRANMODE", @onchange = "ModeChange()", tabindex = "5000" })
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANMODEDETL, new { @class = "hide form-control  TRANMODEDETL", @id = "TRANMODEDETL" })


                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Number</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFNO, new { @class = "form-control  TRANREFNO", @id = "TRANREFNO", tabindex = "5001" })
                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Date</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFDATE, "{0:dd/MM/yyyy}", new { @class = "form-control  datepicker TRANREFDATE", @id = "TRANREFDATE", @data_val = false, tabindex = "5002" })
                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Amount</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFAMT, new { @class = "form-control  TRANREFAMT", @id = "TRANREFAMT", tabindex = "5003" })
                                </div>
                            </div>
                            <div class=" col-md-4">
                                <div class="form-group">
                                    <label>Bank</label>
                                    @Html.DropDownList("BANKMID", null, "Please Select an Option", new { @class = "form-control BANKMID", @id = "BANKMID", tabindex = "5004" })

                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFBNAME, new { @class = "hide form-control  TRANREFBNAME", @id = "TRANREFBNAME" })
                                </div>
                            </div>
                            <div class=" col-md-8">
                                <div class="form-group">
                                    <label>Remarks</label>
                                    @Html.TextAreaFor(model => Model.masterdata[0].TRANRMKS, 4, 8, new { @class = "form-control  TRANRMKS", @id = "TRANRMKS", tabindex = "5005" })
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANNARTN, new { @class = "form-control hide TRANNARTN", @id = "TRANNARTN" })
                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Status </label>
                                    @Html.DropDownList("DISPSTATUS", null, new { @class = "form-control DISPSTATUS", @id = "DISPSTATUS", tabindex = "5006" })


                                </div>
                            </div>

                        </fieldset>
                        <div class="hidden">
                            <input type="text" id="TRANTCAMT" class="TRANTCAMT hidden1" name="TRANTCAMT" />
                            <input type="text" id="TRANSAMT" class="TRANSAMT hidden1" name="TRANSAMT" />
                            <input type="text" id="TRANHAMT" class="TRANHAMT hidden1" name="TRANHAMT" />
                            <input type="text" id="TRANEAMT" class="TRANEAMT hidden1" name="TRANEAMT" />
                            <input type="text" id="TRANFAMT" class="TRANFAMT hidden1" name="TRANFAMT" />
                            <input type="text" id="TRANPAMT" class="TRANPAMT hidden1" name="TRANPAMT" />
                            <input type="text" id="TRANAAMT" class="TRANAAMT hidden1" name="TRANAAMT" />
                        </div>
                        <div class="col-md-12 box-footer">
                            <input type="button" name="back" value="Go Back" class="btn btn-primary btn-xs  pull-left" onclick="JavaScript:history.back()" />
                            <input type="button" name="submit2" value="Save as Estimate" class="btn btn-warning btn-xs hidden " hidden />
                            <input type="submit" name="submit" value="Submit" class="btn btn-success btn-xs  " id="save" tabindex="5011" />

                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script src="~/Scripts/Invoice-costfactor.js"></script>
    <script type="text/javascript">


        $(document).ready(function () {
            window.onbeforeunload = function () {
                $("input[type=submit]").attr("disabled", "disabled");
            };

            stuffing_autocomplete($("#TRANREFNAME"), "TRANREFNAME,TRANREFID");//---AUTOCOMPLETE FUNCTION FOR GET DETAIL GRID-----

            //-----date controls-------------
            $(".datepicker").datepicker({ dateFormat: 'dd/mm/yy', });
            $('.datetime').datetimepicker({
                dateFormat: 'dd/mm/yy',
                timeFormat: 'hh:mm'
            });
            //$('.time').timepicker();

            if ($("#TRANMID").val() == 0) {
                var dt = new Date();
                var month = dt.getMonth() + 1;
                var date = dt.getDate() + "/" + month + "/" + dt.getFullYear();
                var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();
                var datetme = time;
                $(".TRANTIME").val(date + " " + datetme);
            }
            else {
                $.ajax({
                    url: "/SealBill/GetOPTYP/" + $(".TRANLMID").val(),
                    success: function (data) {

                        $(".ETOPID").val(data[0].SLABTID);
                        $(".F_EXPRTNAME").val(data[0].EXPRTNAME);
                    }
                });
            }
            //...End of date contrl..
            ModeChange();
            //.......GET BANK NAME FROM DROPDOWN VALUE ...........
            $("#BANKMID").change(function () {
                var TRANREFBNAME = $(".BANKMID option:selected").text();
                $(".TRANREFBNAME").val(TRANREFBNAME);
            });
            //...END

            // .............VALIDATION FOR TARIFF BEFORE SELECT CHA...........

            $(".TARIFFMID").on("focus", function () {
                var CHAID = $(".TRANREFID").val();
                if (CHAID == "") {
                    alert("Please Select CHA First");
                    $("#TARIFFMID").hide();
                    //$('TARIFFMID option:eq(0)').removeAttr('selected');
                }

                return false;
            });
            $("#TRANREFNAME").focus(function () {
                var TRANREFID = $(".TRANREFID").val();
                $("#TARIFFMID").show();
            }); //........END OF VALIDATION


            //...........Calculation on Tariff Change........//
            $(".TARIFFMID").change(function () {


                calculation();
                total();

            });
            //.....End

            //.........TARIFFMTID FROM TARIFFMASTER.....................//
            $("#TARIFFMID").on("blur", function () {
                var TARIFFTMID = $("#TARIFFMID option:selected").val();
                var url = "/SealBill/TARIFFTMID/" + TARIFFTMID;
                $.ajax({
                    url: url,
                    dataType: 'json',
                    async: false,
                    success: function (data) {

                        $(".TARIFFTMID").val(data);
                    }

                });//----End of function
            });

        });

        //......end
        //.......................TRANMODE change event..................//

        function ModeChange() {
            var modeval = $("#TRANMODE").val();
            if ($("#TRANMID").val() == "0") {
                var TRANMODEVAL = $("#TRANMODE option:selected").text();
                $(".TRANMODEDETL").val(TRANMODEVAL);
                $("#TRANREFNO").val("");
                $("#TRANREFDATE").val("");
                $("#BANKMID").val("");
            }
            if (modeval != 2 && modeval != 3) {
                $("#TRANREFNO").attr('disabled', true);
                $("#TRANREFDATE").attr('disabled', true);
                $("#BANKMID").attr('disabled', true);
            }
            else {
                $("#TRANREFNO").attr('disabled', false);
                $("#TRANREFDATE").attr('disabled', false);
                $("#BANKMID").attr('disabled', false);
            }
        }
        //.............End



        //...............Window bind..........................//

        $(window).bind("load", function () {
            if ($(".TRANMID").val() == "") {
                $(".TRANMID").val("0");
            }
            if ($(".TRANDID").val() == "") {
                $(".TRANDID").val("0");
            }




            count = 500;
            $('.TRANDID').each(function (k) {

                $("#TDETAIL #STFDIDS,#TRANEDATE").attr('tabindex', count++);
            });

            txcount = 1000;
            $('.TAX').each(function (k) {

                $("#CFACTOR input:text,#CFACTOR select,#CFACTOR a").attr('tabindex', txcount++);
            });
            //..........Displaying Cost Factor insert mode....//
            if ($(".TRANMID").val() == 0) {
                base = window.location.origin;
                var $tableBody = $('#CFACTOR').find("tbody"),
                 $trLast = $tableBody.find("tr:last");
                $.ajax({
                    url: base + "/SealBill/DefaultCF",
                    type: "POST",

                    success: function (data, textStatus, jqXHR) {
                        //data - response from server
                        // alert(data);

                        for (var i = 0; i < data.length; i++) {
                            //  alert(data.length + "........" + data[i].CFEXPR + "..." + data[i].CFID + "...." + data[i].CFDESC);

                            $(".TAX")[i].value = data[i].CFID;
                            $(".CFDESC")[i].value = data[i].CFDESC;
                            $(".CFEXPR")[i].value = data[i].CFEXPR;
                            $(".CFTYPE")[i].value = data[i].CFTYPE;
                            $(".CFMODE")[i].value = data[i].CFMODE;
                            $(".DORDRID")[i].value = data[i].DORDRID;
                        }
                        if (data[2].DISPSTATUS == 1) {
                            $("#TMP_KKC").addClass("frm_hide");
                        } else {
                            $("#TMP_KKC").removeClass("frm_hide");
                        }

                    },
                    error: function (jqXHR, textStatus, errorThrown) {

                    }
                });
                ModeChange(); calculation();
            }//....................end
            else {
                total();
            }




            i = 0; var tnos = 0; var fnos = 0;
            $(".STFDIDS").each(function () {

                TRANDID = $(".TRANDID")[i].value;
                if (TRANDID == 0) {
                    if ($(".TRANEDATE")[i].value == "") {
                        var M_date = $(".TRANTIME").val();
                        $(".TRANEDATE")[i].value = M_date;

                    }
                }
                CONTNRSID = $(".CONTNRSID")[i].value;

                if (CONTNRSID == 3) tnos = tnos + 1;
                if (CONTNRSID >= 4) fnos = fnos + 1;

                $(".TRANNARTN").val(tnos + " * " + "20" + "  " + fnos + " * " + "40");
                i++;

            });
        });//.......end of bind


        //..................FUNCTION TO GET DETAIL GRID..............

        function stuffing_autocomplete($obj, controls) {
            var oldFn = $.ui.autocomplete.prototype._renderItem;
            $.ui.autocomplete.prototype._renderItem = function (ul, item) {
                var re = new RegExp(this.term, "i");
                var t = item.label.replace(re, "<strong style='font-weight:bold;background:#C7DFFE;border-radius:2px;border:1px solid #98B8E1'>" + this.term + "</strong>");
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<a>" + t + "</a>")
                    .appendTo(ul);
            };
            $obj.autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: $obj.data("autocomplete-url"),
                        type: "POST",
                        dataType: "json",
                        data: {
                            term: request.term
                        },
                        success: function (data) {
                            response($.map(data, function (item) {
                                count = 0;
                                item_str = "";
                                var jsonArg = new Object();
                                count = 0;
                                $.each(item, function (i, data) {
                                    switch (count) {
                                        case 0:
                                            jsonArg.label = data;
                                            jsonArg.value = data;
                                            break;
                                        case 1:
                                            jsonArg.id = data;
                                            break;
                                        case 2:
                                            jsonArg.desc = data;
                                            break;
                                        case 3:
                                            jsonArg.xparam1 = data;
                                            break;
                                        case 4:
                                            jsonArg.xparam2 = data;
                                            break;
                                        case 5:
                                            jsonArg.xparam3 = data;
                                            break
                                    }
                                    count++
                                });
                                return jsonArg
                            }))
                        }
                    })
                },
                search: function () {
                    var term = extractLast(this.value);
                    if (term.length < 2) {
                        return false
                    }
                },
                select: function (event, ui) {
                    $(this).val(ui.item.label);
                    count = 0;
                    $.each(controls.split(','), function (index, value) {
                        switch (count) {
                            case 1:
                                $("#" + value).val(ui.item.id);
                                break;
                            case 2:
                                $("#" + value).val(ui.item.desc);
                                break;
                            case 3:
                                $("#" + value).val(ui.item.xparam1);
                                break;
                            case 4:
                                $("#" + value).val(ui.item.xparam2);
                                break;
                            case 5:
                                $("#" + value).val(ui.item.xparam3);
                                break;
                        }
                        count++
                    });

                 //   alert('@Url.Action("GetSealNo", "SealBill")?id=' + $(".TRANREFID").val());
                    $(".TRANLMID").empty(); $("#job_list").html("");
                    $.ajax({

                        type: 'get',
                        url: '@Url.Action("GetSealNo", "SealBill")?id=' + $(".TRANREFID").val(), // we are calling json method

                        success: function (data) {
                             //alert(data);
                            $(".TRANLMID").append('<option>Select</option>');
                            $.each(data, function (i, dataval) {
                                $(".TRANLMID").append('<option value="' + dataval.STFMID + '">' + dataval.STFMDNO + '</option>');

                            });

                        },
                        error: function (ex) {
                            alert('Failed to data ' + ex);
                        }
                    });

                    return false;
                },
                messages: {
                    noResults: "",
                    results: ""
                }
            })
        }////......end

        //........DATE DIFFERENCE.....................
        function datdidff(start_date, end_date) {
            //start_date = start_date.split("/");
            //end_date = end_date.split("/");

            if (start_date.match("/")) { start_date = start_date.split("/"); }
            else if (start_date.match("-")) { start_date = start_date.split("-"); }

            if (end_date.match("/")) { end_date = end_date.split("/"); }
            else if (end_date.match("-")) { end_date = end_date.split("-"); }
            start_date = start_date[2] + "-" + start_date[1] + "-" + start_date[0];
            end_date = end_date[2] + "-" + end_date[1] + "-" + end_date[0];

            var diff = Math.floor((Date.parse(end_date.replace(/-/g, '\/')) - Date.parse(start_date.replace(/-/g, '\/'))) / 86400000);

            return diff;

        }//......end

        //......Storage Calculation............//
        function calculation() {

            var CHRGETYPE = $("#TRANBTYPE option:selected").val();
            var TARIFFMID = $("#TARIFFMID").val();
            var CHAID = $("#TRANREFID").val();
            i = 0;

            $(".STFDIDS").each(function () {

                $(".RAMT1")[i].value = 0.00;
                $(".RAMT2")[i].value = 0.00;
                $(".RAMT3")[i].value = 0.00;
                $(".RAMT4")[i].value = 0.00;
                $(".RAMT5")[i].value = 0.00;
                $(".RAMT6")[i].value = 0.00;

                $(".SLABMIN")[i].value = 0;
                $(".SLABMAX")[i].value = 0;
                $(".SLABMIN1")[i].value = 0;
                $(".SLABMAX1")[i].value = 0;
                $(".SLABMIN2")[i].value = 0;
                $(".SLABMAX2")[i].value = 0;

                $(".RCOL1")[i].value = 0.00;
                $(".RCOL2")[i].value = 0.00;
                $(".RCOL3")[i].value = 0.00;
                $(".RCOL4")[i].value = 0.00;
                $(".RCOL5")[i].value = 0.00;
                $(".RCOL6")[i].value = 0.00;

                $(".RCAMT1")[i].value = 0.00;
                $(".RCAMT2")[i].value = 0.00;
                $(".RCAMT3")[i].value = 0.00;
                $(".RCAMT4")[i].value = 0.00;
                $(".RCAMT5")[i].value = 0.00;
                $(".RCAMT6")[i].value = 0.00;
                $(".TRANDSAMT")[i].value = 0.00;


                $(".TRANDHAMT")[i].value = 0.00;
                $(".TRANDEAMT")[i].value = 0.00;
                $(".TRANDFAMT")[i].value = 0.00;
                $(".TRANDPAMT")[i].value = 0.00;
                var CONTNRSID = $(".CONTNRSID")[i].value;
                var TRANMID = $("#TRANMID").val();
                var CHAID = $("#TRANREFID").val();
                base = window.location.origin;



                var url = "/SealBill/Bill_Detail/" + TARIFFMID + "-" + CHRGETYPE + "-" + CONTNRSID + "-" + CHAID + "-" + $(".ETOPID").val(); //alert(url);
                $.ajax({
                    url: url,
                    dataType: 'json',
                    async: false,
                    success: function (data) {

                        for (var k = 0; k < data.length; k++) {
                            //alert(data[k].SLABTID + "+" + data[k].SLABAMT);
                            if (data[k].SLABTID == 14) { $(".TRANDEAMT")[i].value = data[k].SLABAMT; }
                           // else if (data[k].SLABTID == 6) { $(".TRANDHAMT")[i].value = data[k].SLABAMT; }

                            else if (data[k].SLABTID == 15) { $(".TRANDFAMT")[i].value = data[k].SLABAMT; }
                            else if (data[k].SLABTID == 16) { $(".TRANDPAMT")[i].value = data[k].SLABAMT; }
                            else { $(".TRANDHAMT")[i].value = data[k].SLABAMT; }
                        }
                        if (isNaN($(".TRANDHAMT")[i].value))
                            $(".TRANDHAMT")[i].value = 0;
                        if (isNaN($(".TRANDEAMT")[i].value))
                            $(".TRANDEAMT")[i].value = 0;

                        if (isNaN($(".TRANDFAMT")[i].value))
                            $(".TRANDFAMT")[i].value = 0;
                        if (isNaN($(".TRANDPAMT")[i].value))
                            $(".TRANDPAMT")[i].value = 0;

                    }
                });




                i++;
            });


            var CHRGETYPE = $("#TRANBTYPE option:selected").val();
            var TARIFFMID = $("#TARIFFMID").val();
            var CHAID = $("#TRANREFID").val();
            i = 0;
            RCAMT1 = 0;
            RCAMT2 = 0;
            RCAMT3 = 0;
            $(".STFDIDS").each(function () {

                var CONTNRSID = $(".CONTNRSID")[i].value;
                var SDATE = $(".TRANSDATE")[i].value;

                if ($(".TRANEDATE")[i].value == "") {
                    var M_date = $(".TRANTIME").val();
                    $(".TRANEDATE")[i].value = M_date;

                }
                var EDATE = $(".TRANEDATE")[i].value;
                var s = SDATE.substring(0, 10);
                var e = EDATE.substring(0, 10);

                var days = datdidff(s, e);

                $(".days")[i].value = days + 1;


                var SLABMIN = $(".days")[i].value;

                var STFDIDS = $(".STFDIDS").val();

                var url = "/SealBill/RATECARD/" + TARIFFMID + "-" + CHRGETYPE + "-" + CONTNRSID + "-" + CHAID + "-" + SLABMIN;
                $.ajax({
                    url: url,

                    async: false,
                    success: function (data) {

                        var len = data.length;


                        if (len == 2) {

                            $(".RAMT1")[i].value = data[0].SLABAMT;
                            $(".RAMT2")[i].value = data[1].SLABAMT;
                            $(".RAMT3")[i].value = 0;
                            $(".RAMT4")[i].value = 0;
                            $(".RAMT5")[i].value = 0;
                            $(".RAMT6")[i].value = 0;


                            $(".SLABMIN")[i].value = data[0].SLABMIN;
                            $(".SLABMAX")[i].value = data[0].SLABMAX;


                            $(".SLABMIN1")[i].value = data[1].SLABMIN;
                            $(".SLABMAX1")[i].value = data[1].SLABMAX;

                            $(".SLABMIN2")[i].value = 0;
                            $(".SLABMAX2")[i].value = 0;


                            var slabmin = $(".SLABMIN")[i].value;
                            var slabmax = $(".SLABMAX")[i].value;
                            var mmdiff = ($(".SLABMIN")[i].value) - ($(".SLABMAX")[i].value);

                            var slabmin1 = $(".SLABMIN1")[i].value;
                            var slabmax1 = $(".SLABMAX1")[i].value;


                            $(".RCOL1")[i].value = Math.abs(mmdiff);
                            $(".RCOL2")[i].value = (Math.abs((slabmin1 - (($(".days")[i].value)))) + 1);

                            var ramt1 = $(".RAMT1")[i].value;
                            var ramt2 = $(".RAMT2")[i].value;


                            var rcamt1 = ramt1 * Math.abs(mmdiff);
                            var rcamt2 = ramt2 * $(".RCOL2")[i].value;


                            $(".RCAMT1")[i].value = rcamt1;
                            $(".RCAMT2")[i].value = rcamt2;
                            $(".RCAMT3")[i].value = 0;

                            $(".RCAMT4")[i].value = 0;
                            $(".RCAMT5")[i].value = 0;
                            $(".RCAMT6")[i].value = 0;

                        }
                        else if (len == 3) {

                            $(".RAMT1")[i].value = data[0].SLABAMT;
                            $(".RAMT2")[i].value = data[1].SLABAMT;
                            $(".RAMT3")[i].value = data[2].SLABAMT;
                            $(".RAMT4")[i].value = 0;
                            $(".RAMT5")[i].value = 0;
                            $(".RAMT6")[i].value = 0;

                            $(".SLABMIN")[i].value = data[0].SLABMIN;
                            $(".SLABMAX")[i].value = data[0].SLABMAX;

                            $(".SLABMIN1")[i].value = data[1].SLABMIN;
                            $(".SLABMAX1")[i].value = data[1].SLABMAX;

                            $(".SLABMIN2")[i].value = data[2].SLABMIN;
                            $(".SLABMAX2")[i].value = data[2].SLABMAX;


                            var slabmin = $(".SLABMIN")[i].value;
                            var slabmax = $(".SLABMAX")[i].value;
                            var mmdiff = ($(".SLABMIN")[i].value) - ($(".SLABMAX")[i].value);


                            var slabmin1 = $(".SLABMIN1")[i].value;
                            var slabmax1 = $(".SLABMAX1")[i].value;
                            var mmdiff1 = (($(".SLABMAX1")[i].value) - ($(".SLABMIN1")[i].value)) + parseInt(1);

                            var slabmin2 = $(".SLABMIN2")[i].value;
                            var slabmax2 = $(".SLABMAX2")[i].value;


                            var ramt1 = $(".RAMT1")[i].value;
                            var ramt2 = $(".RAMT2")[i].value;
                            var ramt3 = $(".RAMT3")[i].value;


                            $(".RCOL1")[i].value = Math.abs(parseFloat(mmdiff));
                            $(".RCOL2")[i].value = Math.abs(parseFloat(mmdiff1));
                            $(".RCOL3")[i].value = (Math.abs((slabmin2 - (($(".days")[i].value)))) + 1);

                            var rcamt1 = ramt1 * Math.abs(mmdiff);
                            var rcamt2 = ramt2 * Math.abs(mmdiff1);
                            var rcamt3 = ramt3 * $(".RCOL3")[i].value;

                            $(".RCAMT1")[i].value = rcamt1;
                            $(".RCAMT2")[i].value = rcamt2;
                            $(".RCAMT3")[i].value = rcamt3;

                            $(".RCAMT4")[i].value = 0;
                            $(".RCAMT5")[i].value = 0;
                            $(".RCAMT6")[i].value = 0;


                        }
                        else if (len == 4) {

                            $(".RAMT1")[i].value = data[0].SLABAMT;
                            $(".RAMT2")[i].value = data[1].SLABAMT;
                            $(".RAMT3")[i].value = data[2].SLABAMT;
                            $(".RAMT4")[i].value = data[3].SLABAMT;
                            $(".RAMT5")[i].value = 0;
                            $(".RAMT6")[i].value = 0;

                            $(".SLABMIN")[i].value = data[0].SLABMIN;
                            $(".SLABMAX")[i].value = data[0].SLABMAX;

                            $(".SLABMIN1")[i].value = data[1].SLABMIN;
                            $(".SLABMAX1")[i].value = data[1].SLABMAX;

                            $(".SLABMIN2")[i].value = data[2].SLABMIN;
                            $(".SLABMAX2")[i].value = data[2].SLABMAX;

                            $(".SLABMIN3")[i].value = data[3].SLABMIN;
                            $(".SLABMAX3")[i].value = data[3].SLABMAX;

                            var slabmin = $(".SLABMIN")[i].value;
                            var slabmax = $(".SLABMAX")[i].value;
                            var mmdiff = ($(".SLABMIN")[i].value) - ($(".SLABMAX")[i].value);


                            var slabmin1 = $(".SLABMIN1")[i].value;
                            var slabmax1 = $(".SLABMAX1")[i].value;
                            var mmdiff1 = (($(".SLABMAX1")[i].value) - ($(".SLABMIN1")[i].value)) + parseInt(1);

                            var slabmin2 = $(".SLABMIN2")[i].value;
                            var slabmax2 = $(".SLABMAX2")[i].value;
                            var mmdiff2 = (($(".SLABMAX2")[i].value) - ($(".SLABMIN2")[i].value)) + parseInt(1);

                            var ramt1 = $(".RAMT1")[i].value;
                            var ramt2 = $(".RAMT2")[i].value;
                            var ramt3 = $(".RAMT3")[i].value;
                            var ramt4 = $(".RAMT4")[i].value;


                            $(".RCOL1")[i].value = Math.abs(mmdiff);
                            $(".RCOL2")[i].value = Math.abs(mmdiff1);
                            $(".RCOL3")[i].value = Math.abs(mmdiff2);
                            $(".RCOL4")[i].value = (Math.abs((slabmin3 - (($(".days")[i].value)))) + 1);

                            var rcamt1 = ramt1 * Math.abs(mmdiff);
                            var rcamt2 = ramt2 * Math.abs(mmdiff1);
                            var rcamt3 = ramt3 * Math.abs(mmdiff2);
                            var rcamt4 = ramt4 * $(".RCOL4")[i].value;

                            $(".RCAMT1")[i].value = rcamt1;
                            $(".RCAMT2")[i].value = rcamt2;
                            $(".RCAMT3")[i].value = rcamt3;

                            $(".RCAMT4")[i].value = rcamt4;
                            $(".RCAMT5")[i].value = 0;
                            $(".RCAMT6")[i].value = 0;


                        }
                        else if (len == 5) {
                            $(".RAMT1")[i].value = data[0].SLABAMT;
                            $(".RAMT2")[i].value = data[1].SLABAMT;
                            $(".RAMT3")[i].value = data[2].SLABAMT;
                            $(".RAMT4")[i].value = data[3].SLABAMT;
                            $(".RAMT5")[i].value = data[4].SLABAMT;
                            $(".RAMT6")[i].value = 0;

                            $(".SLABMIN")[i].value = data[0].SLABMIN;
                            $(".SLABMAX")[i].value = data[0].SLABMAX;

                            $(".SLABMIN1")[i].value = data[1].SLABMIN;
                            $(".SLABMAX1")[i].value = data[1].SLABMAX;

                            $(".SLABMIN2")[i].value = data[2].SLABMIN;
                            $(".SLABMAX2")[i].value = data[2].SLABMAX;

                            $(".SLABMIN3")[i].value = data[3].SLABMIN;
                            $(".SLABMAX3")[i].value = data[3].SLABMAX;

                            $(".SLABMIN4")[i].value = data[4].SLABMIN;
                            $(".SLABMAX4")[i].value = data[4].SLABMAX;

                            //$(".SLABMIN5")[i].value = data[5].SLABMIN;
                            //$(".SLABMAX5")[i].value = data[5].SLABMAX;



                            var slabmin = $(".SLABMIN")[i].value;
                            var slabmax = $(".SLABMAX")[i].value;
                            var mmdiff = ($(".SLABMIN")[i].value) - ($(".SLABMAX")[i].value);


                            var slabmin1 = $(".SLABMIN1")[i].value;
                            var slabmax1 = $(".SLABMAX1")[i].value;
                            var mmdiff1 = (($(".SLABMAX1")[i].value) - ($(".SLABMIN1")[i].value)) + parseInt(1);

                            var slabmin2 = $(".SLABMIN2")[i].value;
                            var slabmax2 = $(".SLABMAX2")[i].value;
                            var mmdiff2 = (($(".SLABMAX2")[i].value) - ($(".SLABMIN2")[i].value)) + parseInt(1);
                            var slabmin3 = $(".SLABMIN3")[i].value;
                            var slabmax3 = $(".SLABMAX3")[i].value;
                            var mmdiff3 = (($(".SLABMAX3")[i].value) - ($(".SLABMIN3")[i].value)) + parseInt(1);

                            var slabmin4 = $(".SLABMIN4")[i].value;
                            //var slabmax4 = $(".SLABMAX4")[i].value;
                            //var mmdiff4 = (($(".SLABMAX4")[i].value) - ($(".SLABMIN4")[i].value)) + parseInt(1);

                            //var slabmin5 = $(".SLABMIN5")[i].value;
                            //var slabmax5 = $(".SLABMAX5")[i].value;
                            //var mmdiff5 = (($(".SLABMAX5")[i].value) - ($(".SLABMIN5")[i].value)) + parseInt(1);

                            var ramt1 = $(".RAMT1")[i].value;
                            var ramt2 = $(".RAMT2")[i].value;
                            var ramt3 = $(".RAMT3")[i].value;
                            var ramt4 = $(".RAMT4")[i].value;
                            var ramt5 = $(".RAMT5")[i].value;
                            //var ramt6 = $(".RAMT6")[i].value;

                            $(".RCOL1")[i].value = Math.abs(mmdiff);
                            $(".RCOL2")[i].value = Math.abs(mmdiff1);
                            $(".RCOL3")[i].value = Math.abs(mmdiff2);
                            $(".RCOL4")[i].value = Math.abs(mmdiff3);
                            $(".RCOL5")[i].value = (Math.abs((slabmin4 - (($(".days")[i].value)))) + 1);
                            //  $(".RCOL6")[i].value = Math.abs(mmdiff5);
                            //  $(".RCOL7")[i].value = (Math.abs((slabmin5 - (($(".days")[i].value)))) + 1);

                            var rcamt1 = ramt1 * Math.abs(mmdiff);
                            var rcamt2 = ramt2 * Math.abs(mmdiff1);
                            var rcamt3 = ramt3 * Math.abs(mmdiff2);
                            var rcamt4 = ramt4 * Math.abs(mmdiff3);
                            var rcamt5 = ramt5 * $(".RCOL5")[i].value;
                            //   var rcamt6 = ramt6 * $(".RCOL6")[i].value;

                            $(".RCAMT1")[i].value = rcamt1;
                            $(".RCAMT2")[i].value = rcamt2;
                            $(".RCAMT3")[i].value = rcamt3;
                            $(".RCAMT4")[i].value = rcamt4;
                            $(".RCAMT5")[i].value = rcamt5;
                            $(".RCAMT6")[i].value = 0;
                        }
                        else if (len == 6) {
                            $(".RAMT1")[i].value = data[0].SLABAMT;
                            $(".RAMT2")[i].value = data[1].SLABAMT;
                            $(".RAMT3")[i].value = data[2].SLABAMT;
                            $(".RAMT4")[i].value = data[3].SLABAMT;
                            $(".RAMT5")[i].value = data[4].SLABAMT;
                            $(".RAMT6")[i].value = data[5].SLABAMT;

                            $(".SLABMIN")[i].value = data[0].SLABMIN;
                            $(".SLABMAX")[i].value = data[0].SLABMAX;

                            $(".SLABMIN1")[i].value = data[1].SLABMIN;
                            $(".SLABMAX1")[i].value = data[1].SLABMAX;

                            $(".SLABMIN2")[i].value = data[2].SLABMIN;
                            $(".SLABMAX2")[i].value = data[2].SLABMAX;

                            $(".SLABMIN3")[i].value = data[3].SLABMIN;
                            $(".SLABMAX3")[i].value = data[3].SLABMAX;

                            $(".SLABMIN4")[i].value = data[4].SLABMIN;
                            $(".SLABMAX4")[i].value = data[4].SLABMAX;

                            $(".SLABMIN5")[i].value = data[5].SLABMIN;
                            $(".SLABMAX5")[i].value = data[5].SLABMAX;



                            var slabmin = $(".SLABMIN")[i].value;
                            var slabmax = $(".SLABMAX")[i].value;
                            var mmdiff = ($(".SLABMIN")[i].value) - ($(".SLABMAX")[i].value);


                            var slabmin1 = $(".SLABMIN1")[i].value;
                            var slabmax1 = $(".SLABMAX1")[i].value;
                            var mmdiff1 = (($(".SLABMAX1")[i].value) - ($(".SLABMIN1")[i].value)) + parseInt(1);

                            var slabmin2 = $(".SLABMIN2")[i].value;
                            var slabmax2 = $(".SLABMAX2")[i].value;
                            var mmdiff2 = (($(".SLABMAX2")[i].value) - ($(".SLABMIN2")[i].value)) + parseInt(1);
                            var slabmin3 = $(".SLABMIN3")[i].value;
                            var slabmax3 = $(".SLABMAX3")[i].value;
                            var mmdiff3 = (($(".SLABMAX3")[i].value) - ($(".SLABMIN3")[i].value)) + parseInt(1);

                            var slabmin4 = $(".SLABMIN4")[i].value;
                            var slabmax4 = $(".SLABMAX4")[i].value;
                            var mmdiff4 = (($(".SLABMAX4")[i].value) - ($(".SLABMIN4")[i].value)) + parseInt(1);

                            var slabmin5 = $(".SLABMIN5")[i].value;
                            //  var slabmax5 = $(".SLABMAX5")[i].value;
                            //  var mmdiff5 = (($(".SLABMAX5")[i].value) - ($(".SLABMIN5")[i].value)) + parseInt(1);

                            var ramt1 = $(".RAMT1")[i].value;
                            var ramt2 = $(".RAMT2")[i].value;
                            var ramt3 = $(".RAMT3")[i].value;
                            var ramt4 = $(".RAMT4")[i].value;
                            var ramt5 = $(".RAMT5")[i].value;
                            var ramt6 = $(".RAMT6")[i].value;

                            $(".RCOL1")[i].value = Math.abs(mmdiff);
                            $(".RCOL2")[i].value = Math.abs(mmdiff1);
                            $(".RCOL3")[i].value = Math.abs(mmdiff2);
                            $(".RCOL4")[i].value = Math.abs(mmdiff3);
                            $(".RCOL5")[i].value = Math.abs(mmdiff4);
                            //   $(".RCOL6")[i].value = Math.abs(mmdiff5);
                            $(".RCOL6")[i].value = (Math.abs((slabmin5 - (($(".days")[i].value)))) + 1);

                            var rcamt1 = ramt1 * Math.abs(mmdiff);
                            var rcamt2 = ramt2 * Math.abs(mmdiff1);
                            var rcamt3 = ramt3 * Math.abs(mmdiff2);
                            var rcamt4 = ramt4 * Math.abs(mmdiff3);
                            var rcamt5 = ramt5 * Math.abs(mmdiff4);
                            var rcamt6 = ramt6 * $(".RCOL6")[i].value;

                            $(".RCAMT1")[i].value = rcamt1;
                            $(".RCAMT2")[i].value = rcamt2;
                            $(".RCAMT3")[i].value = rcamt3;
                            $(".RCAMT4")[i].value = rcamt4;
                            $(".RCAMT5")[i].value = rcamt5;
                            $(".RCAMT6")[i].value = rcamt6;
                        }

                        else if (len == 7) {
                            $(".RAMT1")[i].value = data[0].SLABAMT;
                            $(".RAMT2")[i].value = data[1].SLABAMT;
                            $(".RAMT3")[i].value = data[2].SLABAMT;
                            $(".RAMT4")[i].value = data[3].SLABAMT;
                            $(".RAMT5")[i].value = data[4].SLABAMT;
                            $(".RAMT6")[i].value = data[5].SLABAMT;
                            $(".RAMT7")[i].value = data[6].SLABAMT;

                            $(".SLABMIN")[i].value = data[0].SLABMIN;
                            $(".SLABMAX")[i].value = data[0].SLABMAX;

                            $(".SLABMIN1")[i].value = data[1].SLABMIN;
                            $(".SLABMAX1")[i].value = data[1].SLABMAX;

                            $(".SLABMIN2")[i].value = data[2].SLABMIN;
                            $(".SLABMAX2")[i].value = data[2].SLABMAX;

                            $(".SLABMIN3")[i].value = data[3].SLABMIN;
                            $(".SLABMAX3")[i].value = data[3].SLABMAX;

                            $(".SLABMIN4")[i].value = data[4].SLABMIN;
                            $(".SLABMAX4")[i].value = data[4].SLABMAX;

                            $(".SLABMIN5")[i].value = data[5].SLABMIN;
                            $(".SLABMAX5")[i].value = data[5].SLABMAX;

                            $(".SLABMIN6")[i].value = data[6].SLABMIN;
                            $(".SLABMAX6")[i].value = data[6].SLABMAX;


                            var slabmin = $(".SLABMIN")[i].value;
                            var slabmax = $(".SLABMAX")[i].value;
                            var mmdiff = ($(".SLABMIN")[i].value) - ($(".SLABMAX")[i].value);


                            var slabmin1 = $(".SLABMIN1")[i].value;
                            var slabmax1 = $(".SLABMAX1")[i].value;
                            var mmdiff1 = (($(".SLABMAX1")[i].value) - ($(".SLABMIN1")[i].value)) + parseInt(1);

                            var slabmin2 = $(".SLABMIN2")[i].value;
                            var slabmax2 = $(".SLABMAX2")[i].value;
                            var mmdiff2 = (($(".SLABMAX2")[i].value) - ($(".SLABMIN2")[i].value)) + parseInt(1);
                            var slabmin3 = $(".SLABMIN3")[i].value;
                            var slabmax3 = $(".SLABMAX3")[i].value;
                            var mmdiff3 = (($(".SLABMAX3")[i].value) - ($(".SLABMIN3")[i].value)) + parseInt(1);

                            var slabmin4 = $(".SLABMIN4")[i].value;
                            var slabmax4 = $(".SLABMAX4")[i].value;
                            var mmdiff4 = (($(".SLABMAX4")[i].value) - ($(".SLABMIN4")[i].value)) + parseInt(1);

                            var slabmin5 = $(".SLABMIN5")[i].value;
                            var slabmax5 = $(".SLABMAX5")[i].value;
                            var mmdiff5 = (($(".SLABMAX5")[i].value) - ($(".SLABMIN5")[i].value)) + parseInt(1);
                            var slabmin6 = $(".SLABMIN6")[i].value;
                            var ramt1 = $(".RAMT1")[i].value;
                            var ramt2 = $(".RAMT2")[i].value;
                            var ramt3 = $(".RAMT3")[i].value;
                            var ramt4 = $(".RAMT4")[i].value;
                            var ramt5 = $(".RAMT5")[i].value;
                            var ramt6 = $(".RAMT6")[i].value;
                            var ramt7 = $(".RAMT7")[i].value;

                            $(".RCOL1")[i].value = Math.abs(mmdiff);
                            $(".RCOL2")[i].value = Math.abs(mmdiff1);
                            $(".RCOL3")[i].value = Math.abs(mmdiff2);
                            $(".RCOL4")[i].value = Math.abs(mmdiff3);
                            $(".RCOL5")[i].value = Math.abs(mmdiff4);
                            $(".RCOL6")[i].value = Math.abs(mmdiff5);
                            $(".RCOL7")[i].value = (Math.abs((slabmin6 - (($(".days")[i].value)))) + 1);

                            var rcamt1 = ramt1 * Math.abs(mmdiff);
                            var rcamt2 = ramt2 * Math.abs(mmdiff1);
                            var rcamt3 = ramt3 * Math.abs(mmdiff2);
                            var rcamt4 = ramt4 * Math.abs(mmdiff3);
                            var rcamt5 = ramt5 * Math.abs(mmdiff4);
                            var rcamt6 = ramt6 * $(".RCOL6")[i].value;
                            var rcamt7 = ramt7 * $(".RCOL7")[i].value;
                            $(".RCAMT1")[i].value = rcamt1;
                            $(".RCAMT2")[i].value = rcamt2;
                            $(".RCAMT3")[i].value = rcamt3;
                            $(".RCAMT4")[i].value = rcamt4;
                            $(".RCAMT5")[i].value = rcamt5;
                            $(".RCAMT6")[i].value = rcamt6;
                            $(".RCAMT7")[i].value = rcamt7;
                        }







                        var AMT1 = $(".RCAMT1")[i].value;
                        var AMT2 = $(".RCAMT2")[i].value;
                        var AMT3 = $(".RCAMT3")[i].value;
                        var AMT4 = $(".RCAMT4")[i].value;
                        var AMT5 = $(".RCAMT5")[i].value;
                        var AMT6 = $(".RCAMT6")[i].value;
                        if (isNaN(AMT1))
                            AMT1 = 0;
                        if (isNaN(AMT2))
                            AMT2 = 0;
                        if (isNaN(AMT3))
                            AMT3 = 0;
                        if (isNaN(AMT4))
                            AMT4 = 0;
                        if (isNaN(AMT5))
                            AMT5 = 0;
                        if (isNaN(AMT6))
                            AMT6 = 0;
                        var totamt = parseInt(AMT1) + parseInt(AMT2) + parseInt(AMT3) + parseInt(AMT4) + parseInt(AMT5) + parseInt(AMT6);
                        $(".TRANDSAMT")[i].value = totamt.toFixed(2);


                    }
                });

                i++;

            });total();



        }//........End of Calculation

        function GetTariff() {
            $(".TARIFFMID").empty();
            $.ajax({
                url: "/SealBill/GetTariff/" + $("#ETOPID").val() + ";" + $("#TARIFFGID option:selected").val(),
                success: function (data) {
                    $(".TARIFFMID").append('<option>Select</option>');
                    $.each(data, function (i, dataval) {
                        $(".TARIFFMID").append('<option value="' + dataval.TARIFFMID + '">' + dataval.TARIFFMDESC + '</option>');

                    });
                }
            });
        }

        //........get detail row.....................//
        function GetDetail() {

            var tranlmid = $(".TRANLMID option:selected").text();
            $(".TRANLMNO").val(tranlmid);

            var chaid = $("#TRANREFID").val();
            var stfmid = $("#TRANLMID option:selected").val(); var tranmid = $("#TRANMID").val(); var edate = $("#TRANTIME").val();
            edate = edate.split(" "); edate = edate[0].split("/"); edate = (edate[1] < 10 ? '0' : '') + edate[1] + "-" + edate[0] + "-" + edate[2];
            url = "/SealBill/Detail?ids=" + stfmid + "~" + edate + "~" + tranmid;// alert(url);

            $.ajax({
                url: "/SealBill/GetOPTYP/" + stfmid,
                success: function (data) {
                    //  alert(data[0].EOPTID);
                    // $(".ETOPID").val(data[0].EOPTID);
                    $(".ETOPID").val(data[0].SLABTID); $(".F_EXPRTNAME").val(data[0].EXPRTNAME);
                }
            });
            $.ajax({
                url: url,
                success: function (data) {
                    //  alert(data);
                    $("#job_list").html("");

                    $("#job_list").html(data);
                    i = 0;
                    $(".STFDIDS").each(function () {
                        var C_date = $(".TRANEDATE")[i].value;

                        if (C_date == "") {

                            var M_date = $(".TRANTIME").val();

                            $(".TRANEDATE")[i].value = M_date;

                        }


                        i++;
                    });
                    $('#TDETAIL tbody tr').each(function () {
                        //  alert("KKK");
                        $(this).find(".datepicker").removeAttr('id').removeClass('hasDatepicker'); // added the removeClass part.
                        $('.datepicker').datepicker({ dateFormat: 'dd/mm/yy', changeYear: true, changeMonth: true });
                    });
                }

            });//---End of Post--------

        }

        //..................... FORM VALIDATION FUNCTION.................................//
        function Validate() {

            if ($(".TRANREFNAME").val() == "") {
                alert("Please select CHA");
                $(".TRANREFNAME").focus();
                return false;
            }
            else if ($(".TRANREFID").val() == "") {
                alert("Please Select CHA properly");
                $(".TRANREFNAME").val("");
                $(".TRANREFNAME").focus();
                return false;
            }
            else if ($(".TARIFFMID").val() == "") {
                alert("Please Select Tariff properly");
                $(".TARIFFMID").focus();
                return false;
            }


            else if ($(".LCATEID").val() == "") {
                alert("Please Select Labour properly");
                $(".LCATEID").focus();
                return false;
            }
            else if ($("#TRANMODE").val() == "") {

                alert("Please Select Payment Mode");
                $("#TRANMODE").focus();
                return false;
            }
            else if ($(".TRANMODEDETL").val() == "") {
                alert("Select Payment Mode properly");
                $(".TRANMODEDETL").focus();
                return false;
            }
            else if ($("#TRANMODE").val() == "2" || $("#TRANMODE").val() == "3") {
                if ($("#TRANREFNO").val() == "") {
                    alert("Please Enter Number");
                    $("#TRANREFNO").focus();
                    return false;
                }
                if ($("#TRANREFDATE").val() == "") {
                    alert("Please Enter Date");
                    $("#TRANREFDATE").focus();
                    return false;
                }
                if ($(".TRANREFBNAME").val() == "") {
                    alert("Select Bank Name Properly");
                    $(".BANKMID").focus();
                    return false;

                }
            }
            else if ($(".TRANREFAMT").val() == "") {
                alert("Please Enter Amount");
                $(".TRANREFAMT").focus();
                return false;
            }

            else if ($(".TRANNAMT").val() == "0.00" || $(".TRANDNAMT").val() == "0.00") {
                alert("Atleast One Stuffing Invoice detail should be selected");
                return false;
            }


        }//.....END OF VALIDATION


        /*...............*/

        function checkall() {
            i = 0; j = 0;
            CHCK_ALL = $("#CHCK_ALL").is(':checked');
            var tbl = $("#TDETAIL").find('tbody');
           // alert(CHCK_ALL);

            $(".STFDIDS").each(function () {
                $trcur=tbl.find("tr:eq("+i+")");
                if (CHCK_ALL == true) {
                    $trcur.find(".STFDIDS").prop("checked",true);
                    $(".boolSTFDIDS")[i].value = "true";
                }
                else {
                    $trcur.find(".STFDIDS").removeAttr("checked",true);
                    $(".boolSTFDIDS")[i].value = "false";
                }

                i++;

            });
            total();
        }/*.....*/

    </script>
}
