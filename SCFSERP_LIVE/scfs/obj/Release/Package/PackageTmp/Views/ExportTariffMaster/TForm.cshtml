
@using scfs_erp.Models;
@model scfs_erp.Models.ExportTariffOPDetails

@{
    Layout = "~/Views/Shared/_PopupLayout.cshtml";
}

<div class="modal-dialog">
    <div class="modal-content">

        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Tariff-Operation</h4>
        </div>

        <form method="post" action="@Url.Action("TSavedata","ExportTariffMaster")" id="schedulefrm">

            <div class="msg" hidden style="margin-left:0;margin-right:0"> </div>
            <div class="msg_error" hidden style="margin-left:0;margin-right:0"> </div>

            <div class="col-lg-12 hidden">
                <div class="col-lg-4">
                    <div class="form-group">
                        <label>Product</label>

                        <input class="form-control  TARIFFMID" id="TARIFFMID" name="TARIFFMID" value="@ViewBag.id" readonly>
                    </div>
                </div>
            </div>

            <div class="col-lg-12">
                <div class="box-content">
                    <div class="table-responsive" id="job_list_inner">
                        <input type="text" id="SUB_TDETAIL_IDX" value="0" name="SUB_TDETAIL_IDX[]" class="SUB_TDETAIL_IDX" style="display:none" />
                        <table class='table table-striped table-bordered bootstrap-datatable' id="SUB_TDETAIL">
                            <thead><tr><th>Operation Type</th><th> <a class="btn btn-success btn-sm " href="#" id="sub_add_detail"><i class="fa fa-plus-square "></i>  </a></th></tr> </thead>
                            <tbody class="SUB_TDETAIL_BODY" id="SUB_TDETAIL_BODY">
                                @if (Model.tariffoperation != null)
                                {
                                    foreach (ExportTariffOperationMaster det in Model.tariffoperation)
                                    {
                                        <tr class="item-row">
                                            <td class="hidden">
                                                <input class="form-control hide ETID" id="ETID" name="ETID" value="@det.ETID">
                                            </td>
                                            <td>
                                                @Html.DropDownListFor(model => Model.tariffoperation[0].EOPTID, new SelectList(ViewBag.EOPTID, "Value", "Text", @det.EOPTID), "Select", new { @class = "EOPTID form-control", @id = "EOPTID" })
                                            </td>

                                            <td><a class="btn btn-danger btn-sm" id="sub_del_detail"> <i class="fa fa-trash-o"></i></a></td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr class="item-row">
                                        <td class="hidden">
                                            <input class="form-control hide ETID" id="ETID" name="ETID" value="0">
                                        </td>
                                        <td>
                                            @Html.DropDownListFor(model => Model.tariffoperation[0].EOPTID, new SelectList(ViewBag.EOPTID, "Value", "Text"), "Select", new { @class = "EOPTID form-control", @id = "EOPTID" })
                                        </td>

                                        <td><a class="btn btn-danger btn-sm" id="sub_del_detail"> <i class="fa fa-trash-o"></i></a></td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="clearfix"> </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" id="SaveClick">Save</button>
            </div>

        </form>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>


@*<div class="modal-body"></div>*@


<script>
    $(function () {
       // $('.msg_error').html("Please Enter Schedule details before save");


    });

    $(function () {
        var rowcount = $('#SUB_TDETAIL tbody tr').length;
        $("#SUB_TDETAIL_IDX").val(rowcount);
        $("#sub_add_detail").click(function () {
            if ($("#SUB_TDETAIL_IDX").val() != 0) {
                var $tableBody = $('#SUB_TDETAIL').find("tbody"),
                $trLast = $tableBody.find("tr:last");
                $trNew = $trLast.clone();
                $trLast.after($trNew);
                $trNew.find(".ETID").val("0");
                var row_idx = parseInt($("#SUB_TDETAIL_IDX").val());
                $("#SUB_TDETAIL_IDX").val(row_idx + 1);
                $("#SUB_TDETAIL_BODY").show();
            }
            else {
                $('#SUB_TDETAIL_IDX').val("1");
                $("#SUB_TDETAIL_BODY").show();

            }
            return false;
        });
    });

    $("#SaveClick").click(function () {
        var formdata = ($("#schedulefrm").serialize());
        var bad = 0;
        if ($(".F_VAL").val() == "") bad++;
        $('#schedulefrm :text,select').each(function () {

            switch (this.id) {
                default:
                    if ($.trim(this.value) == "") { bad++; }
            }
        });

        //if (bad > 1) {
        //    $('.msg_error').html("Please Enter Schedule details before save");
        //    $('.msg_error').show();
        //    $('.msg_error').delay(1200).fadeOut(1000);
        //    return false;
        //}

        $.ajax({
            type: 'post',
            url: '@Url.Action("TSavedata","ExportTariffMaster")', // we are calling json method
            data: formdata,
            success: function (data) {
                if (data == "saved") {
                    $('.msg').html("Saved Successfully");
                    $('.msg').show();
                    $('.msg').delay(1200).fadeOut(1000);
                    $('#myModal').modal('hide');
                }
            },
            error: function (ex) {
                alert('Failed to save data ' + ex);
            }
        });
    });

    $("#schedulefrm").on("click", "#sub_del_detail", function () {
        var r = confirm("Are you sure to delete this record ?");
        if (r == true) {
            idx = $("#SUB_TDETAIL_IDX").val();
            if (idx == 1) {

                var $tableBody = $('#SUB_TDETAIL').find("tbody")
                $trCur = $tableBody.find("tr:eq(0)");
                $trCur.find(".TRANSDATE").val("");
                $trCur.find(".TRANSQTY").val("");
                $trCur.find(".ETID").val("-1");

            }
            else {
                $("#SUB_TDETAIL_BODY").show();
                var row = this.parentNode.parentNode;
                $(this).parents('.item-row').remove();
                $("#SUB_TDETAIL_IDX").val($("#SUB_TDETAIL_IDX").val() - 1);

            }
        }
    });


</script>



