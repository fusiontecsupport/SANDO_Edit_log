@using scfs_erp.Models;

@model scfs_erp.Models.TransactionMD
@{
    ViewBag.Title = "ShutOut Bill(GST)";
}

<style>
    #TDETAIL {
    }

    /*#TDETAIL td input {
      width:50%;
    }*/

    .TRANDAID {
        min-width: 200px;
    }

    .TRANDREFNAME {
        min-width: 250px;
    }

    /*.TRANDREFNO {
        max-width: 100%;
    }*/

    .TDETAILBANK td {
        text-align: center;
    }

    .small {
        border: 0;
        width: 30px;
        max-width: 25%;
        background: none;
    }

    .stk {
        background: #0f367d;
        color: #fff;
    }

    .sm-1 {
        max-width: 50px;
    }

    .TRANGAMT, .TRANNAMT, .TRANROAMT {
        max-width: 150px;
    }

    .gross {
        min-width: 800px;
    }

    .frm_hide {
        display: none;
    }

    .small {
        border: 0;
        width: 30px;
        max-width: 25%;
        background: none;
    }

    .medium {
        border: 0;
        width: 50px;
        max-width: 55%;
        background: none;
    }
</style>

<div class="row">
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
                <div class="box-name">
                    <i class="fa fa-search"></i>
                    <strong>Shut Out Bill(GST)</strong>
                </div>
            </div>
            <div class="box-content" data-ng-app="myModule">
                <form action="@Url.Content("~/ShutOutInvoice/savedata")" method="post" accept-charset="utf-8" id="frm" data-ng-controller="myController" name="frm" onsubmit="return Validate()">
                    @Html.ValidationSummary(true)
                    <fieldset id="ExportCartingOrder_info">
                        <div class="row">
                            @*<div class="col-lg-12">*@
                            <div class="col-md-2 hidden">
                                <div class="form-group">
                                    <label>Primary  </label>
                                    @Html.TextBoxFor(model => model.masterdata[0].TRANMID, new { @class = "form-control  TRANMID", @id = "TRANMID" })
                                    @Html.TextBoxFor(model => model.masterdata[0].TRANBTYPE, new { @class = "form-control  TRANBTYPE", @id = "TRANBTYPE", @Value = "5" })
                                </div>
                            </div>

                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>Billed To</label>
                                    @Html.DropDownList("REGSTRID", null, new { @class = "form-control REGSTRID", @id = "REGSTRID", tabindex = "2" })

                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label>No</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANNO, new { @class = "form-control  TRANNO", @id = "TRANNO", @readonly = "readonly" })
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Date/Time </label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANTIME, new { @class = "form-control datetime  TRANTIME", @id = "TRANTIME", @data_val = false, @tabindex = "4" })
                                </div>
                            </div>


                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Labour  </label>
                                    @Html.DropDownList("LCATEID", null, "Please Choose An Option", new { @class = "form-control LCATEID", @id = "LCATEID", @tabindex = "6" })
                                </div>
                            </div>


                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>CHA  </label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFNAME, new { @class = "form-control  TRANREFNAME", @id = "TRANREFNAME", data_autocomplete_url = Url.Action("AutoCha", "ShutOutInvoice"), placeholder = "Please Choose CHA", @tabindex = "8" })
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFID, new { @class = "hide form-control TRANREFID", @id = "TRANREFID" })

                                    <input type="text" value="" id="DDATE" class="hide form-control DDATE" name="DDATE" style="width:95px" />
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Tariff Group</label>

                                    @Html.DropDownList("TARIFFGID", null, "Please Choose An Option", new { @class = "form-control TARIFFGID", @id = "TARIFFGID", @onchange = "GetTariff()", @tabindex = "12" })

                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Tariff </label>

                                    @Html.DropDownList("TARIFFMID", null, "Please Choose An Option", new { @class = "form-control TARIFFMID", @id = "TARIFFMID", @onchange = "calculation()", @tabindex = "14" })
                                    <input type="text" value="" id="TARIFFTMID" class="hide form-control TARIFFTMID" name="TARIFFTMID" style="width:95px" />
                                </div>
                            </div>
                            @*</div>*@

                            <input type="text" id="pd_index" value="0" style="display:none">

                            <div style="float:right">
                            </div>
                            <div style="clear:both"> </div>
                        </div>

                        <div class="panel-heading navbar-inverse" style="color:white">ShutOut Bill Details<a class="navbar-right  btn-primary" id="add_detail" style="margin-top:-3px;"> <i class="glyphicon  glyphicon-plus-sign  well-sm"></i></a></div>

                        <table class="table table-striped table-bordered bootstrap-datatable TDETAIL" id="TDETAIL">
                            <thead>
                                <tr>

                                    <th>
                                        Container No
                                    </th>
                                    <th>
                                        Size
                                    </th>
                                    <th>
                                        In Date
                                    </th>
                                    <th>
                                        Storage Date
                                    </th>
                                    <th>
                                        Charge Date
                                    </th>
                                    <th>
                                        Storage
                                    </th>
                                    <th>
                                        Handling
                                    </th>

                                    <th>
                                        Total
                                    </th>
                                    <th></th>
                                </tr>
                            </thead>

                            <tbody class="TDETAIL_TBODY" id="TDETAIL_TBODY">
                                @if (Model.detaildata != null)
                                {
                                    foreach (pr_Export_Shutout_Detail_Ctrl_Assgn_Result details in Model.shutoutviewdata)
                                    {
                                        var st = ""; var bt = "";

                                        if (details.TRANDID != 0) { st = "checked"; bt = "true"; }
                                        else { bt = "false"; st = ""; }


                                        <tr class="item-row">

                                            <td class="hide">
                                                <input class="TRANDID" id="TRANDID" name="TRANDID" style="display:none" type="text" value="@details.TRANDID">
                                                <input class="STFDID" id="STFDID" name="STFDID" type="text" value="@details.STFDID" style="width:42px">
                                            </td>
                                            <td class="col-md-3">
                                                <input class="TRANDREFNO" id="TRANDREFNO" name="TRANDREFNO" type="text" value="@details.CONTNRNO" style="width:122px" readonly>

                                            </td>
                                            <td class="col-md-1">
                                                <input class="TRANDREFID hide" id="TRANDREFID" name="TRANDREFID" type="text" value="@details.TRANDREFID" hidden>
                                                <input class="SIZE" id="SIZE" name="SIZE" type="text" value="@details.CONTNRSDESC" style="width:42px" readonly>
                                            </td>
                                            <td class="col-md-3">
                                                <input class="TRANIDATE" id="TRANIDATE" name="TRANIDATE" type="text" value="@details.GIDATE" readonly>
                                            </td>
                                            <td class="col-md-3">
                                                <input class="TRANSDATE" id="TRANSDATE" name="TRANSDATE" type="text" value="@details.SBDDATE" readonly>
                                            </td>
                                            <td class="col-md-3">
                                                <input class="datepicker TRANEDATE" id="TRANEDATE" name="TRANEDATE" type="text" value="@details.GODATE" onchange="calculation()">
                                            </td>
                                            <td class="col-md-2">
                                                <input class="TRANDSAMT" id="TRANDSAMT" name="TRANDSAMT" type="text" value="@details.TRANDSAMT" style="width:65px" readonly>
                                            </td>
                                            <td class="col-md-2">
                                                <input class="TRANDHAMT" id="TRANDHAMT" name="TRANDHAMT" type="text" value="@details.TRANDHAMT" style="width:65px" readonly>
                                            </td>

                                            <td class="col-md-2">
                                                <input class="TRANDNAMT" id="TRANDNAMT" name="TRANDNAMT" style="width:70px" type="text" value="@details.TRANDNAMT" readonly>
                                            </td>




                                            <td class="hide">
                                                <input class="RAMT4" id="RAMT4" name="RAMT4" style="display:none1" type="text" value="0"><input class="RAMT5" id="RAMT5" name="RAMT5" style="display:none1" type="text" value="0"><input class="RAMT6" id="RAMT6" name="RAMT6" style="display:none1" type="text" value="0">
                                            </td>
                                            <td class="hide">
                                                <input class="SLABMIN" id="SLABMIN" name="SLABMIN" style="display:none1" type="text" value="0"><input class="SLABMAX" id="SLABMAX" name="SLABMAX" style="display:none1" type="text" value="0"><input class="SLABMIN1" id="SLABMIN1" name="SLABMIN1" style="display:none1" type="text" value="0"><input class="SLABMAX1" id="SLABMAX1" name="SLABMAX1" style="display:none1" type="text" value="0"><input class="SLABMIN2" id="SLABMIN2" name="SLABMIN2" style="display:none1" type="text" value="0"><input class="SLABMAX2" id="SLABMAX2" name="SLABMAX2" style="display:none1" type="text" value="0">
                                            </td>
                                            <td class="hide">
                                                <input class="RCAMT4" id="RCAMT4" name="RCAMT4" style="display:none1" type="text" value="0"><input class="RCAMT5" id="RCAMT5" name="RCAMT5" style="display:none1" type="text" value="0"><input class="RCAMT6" id="RCAMT6" name="RCAMT6" style="display:none1" type="text" value="0">
                                            </td>






                                            <td class="hide">
                                                <input class="TRANDNOP" id="TRANDNOP" name="TRANDNOP" type="text" value="@details.STFDNOP" readonly>

                                                <input class="TRANDQTY" id="TRANDQTY" name="TRANDQTY" type="text" value="@details.STFDQTY">

                                                @*<input class="CONTNRTID" id="CONTNRTID" name="CONTNRTID" type="text" value="@details.CONTNRTID">*@

                                                <input class="CONTNRSID" id="CONTNRSID" name="CONTNRSID" type="text" value="@details.CONTNRSID">

                                                <input class="TRANDEAMT" id="TRANDEAMT" name="TRANDEAMT" type="text" value="0" style="width:65px" readonly>
                                                <input class="TRANDPAMT" id="TRANDPAMT" name="TRANDPAMT" type="text" value="0" style="width:65px" readonly>
                                                <input class="TRANDFAMT" id="TRANDFAMT" name="TRANDFAMT" type="text" value="0" style="width:65px" readonly>

                                                <input class="RAMT1" id="RAMT1" name="RAMT1" style="display:none1" type="text" value="@details.RAMT1">
                                                <input class="RAMT2" id="RAMT2" name="RAMT2" style="display:none1" type="text" value="@details.RAMT2">
                                                <input class="RAMT3" id="RAMT3" name="RAMT3" style="display:none1" type="text" value="@details.RAMT3">
                                                <input class="days" id="days" name="days" style="display:none" type="text" value="0">
                                                <input class="RCAMT1" id="RCAMT1" name="RCAMT1" style="display:none1" type="text" value="@details.RCAMT1">
                                                <input class="RCAMT2" id="RCAMT2" name="RCAMT2" style="display:none1" type="text" value="@details.RCAMT2">
                                                <input class="RCAMT3" id="RCAMT3" name="RCAMT3" style="display:none1" type="text" value="@details.RCAMT3">
                                            </td>
                                            <td class="hide">
                                                <input class="RCOL1" id="RCOL1" name="RCOL1" style="display:none1" type="text" value="@details.RCOL1">
                                                <input class="RCOL2" id="RCOL2" name="RCOL2" style="display:none1" type="text" value="@details.RCOL2">
                                                <input class="RCOL3" id="RCOL3" name="RCOL3" style="display:none1" type="text" value="@details.RCOL3">
                                                <input class="RCOL4" id="RCOL4" name="RCOL4" style="display:none1" type="text" value="@details.RCOL4">
                                                <input class="RCOL5" id="RCOL5" name="RCOL5" style="display:none1" type="text" value="@details.RCOL5">
                                                <input class="RCOL6" id="RCOL6" name="RCOL6" style="display:none1" type="text" value="@details.RCOL6">
                                            </td>
                                            <td><a class="" id="del_detail"> <i class="glyphicon glyphicon-trash" style="color:#ff0000;font-size:large"></i></a></td>
                                        </tr>}
                                }
                                else
                                {
                                    <tr class="item-row">

                                        <td class="hide">
                                            <input class="STFDID" id="STFDID" name="STFDID" type="text" value="0" style="width:42px">
                                            <input class="TRANDID" id="TRANDID" name="TRANDID" style="display:none" type="text" value="0">
                                        </td>
                                        <td class="col-md-3">
                                            <input class="hide TRANDREFNO" id="TRANDREFNO" name="TRANDREFNO" type="text" value="" style="width:102px" readonly>
                                            @Html.DropDownList("FSTFDID", null, new { @id = "FSTFDID", @class = "FSTFDID form-control", @onchange = "GetDetails(this)" })
                                        </td>
                                        <td class="col-md-1">
                                            <input class="hide TRANDREFID" id="TRANDREFID" name="TRANDREFID" type="text" value="" style="width:102px" readonly>
                                            <input class="SIZE" id="SIZE" name="SIZE" type="text" value="" style="width:42px" readonly>
                                        </td>
                                        <td class="col-md-3">
                                            <input class="TRANIDATE" id="TRANIDATE" name="TRANIDATE" type="text" value="" readonly>
                                        </td>
                                        <td class="col-md-3">
                                            <input class="TRANSDATE" id="TRANSDATE" name="TRANSDATE" type="text" value="" readonly>
                                        </td>
                                        <td class="col-md-3">
                                            <input class="datepicker TRANEDATE" id="TRANEDATE" name="TRANEDATE" type="text" value="" onchange="calculation()">
                                        </td>
                                        <td class="col-md-2">
                                            <input class="TRANDSAMT" id="TRANDSAMT" name="TRANDSAMT" type="text" value="" style="width:65px" readonly>
                                        </td>
                                        <td class="col-md-2">
                                            <input class="TRANDHAMT" id="TRANDHAMT" name="TRANDHAMT" type="text" value="" style="width:65px" readonly>
                                        </td>

                                        <td class="col-md-2">
                                            <input class="TRANDNAMT" id="TRANDNAMT" name="TRANDNAMT" style="width:70px" type="text" value="" readonly>
                                        </td>




                                        <td class="hide">
                                            <input class="RAMT4" id="RAMT4" name="RAMT4" style="display:none1" type="text" value="0"><input class="RAMT5" id="RAMT5" name="RAMT5" style="display:none1" type="text" value="0"><input class="RAMT6" id="RAMT6" name="RAMT6" style="display:none1" type="text" value="0">
                                        </td>
                                        <td class="hide">
                                            <input class="SLABMIN" id="SLABMIN" name="SLABMIN" style="display:none1" type="text" value="0"><input class="SLABMAX" id="SLABMAX" name="SLABMAX" style="display:none1" type="text" value="0"><input class="SLABMIN1" id="SLABMIN1" name="SLABMIN1" style="display:none1" type="text" value="0"><input class="SLABMAX1" id="SLABMAX1" name="SLABMAX1" style="display:none1" type="text" value="0"><input class="SLABMIN2" id="SLABMIN2" name="SLABMIN2" style="display:none1" type="text" value="0"><input class="SLABMAX2" id="SLABMAX2" name="SLABMAX2" style="display:none1" type="text" value="0">
                                        </td>
                                        <td class="hide">
                                            <input class="RCAMT4" id="RCAMT4" name="RCAMT4" style="display:none1" type="text" value="0"><input class="RCAMT5" id="RCAMT5" name="RCAMT5" style="display:none1" type="text" value="0"><input class="RCAMT6" id="RCAMT6" name="RCAMT6" style="display:none1" type="text" value="0">
                                        </td>






                                        <td class="hide">
                                            <input class="TRANDNOP" id="TRANDNOP" name="TRANDNOP" type="text" readonly value="0">

                                            <input class="TRANDQTY" id="TRANDQTY" name="TRANDQTY" type="text" value="0">

                                            <input class="CONTNRSID" id="CONTNRSID" name="CONTNRSID" type="text" value="">
                                            <input class="TRANDEAMT" id="TRANDEAMT" name="TRANDEAMT" type="text" value="0" style="width:65px" readonly>
                                            <input class="TRANDPAMT" id="TRANDPAMT" name="TRANDPAMT" type="text" value="0" style="width:65px" readonly>
                                            <input class="TRANDFAMT" id="TRANDFAMT" name="TRANDFAMT" type="text" value="0" style="width:65px" readonly>

                                            <input class="RAMT1" id="RAMT1" name="RAMT1" style="display:none1" type="text">
                                            <input class="RAMT2" id="RAMT2" name="RAMT2" style="display:none1" type="text">
                                            <input class="RAMT3" id="RAMT3" name="RAMT3" style="display:none1" type="text">
                                            <input class="days" id="days" name="days" style="display:none" type="text" value="0">
                                            <input class="RCAMT1" id="RCAMT1" name="RCAMT1" style="display:none1" type="text">
                                            <input class="RCAMT2" id="RCAMT2" name="RCAMT2" style="display:none1" type="text">
                                            <input class="RCAMT3" id="RCAMT3" name="RCAMT3" style="display:none1" type="text">
                                        </td>
                                        <td class="hide">
                                            <input class="RCOL1" id="RCOL1" name="RCOL1" style="display:none1" type="text">
                                            <input class="RCOL2" id="RCOL2" name="RCOL2" style="display:none1" type="text">
                                            <input class="RCOL3" id="RCOL3" name="RCOL3" style="display:none1" type="text">
                                            <input class="RCOL4" id="RCOL4" name="RCOL4" style="display:none1" type="text">
                                            <input class="RCOL5" id="RCOL5" name="RCOL5" style="display:none1" type="text">
                                            <input class="RCOL6" id="RCOL6" name="RCOL6" style="display:none1" type="text">
                                        </td>
                                        <td><a class="" id="del_detail"> <i class="glyphicon glyphicon-trash" style="color:#ff0000;font-size:large"></i></a></td>
                                    </tr>
                                }

                            </tbody>
                        </table>




                        <table class='table table-striped table-bordered bootstrap-datatable'>
                            <tr>
                                <td><a href='#' id='cfact' class='btn btn-success btn-xs'><i class=glyphicon-plus></i> Tax</a>  </td>
                                <td align='right' colspan='4' class="gross">  Gross Amount </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANGAMT, new { @class = "form-control  TRANGAMT", @id = "TRANGAMT", @readonly = true, @onchange = "total()" })
                                </td>

                            </tr>

                            <tr>

                                <td colspan="6" class="cf_dynamic ">

                                    <table class='table table-striped table-bordered bootstrap-datatable' id='CFACTOR' style="padding:0;margin:0">
                                        <tr> <td> </td> <td>Cost Factror</td> <td colspan='3' class='col-lg-0'>Expression  & Nos </td> <td class='col-lg-0'>Mode</td> <td> </td> </tr>

                                        @if (Model.costfactor != null)
                                        {

                                            string exp = "";
                                            string mod = "";
                                            foreach (TransactionMasterFactor cfdetails in Model.costfactor)
                                            {
                                                exp = "";
                                                mod = "";



                                                if (cfdetails.DEDTYPE == 0)
                                                { exp = "selected"; }
                                                if (cfdetails.DEDMODE != "0")
                                                { mod = "selected"; }

                                                <tr>
                                                    <td> <button type='button' onclick='del_factor(this)' class='btn btn-danger dfact btn-xs'><i class=glyphicon-minus></i> </button>  </td>
                                                    <td>
                                                        <input type=text name='TAX' id=TAX style='display:none' class=TAX value="@cfdetails.CFID">
                                                        @cfdetails.DEDCFDESC
                                                        <input type=text name=CFDESC id=CFDESC class='CFDESC hide' value="@cfdetails.DEDCFDESC" onchange='total()'>
                                                    </td>
                                                    <td class='col-lg-1'><select id=CFTYPE name=CFTYPE class=CFTYPE onchange='total()'><option value='1'> %</option><option value='0' @exp>Value </option> </select></td>
                                                    <td class='col-lg-1'><input type=text id=DEDNOS name=DEDNOS class='DEDNOS' style="width:55px" value="@cfdetails.DEDNOS" onchange=' total()'></td>
                                                    <td class='col-lg-1'><input type=text id=CFEXPR name=CFEXPR class=CFEXPR value="@cfdetails.DEDEXPRN" onchange='total()'>   </td>
                                                    <td><select id=CFMODE name=CFMODE class=CFMODE onchange='total()'><option value='0'>+</option><option value='1' @mod>-</option> </select><input type=text id=DORDRID name=DORDRID style='display:none' class=DORDRID value="@cfdetails.DORDRID" onchange='total() '></td>
                                                    <td class="col-lg-0"><input type=text readonly="readonly" value="@cfdetails.DEDVALUE" name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT col-lg-0' onchange='total()'> <input style='display:none' type=text value="@cfdetails.TRANMFID" name=TRANMFID id='TRANMFID' class='TRANMFID'>  </td>
                                                </tr>
                                            }
                                        }
                                        @*else
                                        {
                                            <tr>
                                                <td></td>
                                                <td><input type=text name=TAX id='TAX' class='hide TAX' value=''><input type=text name=CFDESC id='CFDESC' class='CFDESC' value='' style="border:none" readonly></td>
                                                <td class='col-lg-1'> <select id='CFTYPE' name='CFTYPE' class='CFTYPE' onchange='total()'> <option value='1'>  %</option><option value='0'>Value </option> </select></td>
                                                <td class='col-lg-1'><input type='text' id='DEDNOS' class='DEDNOS' name='DEDNOS' value='0' readonly='readonly' style='width:50px'></td>
                                                <td class='col-lg-1'> <input onchange='total()' type=text value='' class='CFEXPR' name='CFEXPR' id='CFEXPR' readonly> </td>
                                                <td><select onchange='total()' class='CFMODE' id='CFMODE' name='CFMODE'> <option value='0'>  +</option><option value='1'>-</option> </select></td>
                                                <td><input type=text value='' name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT' readonly='readonly'> </td>
                                                <input type='text' id='DORDRID' value='' class='DORDRID' style='display:none' name='DORDRID'>
                                                <input type=text value='0' style='display:none' name=TRANMFID id='TRANMFID' class='TRANMFID'>
                                                <input type=text value='0' style='display:none' name=DEDORDR id='DEDORDR' class='DEDORDR'>
                                            </tr>


                                            <tr>
                                                <td></td>
                                                <td><input type=text name=TAX id='TAX' class='hide TAX' value=''><input style="border:none" type=text name=CFDESC id='CFDESC' class='CFDESC' value='' readonly></td>
                                                <td class='col-lg-1'> <select id='CFTYPE' name='CFTYPE' class='CFTYPE' onchange='total()'> <option value='1'>  %</option><option value='0'>Value </option> </select></td>
                                                <td class='col-lg-1'><input type='text' id='DEDNOS' class='DEDNOS' name='DEDNOS' value='0' readonly='readonly' style='width:50px'></td>
                                                <td class='col-lg-1'> <input onchange='total()' type=text value='' class='CFEXPR' name='CFEXPR' id='CFEXPR' readonly> </td>
                                                <td><select onchange='total()' class='CFMODE' id='CFMODE' name='CFMODE'> <option value='0'>  +</option><option value='1'>-</option> </select></td>
                                                <td><input type=text value='' name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT' readonly='readonly'> </td>
                                                <input type='text' id='DORDRID' value='' class='DORDRID' style='display:none' name='DORDRID'>
                                                <input type=text value='0' style='display:none' name=TRANMFID id='TRANMFID' class='TRANMFID'>
                                                <input type=text value='0' style='display:none' name=DEDORDR id='DEDORDR' class='DEDORDR'>
                                            </tr>

                                            <tr>
                                                <td></td>
                                                <td><input type=text name=TAX id='TAX' class='hide TAX' value=''><input style="border:none" type=text name=CFDESC id='CFDESC' class='CFDESC' value='' readonly></td>
                                                <td class='col-lg-1'> <select id='CFTYPE' name='CFTYPE' class='CFTYPE' onchange='total()'> <option value='1'>  %</option><option value='0'>Value </option> </select></td>
                                                <td class='col-lg-1'><input type='text' id='DEDNOS' class='DEDNOS' name='DEDNOS' value='0' readonly='readonly' style='width:50px'></td>
                                                <td class='col-lg-1'> <input onchange='total()' type=text value='' class='CFEXPR' name='CFEXPR' id='CFEXPR' readonly> </td>
                                                <td><select onchange='total()' class='CFMODE' id='CFMODE' name='CFMODE'> <option value='0'>  +</option><option value='1'>-</option> </select></td>
                                                <td><input type=text value='' name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT' readonly='readonly'> </td>
                                                <input type='text' id='DORDRID' value='' class='DORDRID' style='display:none' name='DORDRID'>
                                                <input type=text value='0' style='display:none' name=TRANMFID id='TRANMFID' class='TRANMFID'>
                                                <input type=text value='0' style='display:none' name=DEDORDR id='DEDORDR' class='DEDORDR'>
                                            </tr>
                                        }*@
                                    </table>
                                </td>
                            </tr>

                            <tr>
                                <td>   </td>
                                <td colspan='5' align='right'>
                                    <div class="hide1">
                                        @if (Model.shutoutviewdata != null)
                                        {
                                            <input type="text" id="STATETYPE" class="STATETYPE" name="STATETYPE" value="@Model.shutoutviewdata[0].STATETYPE" />
                                            <input type="text" id="STRG_HSN_CODE" class="STRG_HSN_CODE" name="STRG_HSN_CODE" value="@Model.shutoutviewdata[0].STRG_HSNCODE" />
                                            <input type="text" id="HANDL_HSN_CODE" class="HANDL_HSN_CODE" name="HANDL_HSN_CODE" value="@Model.shutoutviewdata[0].HANDL_HSNCODE" />
                                            <input type="text" id="STRG_TAXABLE_AMT" class="STRG_TAXABLE_AMT" name="STRG_TAXABLE_AMT" value="@Model.shutoutviewdata[0].STRG_TAXABLE_AMT" />
                                            <input type="text" id="HANDL_TAXABLE_AMT" class="HANDL_TAXABLE_AMT" name="HANDL_TAXABLE_AMT" value="@Model.shutoutviewdata[0].HANDL_TAXABLE_AMT" />
                                            <input type="text" id="STRG_CGST_EXPRN" class="STRG_CGST_EXPRN" name="STRG_CGST_EXPRN" value="@Model.shutoutviewdata[0].STRG_CGST_EXPRN" />
                                            <input type="text" id="STRG_SGST_EXPRN" class="STRG_SGST_EXPRN" name="STRG_SGST_EXPRN" value="@Model.shutoutviewdata[0].STRG_SGST_EXPRN" />
                                            <input type="text" id="STRG_IGST_EXPRN" class="STRG_IGST_EXPRN" name="STRG_IGST_EXPRN" value="@Model.shutoutviewdata[0].STRG_IGST_EXPRN" />
                                            <input type="text" id="STRG_CGST_AMT" class="STRG_CGST_AMT" name="STRG_CGST_AMT" value="@Model.shutoutviewdata[0].STRG_CGST_AMT" />
                                            <input type="text" id="STRG_SGST_AMT" class="STRG_SGST_AMT" name="STRG_SGST_AMT" value="@Model.shutoutviewdata[0].STRG_SGST_AMT" />
                                            <input type="text" id="STRG_IGST_AMT" class="STRG_IGST_AMT" name="STRG_IGST_AMT" value="@Model.shutoutviewdata[0].STRG_IGST_AMT" />
                                            <input type="text" id="HANDL_CGST_EXPRN" class="HANDL_CGST_EXPRN" name="HANDL_CGST_EXPRN" value="@Model.shutoutviewdata[0].HANDL_CGST_EXPRN" />
                                            <input type="text" id="HANDL_SGST_EXPRN" class="HANDL_SGST_EXPRN" name="HANDL_SGST_EXPRN" value="@Model.shutoutviewdata[0].HANDL_SGST_EXPRN" />
                                            <input type="text" id="HANDL_IGST_EXPRN" class="HANDL_IGST_EXPRN" name="HANDL_IGST_EXPRN" value="@Model.shutoutviewdata[0].HANDL_IGST_EXPRN" />
                                            <input type="text" id="HANDL_CGST_AMT" class="HANDL_CGST_AMT" name="HANDL_CGST_AMT" value="@Model.shutoutviewdata[0].HANDL_CGST_AMT" />
                                            <input type="text" id="HANDL_SGST_AMT" class="HANDL_SGST_AMT" name="HANDL_SGST_AMT" value="@Model.shutoutviewdata[0].HANDL_SGST_AMT" />
                                            <input type="text" id="HANDL_IGST_AMT" class="HANDL_IGST_AMT" name="HANDL_IGST_AMT" value="@Model.shutoutviewdata[0].HANDL_IGST_AMT" />

                                        }
                                        else
                                        {
                                            <input type="text" id="STATETYPE" class="STATETYPE" name="STATETYPE" value="0" />
                                            <input type="text" id="STRG_HSN_CODE" class="STRG_HSN_CODE" name="STRG_HSN_CODE" value="0" />
                                            <input type="text" id="HANDL_HSN_CODE" class="HANDL_HSN_CODE" name="HANDL_HSN_CODE" value="0" />
                                            <input type="text" id="STRG_TAXABLE_AMT" class="STRG_TAXABLE_AMT" name="STRG_TAXABLE_AMT" value="0" />
                                            <input type="text" id="HANDL_TAXABLE_AMT" class="HANDL_TAXABLE_AMT" name="HANDL_TAXABLE_AMT" value="0" />
                                            <input type="text" id="STRG_CGST_EXPRN" class="STRG_CGST_EXPRN" name="STRG_CGST_EXPRN" value="0" />
                                            <input type="text" id="STRG_SGST_EXPRN" class="STRG_SGST_EXPRN" name="STRG_SGST_EXPRN" value="0" />
                                            <input type="text" id="STRG_IGST_EXPRN" class="STRG_IGST_EXPRN" name="STRG_IGST_EXPRN" value="0" />
                                            <input type="text" id="STRG_CGST_AMT" class="STRG_CGST_AMT" name="STRG_CGST_AMT" value="0" />
                                            <input type="text" id="STRG_SGST_AMT" class="STRG_SGST_AMT" name="STRG_SGST_AMT" value="0" />
                                            <input type="text" id="STRG_IGST_AMT" class="STRG_IGST_AMT" name="STRG_IGST_AMT" value="0" />
                                            <input type="text" id="HANDL_CGST_EXPRN" class="HANDL_CGST_EXPRN" name="HANDL_CGST_EXPRN" value="0" />
                                            <input type="text" id="HANDL_SGST_EXPRN" class="HANDL_SGST_EXPRN" name="HANDL_SGST_EXPRN" value="0" />
                                            <input type="text" id="HANDL_IGST_EXPRN" class="HANDL_IGST_EXPRN" name="HANDL_IGST_EXPRN" value="0" />
                                            <input type="text" id="HANDL_CGST_AMT" class="HANDL_CGST_AMT" name="HANDL_CGST_AMT" value="0" />
                                            <input type="text" id="HANDL_SGST_AMT" class="HANDL_SGST_AMT" name="HANDL_SGST_AMT" value="0" />
                                            <input type="text" id="HANDL_IGST_AMT" class="HANDL_IGST_AMT" name="HANDL_IGST_AMT" value="0" />

                                        }
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>   </td>
                                <td colspan='4' align='right'> C.G.S.T. </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANCGSTAMT, new { @class = "form-control  TRANCGSTAMT ", @id = "TRANCGSTAMT", @readonly = true })
                                    @*<input type="text" id="TRANCGSTAMT" class="TRANCGSTAMT" name="TRANCGSTAMT" value="0" />*@
                                </td>
                            </tr>
                            <tr>
                                <td>   </td>
                                <td colspan='4' align='right'> S.G.S.T. </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANSGSTAMT, new { @class = "form-control  TRANSGSTAMT ", @id = "TRANSGSTAMT", @readonly = true })
                                    @*<input type="text" id="TRANSGSTAMT" class="TRANSGSTAMT" name="TRANSGSTAMT" value="0" />*@
                                </td>
                            </tr>
                            <tr>
                                <td>   </td>
                                <td colspan='4' align='right'> I.G.S.T. </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANIGSTAMT, new { @class = "form-control  TRANIGSTAMT ", @id = "TRANIGSTAMT", @readonly = true })
                                    @*<input type="text" id="TRANIGSTAMT" class="TRANIGSTAMT" name="TRANIGSTAMT" value="0" />*@
                                </td>
                            </tr>


                            <tr>
                                <td>   </td>
                                <td colspan='4' align='right'> Rounding Off </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANROAMT, new { @class = "form-control  TRANROAMT ", @id = "TRANROAMT", @readonly = true })
                                </td>
                            </tr>
                            <tr>
                                <td>   </td>
                                <td colspan='4' align='right'> Net Amount </td>
                                <td>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANNAMT, new { @class = "form-control  TRANNAMT ", @id = "TRANNAMT", @readonly = true })
                                </td>
                            </tr>
                        </table>
                        <fieldset style="width:100%">
                            <legend style="font-size:large">Bank Details</legend>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Mode</label>
                                    <br />
                                    @Html.DropDownList("TRANMODE", null, "Select", new { @class = "form-control TRANMODE", @id = "TRANMODE", @onchange = "ModeChange()", tabindex = "5000" })
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANMODEDETL, new { @class = "hide form-control  TRANMODEDETL", @id = "TRANMODEDETL" })


                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Number</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFNO, new { @class = "form-control  TRANREFNO", @id = "TRANREFNO", tabindex = "5002" })
                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Date</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFDATE, "{0:dd/MM/yyyy}", new { @class = "form-control  datepicker TRANREFDATE", @id = "TRANREFDATE", @data_val = false, tabindex = "5004" })
                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Amount</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFAMT, new { @class = "form-control  TRANREFAMT", @id = "TRANREFAMT", tabindex = "5006" })
                                </div>
                            </div>
                            <div class=" col-md-4">
                                <div class="form-group">
                                    <label>Bank</label>
                                    @Html.DropDownList("BANKMID", null, "Please Select an Option", new { @class = "form-control BANKMID", @id = "BANKMID", tabindex = "5008" })

                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANREFBNAME, new { @class = "hide form-control  TRANREFBNAME", @id = "TRANREFBNAME" })
                                </div>
                            </div>
                            <div class=" col-md-4">
                                <div class="form-group">
                                    <label>Remarks</label>
                                    @Html.TextBoxFor(model => Model.masterdata[0].TRANRMKS, new { @class = "form-control  TRANRMKS", @id = "TRANRMKS" })
                                </div>
                            </div>

                            <div class=" col-md-2">
                                <div class="form-group">
                                    <label>Status </label>
                                    @Html.DropDownList("DISPSTATUS", null, new { @class = "form-control DISPSTATUS", @id = "DISPSTATUS" })


                                </div>
                            </div>

                        </fieldset>
                        <div class="hide">

                            <input type="text" id="TRANTCAMT" class="TRANTCAMT hidden1" name="TRANTCAMT" />
                            <input type="text" id="TRANSAMT" class="TRANSAMT hidden1" name="TRANSAMT" />
                            <input type="text" id="TRANHAMT" class="TRANHAMT hidden1" name="TRANHAMT" />

                        </div>

                        <div class="col-md-12 box-footer">
                            <input type="button" name="back" value="Go Back" class="btn btn-primary btn-xs  pull-left" onclick="JavaScript:history.back()" />
                            <input type="button" name="submit2" value="Save as Estimate" class="btn btn-warning btn-xs hidden " hidden />
                            <input type="submit" name="submit" value="Submit" class="btn btn-success btn-xs  " id="save" tabindex="5010" />

                        </div>

                    </fieldset>
                </form>
            </div>



        </div>
    </div>
</div>
@section Scripts {
    @*<script src="~/Scripts/Invoice-costfactor.js"></script>*@
    <script type="text/javascript">
    function GetDetails(obj) {

        row = obj.parentNode.parentNode.rowIndex;
        row = row - 1;
        var $tableBody = $('#TDETAIL').find("tbody")
        $trCur = $tableBody.find("tr:eq(" + row + ")");
        var FSTFDID = $trCur.find(".FSTFDID option:selected").val();
        var url = "/ShutOutInvoice/GetContDetails/" + FSTFDID;
       // alert(url);
        $.ajax({
            url: url,
            dataType: 'json',
            success: function (data) {

                $trCur.find(".TRANDREFNO").val(data[0].CONTNRNO);
                $trCur.find(".TRANIDATE").val(GetFormattedDate(data[0].GIDATE));
                $trCur.find(".TRANSDATE").val(GetFormattedDate(data[0].STFDSBDDATE));
                if(data[0].GODATE!=null)  $trCur.find(".TRANEDATE").val(GetFormattedDate(data[0].GODATE));
                $trCur.find(".SIZE").val(data[0].CONTNRSDESC);
                $trCur.find(".TRANDREFID").val(data[0].GIDID);
                $trCur.find(".CONTNRSID").val(data[0].CONTNRSID);
                $trCur.find('.TRANDNOP').val(data[0].GPNOP);
                $trCur.find('.TRANDQTY').val(data[0].GPWGHT);
                calculation();
            }

        });//----End of function

    }
    function GetFormattedDate(obj) {
        var MyDate_String_Value = obj;
        var value1 = new Date
                    (
                         parseInt(MyDate_String_Value.replace(/(^.*\()|([+-].*$)/g, ''))
                    );
        var dat = value1.getDate() +
                               "-" +
                   eval(value1.getMonth() + 1) +
                               "-" +
               value1.getFullYear();
        return dat;
    }
        $(document).ready(function () {

          //  if ($(".TRANREFID").val() == "") { $("#job_list").html("<div class='msg'>No Details Exists!!</div>"); }
        stuffing_autocomplete($("#TRANREFNAME"), "TRANREFNAME,TRANREFID");//---AUTOCOMPLETE FUNCTION FOR GET DETAIL GRID-----

            //var stax = $(".STAX option:selected").val();
            //alert(stax);
        var statetype = $("#STATETYPE").val();
        var slabtid = 2;
        url = "/StuffingBill/GetExportGSTRATE";
        $.ajax({
            type: 'post',
            url: url,
            data: { id: statetype + "~" + slabtid },
            dataType: 'json',
            success: function (data) {
                if (data.length != 0)
                    //$("#Q_NOC").val(data);
                {
                    $(".STRG_HSN_CODE").val(data[0].HSNCODE);
                    $(".STRG_CGST_EXPRN").val(data[0].CGSTEXPRN);
                    $(".STRG_SGST_EXPRN").val(data[0].SGSTEXPRN);
                    $(".STRG_IGST_EXPRN").val(data[0].IGSTEXPRN);
                }
                else {
                    $("#STRG_HSN_CODE").val("");
                    $("#STRG_CGST_EXPRN").val("0");
                    $("#STRG_SGST_EXPRN").val("0");
                    $("#STRG_IGST_EXPRN").val("0");
                }

            }
        });



        var statetype = $("#STATETYPE").val();
        var slabtid = 4;
        url = "/StuffingBill/GetExportGSTRATE";
        $.ajax({
            type: 'post',
            url: url,
            data: { id: statetype + "~" + slabtid },
            dataType: 'json',
            success: function (data) {
                if (data.length != 0)
                    //$("#Q_NOC").val(data);
                {
                    $(".HANDL_HSN_CODE").val(data[0].HSNCODE);
                    $(".HANDL_CGST_EXPRN").val(data[0].CGSTEXPRN);
                    $(".HANDL_SGST_EXPRN").val(data[0].SGSTEXPRN);
                    $(".HANDL_IGST_EXPRN").val(data[0].IGSTEXPRN);
                }
                else {
                    $("#HANDL_HSN_CODE").val("");
                    $("#HANDL_CGST_EXPRN").val("0");
                    $("#HANDL_SGST_EXPRN").val("0");
                    $("#HANDL_IGST_EXPRN").val("0");
                }

            }
        });

        //-----date controls-------------
        $(".datepicker").datepicker({ dateFormat: 'dd/mm/yy', });
        $('.datetime').datetimepicker({
            dateFormat: 'dd/mm/yy',
            timeFormat: 'hh:mm'
        });
        //$('.time').timepicker();


        if ($("#TRANMID").val() == 0) {
            var dt = new Date();
            var month = dt.getMonth() + 1;
            var date = dt.getDate() + "/" + month + "/" + dt.getFullYear();
            var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();
            var datetme = time;
            $(".TRANTIME").val(date + " " + datetme);
            calculation();
        }
        else {
            total();
        }
       //...End of date contrl..

        //.......GET BANK NAME FROM DROPDOWN VALUE ...........
        $("#BANKMID").change(function () {
            var TRANREFBNAME = $(".BANKMID option:selected").text();
            $(".TRANREFBNAME").val(TRANREFBNAME);
        });
        //...END
        ModeChange();
       // .............VALIDATION FOR TARIFF BEFORE SELECT CHA...........

        $(".TARIFFMID").on("focus", function () {
            var CHAID = $(".TRANREFID").val();
            if (CHAID == "") {
                alert("Please Select CHA First");
                $("#TARIFFMID").hide();
                //$('TARIFFMID option:eq(0)').removeAttr('selected');
            }

            return false;
        });
        $("#TRANREFNAME").focus(function () {
            var TRANREFID = $(".TRANREFID").val();
            $("#TARIFFMID").show();
        }); //........END OF VALIDATION


//...........Calculation on Tariff Change........//
        //$(".TARIFFMID").change(function () {


        //    calculation();
        //    total();

        //});
//.....End

//.........TARIFFMTID FROM TARIFFMASTER.....................//
        $("#TARIFFMID").on("blur", function () {
            var TARIFFTMID = $("#TARIFFMID option:selected").val();
            var url = "/ShutOutInvoice/TARIFFTMID/" + TARIFFTMID;
            $.ajax({
                url: url,
                dataType: 'json',
                async: false,
                success: function (data) {

                    $(".TARIFFTMID").val(data);
                }

            });//----End of function
        });

    });



        //start
        function GetRateType() {
            alert($("#STATETYPE").val());



            //var statetype = $("#STATETYPE").val();
            //var slabtid = 2;
            ////alert(statetype);
            //url = "/StuffingBill/GetExportGSTRATE";
            //$.ajax({
            //    type: 'post',
            //    url: url,
            //    data: { id: statetype + "~" + slabtid },
            //    dataType: 'json',
            //    success: function (data) {
            //        if (data.length != 0)
            //            //$("#Q_NOC").val(data);
            //        {
            //            $(".STRG_HSN_CODE").val(data[0].HSNCODE);
            //            $(".STRG_CGST_EXPRN").val(data[0].CGSTEXPRN);
            //            $(".STRG_SGST_EXPRN").val(data[0].SGSTEXPRN);
            //            $(".STRG_IGST_EXPRN").val(data[0].IGSTEXPRN);
            //        }
            //        else {
            //            $("#STRG_HSN_CODE").val("");
            //            $("#STRG_CGST_EXPRN").val("0");
            //            $("#STRG_SGST_EXPRN").val("0");
            //            $("#STRG_IGST_EXPRN").val("0");
            //        }

            //    }
            //});



            var statetype = $("#STATETYPE").val();
            var slabtid = 4;
            //alert(statetype);
            url = "/StuffingBill/GetExportGSTRATE";
            $.ajax({
                type: 'post',
                url: url,
                data: { id: statetype + "~" + slabtid },
                dataType: 'json',
                success: function (data) {
                    if (data.length != 0)
                        //$("#Q_NOC").val(data);
                    {
                        $(".HANDL_HSN_CODE").val(data[0].HSNCODE);
                        $(".HANDL_CGST_EXPRN").val(data[0].CGSTEXPRN);
                        $(".HANDL_SGST_EXPRN").val(data[0].SGSTEXPRN);
                        $(".HANDL_IGST_EXPRN").val(data[0].IGSTEXPRN);
                    }
                    else {
                        $("#HANDL_HSN_CODE").val("");
                        $("#HANDL_CGST_EXPRN").val("0");
                        $("#HANDL_SGST_EXPRN").val("0");
                        $("#HANDL_IGST_EXPRN").val("0");
                    }

                }
            });



        }
        //end


//......end
//.......................TRANMODE change event..................//

        function ModeChange() {
            var modeval = $("#TRANMODE").val();
            if ($("#TRANMID").val() == "0") {
                var TRANMODEVAL = $("#TRANMODE option:selected").text();
                $(".TRANMODEDETL").val(TRANMODEVAL);
                $("#TRANREFNO").val("");
                $("#TRANREFDATE").val("");
                $("#BANKMID").val("");
            }
            if (modeval != 2 && modeval != 3) {
                $("#TRANREFNO").attr('disabled', true);
                $("#TRANREFDATE").attr('disabled', true);
                $("#BANKMID").attr('disabled', true);
            }
            else {
                $("#TRANREFNO").attr('disabled', false);
                $("#TRANREFDATE").attr('disabled', false);
                $("#BANKMID").attr('disabled', false);
            }
        }
//.............End



//...............Window bind..........................//

        $(window).bind("load", function () {
            if ($(".TRANMID").val() == "") {
                $(".TRANMID").val("0");
            }
            if ($(".TRANDID").val() == "") {
                $(".TRANDID").val("0");
            }
            count = 500;
            $('.TRANDID').each(function (k) {

                $("#TDETAIL #TRANDID,#TRANEDATE").attr('tabindex', count++);
            });

            txcount = 1000;
            $('.TAX').each(function (k) {

                $("#CFACTOR input:text,#CFACTOR select,#CFACTOR a").attr('tabindex', txcount++);
            });

            //..........Displaying Cost Factor insert mode....//
            if ($(".TRANMID").val() == 0) {
                base = window.location.origin;
                var $tableBody = $('#CFACTOR').find("tbody"),
                 $trLast = $tableBody.find("tr:last");
                $.ajax({
                    url: base + "/ShutOutInvoice/DefaultCF",
                    type: "POST",

                    success: function (data, textStatus, jqXHR) {
                        //data - response from server
                       // alert(data.length);

                        for (var i = 0; i < data.length; i++) {
                            //  alert(data.length + "........" + data[i].CFEXPR + "..." + data[i].CFID + "...." + data[i].CFDESC);

                            $(".TAX")[i].value = data[i].CFID;
                            $(".CFDESC")[i].value = data[i].CFDESC;
                            $(".CFEXPR")[i].value = data[i].CFEXPR;
                            $(".CFTYPE")[i].value = data[i].CFTYPE;
                            $(".CFMODE")[i].value = data[i].CFMODE;
                            $(".DORDRID")[i].value = data[i].DORDRID;
                        }
                        if (data[2].DISPSTATUS == 1) {
                            $("#TMP_KKC").addClass("frm_hide");
                        } else {
                            $("#TMP_KKC").removeClass("frm_hide");
                        }

                    },
                    error: function (jqXHR, textStatus, errorThrown) {

                    }
                });

                ModeChange();
            }//....................end






        i = 0;
        $(".TRANDID").each(function () {

            TRANDID = $(".TRANDID")[i].value;
            if(TRANDID == 0) {
                if ($(".TRANEDATE")[i].value == "") {
                    var M_date = $(".TRANTIME").val();
                    $(".TRANEDATE")[i].value = M_date;

                }
            }
            i++;

        });
    });//.......end of bind


    //..................FUNCTION TO GET DETAIL GRID..............

    function stuffing_autocomplete($obj, controls) {
        var oldFn = $.ui.autocomplete.prototype._renderItem;
        $.ui.autocomplete.prototype._renderItem = function (ul, item) {
            var re = new RegExp(this.term, "i");
            var t = item.label.replace(re, "<strong style='font-weight:bold;background:#C7DFFE;border-radius:2px;border:1px solid #98B8E1'>" + this.term + "</strong>");
            return $("<li></li>")
                .data("item.autocomplete", item)
                .append("<a>" + t + "</a>")
                .appendTo(ul);
        };
        $obj.autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: $obj.data("autocomplete-url"),
                    type: "POST",
                    dataType: "json",
                    data: {
                        term: request.term
                    },
                    success: function (data) {
                        response($.map(data, function (item) {
                            count = 0;
                            item_str = "";
                            var jsonArg = new Object();
                            count = 0;
                            $.each(item, function (i, data) {
                                switch (count) {
                                    case 0:
                                        jsonArg.label = data;
                                        jsonArg.value = data;
                                        break;
                                    case 1:
                                        jsonArg.id = data;
                                        break;
                                    case 2:
                                        jsonArg.desc = data;
                                        break;
                                    case 3:
                                        jsonArg.xparam1 = data;
                                        break;
                                    case 4:
                                        jsonArg.xparam2 = data;
                                        break;
                                    case 5:
                                        jsonArg.xparam3 = data;
                                        break
                                }
                                count++
                            });
                            return jsonArg
                        }))
                    }
                })
            },
            search: function () {
                var term = extractLast(this.value);
                if (term.length < 2) {
                    return false
                }
            },
            select: function (event, ui) {
                $(this).val(ui.item.label);
                count = 0;
                $.each(controls.split(','), function (index, value) {
                    switch (count) {
                        case 1:
                            $("#" + value).val(ui.item.id);
                            break;
                        case 2:
                            $("#" + value).val(ui.item.desc);
                            break;
                        case 3:
                            $("#" + value).val(ui.item.xparam1);
                            break;
                        case 4:
                            $("#" + value).val(ui.item.xparam2);
                            break;
                        case 5:
                            $("#" + value).val(ui.item.xparam3);
                            break;
                    }
                    count++
                });


                $(".FSTFDID").empty();
                $.ajax({

                    type: 'get',
                    url: '@Url.Action("GetCont", "ShutOutInvoice")/' + $(".TRANREFID").val(), // we are calling json method

                    success: function (data) {
                        // alert(data);
                        $(".FSTFDID").append('<option>Select</option>');
                        $.each(data, function (i, dataval) {
                            $(".FSTFDID").append('<option value="' + dataval.STFDID + '">' + dataval.CONTNRNO + '</option>');

                        });
                       // $(".TRANDREFNO").val();

                    },
                    error: function (ex) {
                        alert('Failed to data ' + ex);
                    }
                });
               // return false;

                return false;
            },
            messages: {
                noResults: "",
                results: ""
            }
        })
    }////......end

    //........DATE DIFFERENCE.....................
        function datdidff(start_date, end_date) {
            if (start_date.match("/")) { start_date = start_date.split("/"); }
            else if (start_date.match("-")) { start_date = start_date.split("-"); }

            if (end_date.match("/")) { end_date = end_date.split("/"); }
            else if (end_date.match("-")) { end_date = end_date.split("-"); }
         // end_date = end_date.split("/");


        start_date = start_date[2] + "-" + start_date[1] + "-" + start_date[0];
        end_date = end_date[2] + "-" + end_date[1] + "-" + end_date[0];

        var diff = Math.floor((Date.parse(end_date.replace(/-/g, '\/')) - Date.parse(start_date.replace(/-/g, '\/'))) / 86400000);

        return diff;

    }//......end

//......Storage Calculation............//
    function calculation() {

        var CHRGETYPE = $("#TRANBTYPE").val();
        var TARIFFMID = $("#TARIFFMID").val();
        var CHAID = $("#TRANREFID").val();
        i = 0;
        //alert(1);
        $(".TRANDID").each(function () {

           $(".RAMT1")[i].value = 0.00;
            $(".RAMT2")[i].value = 0.00;
            $(".RAMT3")[i].value = 0.00;
            $(".RAMT4")[i].value = 0.00;
            $(".RAMT5")[i].value = 0.00;
            $(".RAMT6")[i].value = 0.00;

            $(".SLABMIN")[i].value = 0;
            $(".SLABMAX")[i].value = 0;
            $(".SLABMIN1")[i].value = 0;
            $(".SLABMAX1")[i].value = 0;
            $(".SLABMIN2")[i].value = 0;
            $(".SLABMAX2")[i].value = 0;

            $(".RCOL1")[i].value = 0.00;
            $(".RCOL2")[i].value = 0.00;
            $(".RCOL3")[i].value = 0.00;
            $(".RCOL4")[i].value = 0.00;
            $(".RCOL5")[i].value = 0.00;
            $(".RCOL6")[i].value = 0.00;

            $(".RCAMT1")[i].value = 0.00;
            $(".RCAMT2")[i].value = 0.00;
            $(".RCAMT3")[i].value = 0.00;
            $(".RCAMT4")[i].value = 0.00;
            $(".RCAMT5")[i].value = 0.00;
            $(".RCAMT6")[i].value = 0.00;
            $(".TRANDSAMT")[i].value = 0.00;


            $(".TRANDHAMT")[i].value = 0.00;
            $(".TRANDEAMT")[i].value = 0.00;
            $(".TRANDFAMT")[i].value = 0.00;
            $(".TRANDPAMT")[i].value = 0.00;
            var CONTNRSID = $(".CONTNRSID")[i].value;
            var TRANMID = $("#TRANMID").val();
            var CHAID = $("#TRANREFID").val();
            base = window.location.origin;


          //  alert("contiz" + $(".CONTNRSID")[i].value);
            var url = "/ShutOutInvoice/Bill_Detail/" + TARIFFMID + "-" + CHRGETYPE + "-" + CONTNRSID + "-" + CHAID /*+ "-" + $(".ETOPID").val()*/;
           // alert(url);
            $.ajax({
                url: url,
                dataType: 'json',
                async: false,
                success: function (data) {

                    for (var k = 0; k < data.length; k++) {
                        alert(data[k].SLABAMT + "typ" + data[k].SLABTID);
                        if (data[k].SLABTID == 14) { $(".TRANDEAMT")[i].value = "0.00"; }
                        //else if (data[k].SLABTID == 5) {  $(".TRANDHAMT")[i].value = data[k].SLABAMT; }

                        else if (data[k].SLABTID == 15) { $(".TRANDFAMT")[i].value = "0.00"; }
                        else if (data[k].SLABTID == 16) { $(".TRANDPAMT")[i].value = "0.00"; }
                        else { $(".TRANDHAMT")[i].value = data[k].SLABAMT; }
                    }
                    if (isNaN($(".TRANDHAMT")[i].value))
                        $(".TRANDHAMT")[i].value = 0;
                    if (isNaN($(".TRANDEAMT")[i].value))
                        $(".TRANDEAMT")[i].value = 0;

                    if (isNaN($(".TRANDFAMT")[i].value))
                        $(".TRANDFAMT")[i].value = 0;
                    if (isNaN($(".TRANDPAMT")[i].value))
                        $(".TRANDPAMT")[i].value = 0;

                }
            });




            i++;
        });


        var CHRGETYPE = $("#TRANBTYPE").val();
        var TARIFFMID = $("#TARIFFMID").val();
        var CHAID = $("#TRANREFID").val();
        i = 0;
        RCAMT1 = 0;
        RCAMT2 = 0;
        RCAMT3 = 0;
        $(".TRANDID").each(function () {

            var CONTNRSID = $(".CONTNRSID")[i].value;
            var SDATE = $(".TRANSDATE")[i].value;

            if ($(".TRANEDATE")[i].value == "") {
                var M_date = $(".TRANTIME").val();
                $(".TRANEDATE")[i].value = M_date;

            }
            var EDATE = $(".TRANEDATE")[i].value;
            var s = SDATE.substring(0, 10);
            var e = EDATE.substring(0, 10);

            var days = datdidff(s, e);
            //alert(days);
            $(".days")[i].value = days + 1;


            var SLABMIN = $(".days")[i].value;

            var TRANDID = $(".TRANDID").val();

            var url = "/ShutOutInvoice/RATECARD/" + TARIFFMID + "-" + CHRGETYPE + "-" + CONTNRSID + "-" + CHAID + "-" + SLABMIN;
        //    alert(url);
            $.ajax({
                url: url,

                async: false,
                success: function (data) {

                   var len=data.length;

                   //alert(len);
                   if (len == 1) {
                       
                       $(".RAMT1")[i].value = data[0].SLABAMT;
                       $(".RAMT2")[i].value = 0;
                       $(".RAMT3")[i].value = 0;
                       $(".RAMT5")[i].value = 0;
                       $(".RAMT6")[i].value = 0;


                       $(".SLABMIN")[i].value = data[0].SLABMIN;
                       $(".SLABMAX")[i].value = data[0].SLABMAX;


                       $(".SLABMIN1")[i].value =0;
                       $(".SLABMAX1")[i].value = 0;

                       $(".SLABMIN2")[i].value = 0;
                       $(".SLABMAX2")[i].value = 0;


                       var slabmin = $(".SLABMIN")[i].value;
                       var slabmax = $(".SLABMAX")[i].value;
                      // var mmdiff = ($(".SLABMIN")[i].value) - ($(".SLABMAX")[i].value);

                      // var slabmin1 = $(".SLABMIN1")[i].value;
                     //  var slabmax1 = $(".SLABMAX1")[i].value;


                       //$(".RCOL1")[i].value = Math.abs(mmdiff);
                       $(".RCOL1")[i].value = (Math.abs((slabmin - (($(".days")[i].value)))) + 1);

                       var ramt1 = $(".RAMT1")[i].value;
                      // var ramt2 = $(".RAMT2")[i].value;


                     //  var rcamt1 = ramt1 * Math.abs(mmdiff);
                       var rcamt1 = ramt1 * $(".RCOL1")[i].value;


                       $(".RCAMT1")[i].value = rcamt1;
                       $(".RCAMT2")[i].value = 0;
                       $(".RCAMT3")[i].value = 0;

                       $(".RCAMT4")[i].value = 0;
                       $(".RCAMT5")[i].value = 0;
                       $(".RCAMT6")[i].value = 0;

                   }
                  else if (len == 2) {
                      //alert(data[0].SLABAMT);
                       $(".RAMT1")[i].value = data[0].SLABAMT;
                       $(".RAMT2")[i].value = data[1].SLABAMT;
                       $(".RAMT3")[i].value = 0;
                       $(".RAMT5")[i].value = 0;
                       $(".RAMT6")[i].value = 0;


                       $(".SLABMIN")[i].value = data[0].SLABMIN;
                       $(".SLABMAX")[i].value = data[0].SLABMAX;


                       $(".SLABMIN1")[i].value = data[1].SLABMIN;
                       $(".SLABMAX1")[i].value = data[1].SLABMAX;

                       $(".SLABMIN2")[i].value = 0;
                       $(".SLABMAX2")[i].value = 0;


                       var slabmin = $(".SLABMIN")[i].value;
                       var slabmax = $(".SLABMAX")[i].value;
                       var mmdiff = ($(".SLABMIN")[i].value) - ($(".SLABMAX")[i].value);

                       var slabmin1 = $(".SLABMIN1")[i].value;
                       var slabmax1 = $(".SLABMAX1")[i].value;


                       $(".RCOL1")[i].value = Math.abs(mmdiff);
                       $(".RCOL2")[i].value = (Math.abs((slabmin1 - (($(".days")[i].value)))) + 1);

                       var ramt1 = $(".RAMT1")[i].value;
                       var ramt2 = $(".RAMT2")[i].value;


                       var rcamt1 = ramt1 * Math.abs(mmdiff);
                       var rcamt2 = ramt2 * $(".RCOL2")[i].value;


                       $(".RCAMT1")[i].value = rcamt1;
                       $(".RCAMT2")[i].value = rcamt2;
                       $(".RCAMT3")[i].value = 0;

                       $(".RCAMT4")[i].value = 0;
                       $(".RCAMT5")[i].value = 0;
                       $(".RCAMT6")[i].value = 0;

                   }
                  else if(len==3)
                  {

                       $(".RAMT1")[i].value = data[0].SLABAMT;
                       $(".RAMT2")[i].value = data[1].SLABAMT;
                       $(".RAMT3")[i].value = data[2].SLABAMT;
                       $(".RAMT4")[i].value = 0;
                       $(".RAMT5")[i].value = 0;
                       $(".RAMT6")[i].value = 0;

                       $(".SLABMIN")[i].value = data[0].SLABMIN;
                       $(".SLABMAX")[i].value = data[0].SLABMAX;

                       $(".SLABMIN1")[i].value = data[1].SLABMIN;
                       $(".SLABMAX1")[i].value = data[1].SLABMAX;

                       $(".SLABMIN2")[i].value = data[2].SLABMIN;
                       $(".SLABMAX2")[i].value = data[2].SLABMAX;


                       var slabmin = $(".SLABMIN")[i].value;
                       var slabmax = $(".SLABMAX")[i].value;
                       var mmdiff = ($(".SLABMIN")[i].value) - ($(".SLABMAX")[i].value);


                       var slabmin1 = $(".SLABMIN1")[i].value;
                       var slabmax1 = $(".SLABMAX1")[i].value;
                       var mmdiff1 = (($(".SLABMAX1")[i].value) - ($(".SLABMIN1")[i].value)) + parseInt(1);

                       var slabmin2 = $(".SLABMIN2")[i].value;
                       var slabmax2 = $(".SLABMAX2")[i].value;


                       var ramt1 = $(".RAMT1")[i].value;
                       var ramt2 = $(".RAMT2")[i].value;
                       var ramt3 = $(".RAMT3")[i].value;


                       $(".RCOL1")[i].value =Math.abs(parseFloat(mmdiff));
                       $(".RCOL2")[i].value = Math.abs(parseFloat(mmdiff1));
                       $(".RCOL3")[i].value = (Math.abs((slabmin2 - (($(".days")[i].value))))+1);

                       var rcamt1 = ramt1 * Math.abs(mmdiff);
                       var rcamt2 = ramt2 * Math.abs(mmdiff1);
                       var rcamt3 = ramt3 * $(".RCOL3")[i].value;

                       $(".RCAMT1")[i].value = rcamt1;
                       $(".RCAMT2")[i].value = rcamt2;
                       $(".RCAMT3")[i].value = rcamt3;

                       $(".RCAMT4")[i].value = 0;
                       $(".RCAMT5")[i].value = 0;
                       $(".RCAMT6")[i].value = 0;


                  }
                  else if (len == 4) {

                      $(".RAMT1")[i].value = data[0].SLABAMT;
                      $(".RAMT2")[i].value = data[1].SLABAMT;
                      $(".RAMT3")[i].value = data[2].SLABAMT;
                      $(".RAMT4")[i].value = data[3].SLABAMT;
                      $(".RAMT5")[i].value = 0;
                      $(".RAMT6")[i].value = 0;

                      $(".SLABMIN")[i].value = data[0].SLABMIN;
                      $(".SLABMAX")[i].value = data[0].SLABMAX;

                      $(".SLABMIN1")[i].value = data[1].SLABMIN;
                      $(".SLABMAX1")[i].value = data[1].SLABMAX;

                      $(".SLABMIN2")[i].value = data[2].SLABMIN;
                      $(".SLABMAX2")[i].value = data[2].SLABMAX;

                      $(".SLABMIN3")[i].value = data[3].SLABMIN;
                      $(".SLABMAX3")[i].value = data[3].SLABMAX;

                      var slabmin = $(".SLABMIN")[i].value;
                      var slabmax = $(".SLABMAX")[i].value;
                      var mmdiff = ($(".SLABMIN")[i].value) - ($(".SLABMAX")[i].value);


                      var slabmin1 = $(".SLABMIN1")[i].value;
                      var slabmax1 = $(".SLABMAX1")[i].value;
                      var mmdiff1 = (($(".SLABMAX1")[i].value) - ($(".SLABMIN1")[i].value)) + parseInt(1);

                      var slabmin2 = $(".SLABMIN2")[i].value;
                      var slabmax2 = $(".SLABMAX2")[i].value;
                      var mmdiff2 = (($(".SLABMAX2")[i].value) - ($(".SLABMIN2")[i].value)) + parseInt(1);

                      var ramt1 = $(".RAMT1")[i].value;
                      var ramt2 = $(".RAMT2")[i].value;
                      var ramt3 = $(".RAMT3")[i].value;
                      var ramt4 = $(".RAMT4")[i].value;


                      $(".RCOL1")[i].value = Math.abs(mmdiff);
                      $(".RCOL2")[i].value = Math.abs(mmdiff1);
                      $(".RCOL3")[i].value = Math.abs(mmdiff2);
                      $(".RCOL4")[i].value = (Math.abs((slabmin3 - (($(".days")[i].value)))) + 1);

                      var rcamt1 = ramt1 * Math.abs(mmdiff);
                      var rcamt2 = ramt2 * Math.abs(mmdiff1);
                      var rcamt3 = ramt3 * Math.abs(mmdiff2);
                      var rcamt4 = ramt4 * $(".RCOL4")[i].value;

                      $(".RCAMT1")[i].value = rcamt1;
                      $(".RCAMT2")[i].value = rcamt2;
                      $(".RCAMT3")[i].value = rcamt3;

                      $(".RCAMT4")[i].value = rcamt4;
                      $(".RCAMT5")[i].value = 0;
                      $(".RCAMT6")[i].value = 0;


                  }
                  else if (len == 6) {
                      $(".RAMT1")[i].value = data[0].SLABAMT;
                      $(".RAMT2")[i].value = data[1].SLABAMT;
                      $(".RAMT3")[i].value = data[2].SLABAMT;
                      $(".RAMT4")[i].value = data[3].SLABAMT;
                      $(".RAMT5")[i].value = data[4].SLABAMT;
                      $(".RAMT6")[i].value = data[5].SLABAMT;

                    $(".SLABMIN")[i].value = data[0].SLABMIN;
                    $(".SLABMAX")[i].value = data[0].SLABMAX;

                    $(".SLABMIN1")[i].value = data[1].SLABMIN;
                    $(".SLABMAX1")[i].value = data[1].SLABMAX;

                    $(".SLABMIN2")[i].value = data[2].SLABMIN;
                    $(".SLABMAX2")[i].value = data[2].SLABMAX;

                    $(".SLABMIN3")[i].value = data[3].SLABMIN;
                    $(".SLABMAX3")[i].value = data[3].SLABMAX;

                    $(".SLABMIN4")[i].value = data[4].SLABMIN;
                    $(".SLABMAX4")[i].value = data[4].SLABMAX;

                    $(".SLABMIN5")[i].value = data[5].SLABMIN;
                    $(".SLABMAX5")[i].value = data[5].SLABMAX;
                  }







                   var AMT1 = $(".RCAMT1")[i].value;
                   var AMT2 = $(".RCAMT2")[i].value;
                   var AMT3 = $(".RCAMT3")[i].value;
                   var AMT4 = $(".RCAMT4")[i].value;
                   var AMT5 = $(".RCAMT5")[i].value;
                   var AMT6 = $(".RCAMT6")[i].value;
                   if (isNaN(AMT1))
                       AMT1 = 0;
                   if (isNaN(AMT2))
                       AMT2 = 0;
                   if (isNaN(AMT3))
                       AMT3 = 0;
                   if (isNaN(AMT4))
                       AMT4 = 0;
                   if (isNaN(AMT5))
                       AMT5 = 0;
                   if (isNaN(AMT6))
                       AMT6 = 0;
                   var totamt = parseInt(AMT1) + parseInt(AMT2) + parseInt(AMT3) + parseInt(AMT4) + parseInt(AMT5) + parseInt(AMT6);
                   $(".TRANDSAMT")[i].value = totamt.toFixed(2);


                }
            });

            i++;

        });

      total();

    }//........End of Calculation


    function GetTariff() {
        $(".TARIFFMID").empty();
        $.ajax({
            url: "/ShutOutInvoice/GetTariff/" +  $("#TARIFFGID option:selected").val(),
            success: function (data) {
                $(".TARIFFMID").append('<option>Select</option>');
                $.each(data, function (i, dataval) {
                    $(".TARIFFMID").append('<option value="' + dataval.TARIFFMID + '">' + dataval.TARIFFMDESC + '</option>');

                });
            }
        });
    }



        //........get detail row.....................//
    function GetDetail() {

        var tranlmid = $(".TRANLMID option:selected").text();
        $(".TRANLMNO").val(tranlmid);

        var chaid = $("#TRANREFID").val();
        var stfmid = $("#TRANLMID option:selected").val(); var tranmid = $("#TRANMID").val(); var edate = $("#TRANTIME").val();
        edate = edate.split(" "); edate = edate[0].split("/"); edate = (edate[1] < 10 ? '0' : '') + edate[1] + "-" + edate[0] + "-" + edate[2];
        url = "/ShutOutInvoice/Detail?ids=" + stfmid + "~" + edate + "~" + tranmid;// alert(url);

        $.ajax({
            url: "/ShutOutInvoice/GetOPTYP/"+stfmid,
            success: function (data) {
              //  alert(data[0].EOPTID);
                // $(".ETOPID").val(data[0].EOPTID);
                $(".ETOPID").val(data[0].SLABTID);
            }
        });
        $.ajax({
            url: url,
            success: function (data) {
              //  alert(data);
                $("#job_list").html("");

                $("#job_list").html(data);
                i = 0;
                $(".TRANDID").each(function () {
                    var C_date = $(".TRANEDATE")[i].value;

                    if (C_date == "") {

                        var M_date = $(".TRANTIME").val();

                        $(".TRANEDATE")[i].value = M_date;
                       // $(".TRANEDATE")[i].removeAttr('id').removeClass('hasDatepicker'); // added the removeClass part.
                         // $('.datepicker').datepicker({ dateFormat: 'dd-mm-yy' });

                    }


                    i++;
                });
                $('#TDETAIL tbody tr').each(function () {
                  //  alert("KKK");
                     $(this).find(".datepicker").removeAttr('id').removeClass('hasDatepicker'); // added the removeClass part.
                     $('.datepicker').datepicker({ dateFormat: 'dd/mm/yy', changeYear: true ,changeMonth:true});
                });
            }

                });//---End of Post--------

    }

   //..................... FORM VALIDATION FUNCTION.................................//
   function Validate() {

       if ($(".TRANREFNAME").val() == "") {
           alert("Please select CHA");
           $(".TRANREFNAME").focus();
           return false;
       }
       else if ($(".TRANREFID").val() == "") {
           alert("Please Select CHA properly");
           $(".TRANREFNAME").val("");
           $(".TRANREFNAME").focus();
           return false;
       }
       else if ($(".TARIFFMID").val() == "") {
           alert("Please Select Tariff properly");
           $(".TARIFFMID").focus();
           return false;
       }


       else if ($(".LCATEID").val() == "") {
           alert("Please Select Labour properly");
           $(".LCATEID").focus();
           return false;
       }
       else if ($("#TRANMODE").val() == "") {

           alert("Please Select Payment Mode");
           $("#TRANMODE").focus();
           return false;
       }
       else if ($(".TRANMODEDETL").val() == "") {
           alert("Select Payment Mode properly");
           $(".TRANMODEDETL").focus();
           return false;
       }
       else if ($("#TRANMODE").val() == "2" || $("#TRANMODE").val() == "3") {
           if ($("#TRANREFNO").val() == "") {
               alert("Please Enter Number");
               $("#TRANREFNO").focus();
               return false;
           }
           if ($("#TRANREFDATE").val() == "") {
               alert("Please Enter Date");
               $("#TRANREFDATE").focus();
               return false;
           }
           if ($(".TRANREFBNAME").val() == "") {
               alert("Select Bank Name Properly");
               $(".BANKMID").focus();
               return false;

           }
       }
       else if ($(".TRANREFAMT").val() == "") {
           alert("Please Enter Amount");
           $(".TRANREFAMT").focus();
           return false;
       }

       else if ($(".TRANNAMT").val() == "0.00" || $(".TRANDNAMT").val() == "0.00") {
           alert("Atleast One Stuffing Invoice detail should be selected");
           return false;
       }


   }//.....END OF VALIDATION
   /*...............*/

   function checkall() {
       i = 0; j = 0;
       CHCK_ALL = $("#CHCK_ALL").is(':checked');
       var tbl = $("#TDETAIL").find('tbody');


       $(".TRANDID").each(function () {

           $trcur = tbl.find("tr:eq(" + i + ")");
           if (CHCK_ALL == true) {
               $trcur.find(".TRANDID").prop("checked", true);
               $(".boolTRANDID")[i].value = "true"; //alert("i" + i);
           }
           else {
              // alert("i..."+i);
               $trcur.find(".TRANDID").removeAttr("checked", true);
               $(".boolTRANDID")[i].value = "false";
           }

           i++;

       });

       total();

   }/*.....*/


   function sel_text(obj, dest) {
       row = obj.parentNode.parentNode.rowIndex;
       var modelLength = obj.options[obj.selectedIndex].text;
       $("." + dest)[row - 1].value = modelLength;
       var selid = '/Common/CostFactorDetail/' + obj.value;
       $.getJSON(selid, function (data) {
           var items = [];
           $.each(data, function (key, val) {
               $(".CFMODE")[row - 1].value = val.CFMODE;
               $(".CFEXPR")[row - 1].value = val.CFEXPR;
               $(".CFTYPE")[row - 1].value = val.CFTYPE;
               $(".DORDRID")[row - 1].value = val.DORDRID;
               $(".DEDORDR")[row - 1].value = val.CFNATR;
           });
           total();
       });
   }
   function del_factor(obj) {
       row = obj.parentNode.parentNode.rowIndex;
       document.getElementById("CFACTOR").deleteRow(row);
       total();
       return false;

   }
   function total() {
       TRANNAMT = 0;
       TRANGAMT = 0;
       CF_ROW_TOTAL = 0;
       i = 0;
       TRANDGAMT = 0;
       TRANROAMT = 0;

       Strg_TaxableAmt = 0;
       Handl_TaxableAmt = 0;

       var total = 0; var gamt = 0.00;
       TRANSAMT = 0; TRANHAMT = 0;
       count = 0;
       i = 0; //$("#TRANGAMT").val("0");
       $(".TRANDID").each(function () {


               var TRANDSAMT = $(".TRANDSAMT")[i].value;
               var TRANDHAMT = $(".TRANDHAMT")[i].value;
               var TRANDFAMT = $(".TRANDFAMT")[i].value;
               var TRANDPAMT = $(".TRANDPAMT")[i].value;
               var TRANDEAMT = $(".TRANDEAMT")[i].value;
               if (isNaN(TRANDSAMT)) TRANDSAMT = "0"; if (isNaN(TRANDHAMT)) TRANDHAMT = "0"; if (isNaN(TRANDEAMT)) TRANDEAMT = "0"; if (isNaN(TRANDFAMT)) TRANDFAMT = "0"; if (isNaN(TRANDPAMT)) TRANDPAMT = "0";
               total = parseFloat(TRANDSAMT) + parseFloat(TRANDHAMT) + parseFloat(TRANDEAMT) + parseFloat(TRANDFAMT) + parseFloat(TRANDPAMT);

               $(".TRANDNAMT")[i].value = total.toFixed(2);
               if (isNaN(gamt)) gamt = "0";
               gamt = gamt + parseFloat($(".TRANDNAMT")[i].value);

               if (isNaN(TRANSAMT)) TRANSAMT = "0";
               TRANSAMT = TRANSAMT + eval($(".TRANDSAMT")[i].value);

               if (isNaN(TRANHAMT)) TRANHAMT = "0";
               TRANHAMT = TRANHAMT + eval($(".TRANDHAMT")[i].value);



           i++;
       });

       $("#TRANSAMT").val(TRANSAMT.toFixed(2));
    //   $("#TRANEAMT").val(TRANEAMT.toFixed(2));
       $("#TRANHAMT").val(TRANHAMT.toFixed(2));
       $("#TRANGAMT").val(gamt.toFixed(2));
       $("#TRANNAMT").val(gamt.toFixed(2));
       $("#TRANREFAMT").val($("#TRANNAMT").val());
       TRANGAMT = $("#TRANGAMT").val();
       var round = 0.00; i = 0; NETGAMT = 0;
       $('.TAX').each(function () {

           //$(".DEDNOS")[i].value = count;
           temp = 0;
           temp_tax = TRANGAMT;
           if (i > 0)
               temp_tax = eval(TRANGAMT) + eval(CF_ROW_TOTAL);
           // alert("1");

           //switch ($(".DEDORDR")[i].value) {/*inclusiv/exclusiv*/
           //    case "0": temp_tax = temp_tax; break;
           //    case "1": temp_tax = 0;

           //}

           //  alert("2call");

           //if ($(".CFTYPE")[i].value == 1)
           //    temp = eval(temp_tax) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100;
           //else
           //    temp = eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)).toFixed(2);




           //switch ($(".DORDRID")[i].value) {
           //    case "4":

           //        if (i < 1) {
           //            temp = 0;
           //            alert("1.Correct Excise Order");

           //            break;

           //        }
           //        ex = $(".DORDRID")[i - 1].value;
           //        ex = ex.trim();

           //        if ($(".CFTYPE")[i].value != 0)
           //            temp = eval($(".CFAMOUNT")[i].value) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100;
           //        else
           //            temp = eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value));


           //        if (ex != "3") {
           //            temp = 0;
           //            alert("2.Correct Excise Order");
           //        }

           //        break;
           //    case "5":

           //        if (i < 2) {
           //            temp = 0;
           //            alert("3.Correct Excise Order");
           //            break;

           //        }

           //        ex = $(".DORDRID")[i - 2].value;
           //        ex = ex.trim();

           //        sec = $(".DORDRID")[i - 1].value;
           //        sec = ex.trim();


           //        if ($(".CFTYPE")[i].value != 0)
           //            temp = eval($(".CFAMOUNT")[i].value) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100;
           //        else
           //            temp = eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value));


           //        if (ex != "3" && sec != "4") {
           //            temp = 0;
           //            alert("4.Correct Excise Order");
           //        }



           //        break;
           //}





           if (isNaN(temp))
               temp = 0;





           switch ($(".TAX")[i].value) {
               case "2": {
                   NETGAMT = eval(temp_tax); $(".TRANTCAMT").val(eval(NETGAMT).toFixed(2));
                   //  alert("case2" + temp + "...." + temp_tax + "...." + CF_ROW_TOTAL);

                   if ($(".CFTYPE")[i].value == 1)
                   { $(".DEDNOS")[i].value = 1; temp = eval(temp_tax) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100; }
                   else
                   { $(".DEDNOS")[i].value = count; temp = eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)).toFixed(2); }


                   break;
               }
               case "96": {
                   //  alert("case93" + temp + "...." + temp_tax + "...." + CF_ROW_TOTAL);

                   if ($(".CFTYPE")[i].value == 1)
                   { $(".DEDNOS")[i].value = 1; temp = Math.round(eval(NETGAMT) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100); }
                   else
                   {
                       $(".DEDNOS")[i].value = count; temp = Math.round(eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value))).toFixed(2);

                   }


                   break;
               }
               case "97": {
                   //  alert("case93" + temp + "...." + temp_tax + "...." + CF_ROW_TOTAL);

                   if ($(".CFTYPE")[i].value == 1)
                   { $(".DEDNOS")[i].value = 1; temp = Math.round(eval(NETGAMT) * eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value)) / 100); }
                   else
                   {
                       $(".DEDNOS")[i].value = count; temp = Math.round(eval($(".CFEXPR")[i].value * ($(".DEDNOS")[i].value))).toFixed(2);

                   }


                   break;
               }
               default: {
                   //  alert("def" + temp + "...." + temp_tax + "...." + CF_ROW_TOTAL);
                   //NETGAMT = eval(NETGAMT) + eval(CF_ROW_TOTAL);

                   var dednos = $(".DEDNOS")[i].value;
                   if ($(".CFTYPE")[i].value == 1) {
                       //  $(".DEDNOS")[i].value = 1;
                       temp = eval(temp_tax) * eval($(".CFEXPR")[i].value * (dednos)) / 100;
                   }
                   else {// $(".DEDNOS")[i].value = count;
                       temp = eval($(".CFEXPR")[i].value * (dednos)).toFixed(2);
                   }

                   break;
               }
           }
           if ($(".CFMODE")[i].value == 0)
               CF_ROW_TOTAL = Math.round(eval(CF_ROW_TOTAL) + eval(temp));
           else
               CF_ROW_TOTAL = Math.round(eval(CF_ROW_TOTAL) - eval(temp));

           if (isNaN(temp)) temp == "0";
           $(".CFAMOUNT")[i].value = Math.round(eval(temp)).toFixed(2);



           i++;
       });


       var stax = 0;//$(".STAX option:selected").val();
       //alert(stax);
       Strg_TaxableAmt = 0;
       Handl_TaxableAmt = (eval(TRANGAMT) + eval(CF_ROW_TOTAL));

       $('.STRG_TAXABLE_AMT').val(Strg_TaxableAmt);
       $('.HANDL_TAXABLE_AMT').val(Handl_TaxableAmt);

       if (stax == 0) {
           Strg_CGSTExprn = $("#STRG_CGST_EXPRN").val();
           Strg_SGSTExprn = $("#STRG_SGST_EXPRN").val();
           Strg_IGSTExprn = $("#STRG_IGST_EXPRN").val();

           Handl_CGSTExprn = $("#HANDL_CGST_EXPRN").val();
           Handl_SGSTExprn = $("#HANDL_SGST_EXPRN").val();
           Handl_IGSTExprn = $("#HANDL_IGST_EXPRN").val();
       }
       else {
           Strg_CGSTExprn = 0;
           Strg_SGSTExprn = 0;
           Strg_IGSTExprn = 0;

           Handl_CGSTExprn = 0;
           Handl_SGSTExprn = 0;
           Handl_IGSTExprn = 0;
       }

       //alert(Handl_CGSTExprn);
       Strg_CGSTAmt = eval(((Strg_TaxableAmt * Strg_CGSTExprn) / 100));
       Strg_CGSTAmt = Math.abs(Math.round(Strg_CGSTAmt, 0));

       Strg_SGSTAmt = eval(((Strg_TaxableAmt * Strg_SGSTExprn) / 100));
       Strg_SGSTAmt = Math.abs(Math.round(Strg_SGSTAmt, 0));

       Strg_IGSTAmt = eval(((Strg_TaxableAmt * Strg_IGSTExprn) / 100));
       Strg_IGSTAmt = Math.abs(Math.round(Strg_IGSTAmt, 0));

       Handl_CGSTAmt = eval(((Handl_TaxableAmt * Handl_CGSTExprn) / 100));
       Handl_CGSTAmt = Math.abs(Math.round(Handl_CGSTAmt, 0));

       Handl_SGSTAmt = eval(((Handl_TaxableAmt * Handl_SGSTExprn) / 100));
       Handl_SGSTAmt = Math.abs(Math.round(Handl_SGSTAmt, 0));

       Handl_IGSTAmt = eval(((Handl_TaxableAmt * Handl_IGSTExprn) / 100));
       Handl_IGSTAmt = Math.abs(Math.round(Handl_IGSTAmt, 0));

       Tot_CGSTAmt = parseFloat(Strg_CGSTAmt + Handl_CGSTAmt).toFixed(2);
       Tot_SGSTAmt = parseFloat(Strg_SGSTAmt + Handl_SGSTAmt).toFixed(2);
       Tot_IGSTAmt = parseFloat(Strg_IGSTAmt + Handl_IGSTAmt).toFixed(2);

       $('.STRG_CGST_AMT').val(Strg_CGSTAmt);
       $('.STRG_SGST_AMT').val(Strg_SGSTAmt);
       $('.STRG_IGST_AMT').val(Strg_IGSTAmt);

       $('.HANDL_CGST_AMT').val(Handl_CGSTAmt);
       $('.HANDL_SGST_AMT').val(Handl_SGSTAmt);
       $('.HANDL_IGST_AMT').val(Handl_IGSTAmt);

       $('.TRANCGSTAMT').val(Tot_CGSTAmt);
       $('.TRANSGSTAMT').val(Tot_SGSTAmt);
       $('.TRANIGSTAMT').val(Tot_IGSTAmt);


       //round = (eval(TRANGAMT) + eval(CF_ROW_TOTAL));
       round = parseFloat(Strg_TaxableAmt) + parseFloat(Handl_TaxableAmt) + parseFloat(Tot_CGSTAmt) + parseFloat(Tot_SGSTAmt) + parseFloat(Tot_IGSTAmt);

       ROCHECK = Math.abs(Math.round(round, 0) - parseFloat(round)).toFixed(2);
       if (isNaN(ROCHECK))
           ROCHECK = 0;

       ROCHECK = Math.abs(Math.round(round, 0) - parseFloat(round)).toFixed(2);
       if (isNaN(ROCHECK))
           ROCHECK = 0;

       $('.TRANROAMT').val(ROCHECK);
       TRANROAMT = Math.round(round, 0) - parseFloat(round);

       //TRANNAMT = (eval(TRANGAMT) + eval(CF_ROW_TOTAL) + eval(TRANROAMT)).toFixed(2);
       TRANNAMT = (parseFloat(round) + parseFloat(TRANROAMT)).toFixed(2);

       if (isNaN(TRANNAMT))
           TRANNAMT = 0;

       $("#TRANNAMT").val(TRANNAMT);
       $("#TRANREFAMT").val(TRANNAMT);
   }


   $(document).ready(function () {

       function sleep(milliseconds) {
           var start = new Date().getTime();
           for (var i = 0; i < 1e7; i++) {
               if ((new Date().getTime() - start) > milliseconds) {
                   break;
               }
           }
       }



       $(document).on("click", "#cfact", function () {


           var $tableBody = $('#CFACTOR').find("tbody"),
   $trLast = $tableBody.find("tr:last");
           $trFirst = $tableBody.find("tr:first");

           $("#cf_dynamic").css("display:block");


           var tax_param = "";
           i = 0;


           $('.TAX').each(function () {

               tax_param = tax_param + $.trim(this.value) + ",";
               pos = $('#CFACTOR tr').eq(($('#CFACTOR tr').length - ($('#CFACTOR tr').length)) + 1);
               idx = $('#CFACTOR tr').length - 2;
               desc = pos.find(".CFDESC").val();
               tax = pos.find(".TAX").val();

               pos.find('td:eq(1)').html("<input type=text value=" + tax + " id='TAX' class='TAX' name='TAX' style='display:none' >" + desc + "<input type=text style='border:none' readonly=readonly value='" + desc + "' name=CFDESC id='CFDESC' class='CFDESC hide'> ");

               i++;
           });



           var formData = { term: tax_param }; //Array

           $.ajax({
               url: "/Common/CostFactor",
               type: "POST",
               data: formData,
               success: function (data, textStatus, jqXHR) {
                   //data - response from server

                   if (data.length != 0)
                       $trFirst.after("<tr class='item-row'><Td> <button href='#'   type='button' onclick='del_factor(this)' class='btn btn-danger dfact btn-xs'><i class=glyphicon-minus></i> </button>  </td> <td>" + data + " </td><td><input  type=text value='' name=CFAMOUNT id='CFAMOUNT' class='CFAMOUNT' readonly='readonly'> </td>  </TD></tr>");


                   total();


               },
               error: function (jqXHR, textStatus, errorThrown) {

               }
           });

           total();
           return false;

       });

   });

    </script>




    <script>
        $(window).bind("load", function () {
            if ($(".SBMID").val() == "") {
                $(".SBMID").val("0");
            }
        });

        $(document).ready(function () {


            var rowcount = $('#TDETAIL tbody tr').length;

            $("#TDETAIL_IDX").val(rowcount);

            //----------------------------------insert/delete row-----------------------------------------//

            $("#add_detail").click(function () {

                if ($("#TDETAIL_IDX").val() != 0) {


                    var $tableBody = $('#TDETAIL').find("tbody"),
                    $trLast = $tableBody.find("tr:last");
                    $trNew = $trLast.clone();
                    $trLast.after($trNew);
                    $trNew.find("td:eq(1)").html("<select id='FSTFDID' class='FSTFDID form-control' name='FSTFDID' onclick ='GetDetails(this)' style='width:152px'><option >Select</option> </select><input class='hide TRANDREFNO' id='TRANDREFNO' name='TRANDREFNO' type='text' >");

                    $trNew.find('input:text').val("");
                    $trNew.find('.TRANDID').val("0");


                    $trNew.find('.TRANDNOP').val("0");
                    $trNew.find('.TRANDQTY').val("0");
                    $trNew.find('.datepicker').each(function () {
                        $(this).removeAttr('id').removeClass('hasDatepicker'); // added the removeClass part.
                        $('.datepicker').datepicker({ dateFormat: 'dd/mm/yy' });
                    });

                    //............event bind
                    $trNew.find(".FSTFDID").empty();
                    $.ajax({

                        type: 'get',
                        url: '@Url.Action("GetCont", "ShutOutInvoice")/' + $(".TRANREFID").val(), // we are calling json method

                        success: function (data) {
                            // alert(data);
                            $trNew.find(".FSTFDID").append('<option>Select</option>');
                            $.each(data, function (i, dataval) {
                                $trNew.find(".FSTFDID").append('<option value="' + dataval.STFDID + '">' + dataval.CONTNRNO + '</option>');

                            });
                            // $(".TRANDREFNO").val();

                        },
                        error: function (ex) {
                            alert('Failed to data ' + ex);
                        }
                    });

                    return false;

                    //....end event bind

                    var row_idx = parseInt($("#TDETAIL_IDX").val());

                    $("#TDETAIL_IDX").val(row_idx + 1);

                    $("#TDETAIL_BODY").show();
                    calculation();

                }
                else {

                    $('#TDETAIL_IDX').val("1");
                    $("#TDETAIL_BODY").show();

                }
            });

            //delete event


            $(document).on("click", "#del_detail", function () {

                var r = confirm("Are you sure to delete this record ?");

                if (r == true) {


                    //  idx = $(this).parent().parent().index();
                    idx = $("#TDETAIL_IDX").val();

                    if (idx == 1) {

                        $("#TDETAIL_BODY").hide();

                        $("#TDETAIL_IDX").val(0);


                        var $tableBody = $('#TDETAIL').find("tbody")

                        $trCur = $tableBody.find("tr:eq(0)");

                        $trCur.find('.input:text').val("");
                        $('#TRANDID').val("0");


                        $('.STFDNOP').val("0");
                        $('.STFDQTY').val("0");
                        calculation();

                    }
                    else {
                        $("#TDETAIL_BODY").show();
                        var row = this.parentNode.parentNode;
                        $(this).parents('.item-row').remove();

                        $("#TDETAIL_IDX").val($("#TDETAIL_IDX").val() - 1);
                        calculation();
                    }
                }
            });

        });

        $(function () {

            //-----date controls-------------
            $(".datepicker").datepicker({ dateFormat: 'dd/mm/yy', });
            $('.datetime').datetimepicker({
                dateFormat: 'dd/mm/yy',
                timeFormat: 'hh:mm'
            });
            //$('.time').timepicker();



            //
            //-----------------------Form Validation-------------------------//
            function Validate() {

                if ($(".STFMNAME").val() == "") {
                    alert("Please select CHA");
                    $(".STFMNAME").focus();
                    return false;
                }

                else if ($(".CHAID").val() == "") {
                    alert("Please Select CHA properly");
                    $(".STFMNAME").focus();
                    return false;
                }
                else if ($(".LCATEID").val() == "") {
                    alert("Please Select Labour properly");
                    $(".LCATEID").focus();
                    return false;
                }


                var bad = 0;
                $('#TDETAIL :text').each(function () {

                    switch (this.id) {
                        default:
                            if ($.trim(this.value) == "") bad++;
                    }
                });

                if (bad < 1)
                    return true;
                else {

                    alert("Please Enter ShutOut details before save");
                    return false;
                }

            }//.....End of validation

        });

    </script>
}
